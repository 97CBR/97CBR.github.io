<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>MarxCBR的小屋</title>
  
  <subtitle>MarxCBR的小屋</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.marxcbr.cn/"/>
  <updated>2021-12-19T14:42:52.589Z</updated>
  <id>https://www.marxcbr.cn/</id>
  
  <author>
    <name>MarxCBR</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>重启家用光猫路由一体化路由器</title>
    <link href="https://www.marxcbr.cn/archives/a082046b.html"/>
    <id>https://www.marxcbr.cn/archives/a082046b.html</id>
    <published>2021-12-19T14:30:00.000Z</published>
    <updated>2021-12-19T14:42:52.589Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="说明"><a class="markdownIt-Anchor" href="#说明"></a> 说明</h2><p>此次记录的是 中国移动 H62G 家用光猫路由一体的路由器的重启方式，特别的简洁，大部分均以图片和简要的文字进行说明</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/202112192232206.jpg" alt="img" /></p><p>有用与否请自行鉴定</p><h3 id="登录"><a class="markdownIt-Anchor" href="#登录"></a> 登录</h3><p>输入 192.168.1.1 输入，根据路由器机身后面的 说明信息获取 账号密码，进行输入即可成功登录</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/202112192239513.png" alt="image-20211219192914777" /></p><h3 id="进入主界面"><a class="markdownIt-Anchor" href="#进入主界面"></a> 进入主界面</h3><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/202112192239175.png" alt="image-20211219193029015" /></p><h3 id="进入管理页面"><a class="markdownIt-Anchor" href="#进入管理页面"></a> 进入管理页面</h3><p>点击下方的 “设备重启” 按钮</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/202112192239784.png" alt="" /></p><h3 id="点击确定重启"><a class="markdownIt-Anchor" href="#点击确定重启"></a> 点击确定重启</h3><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/202112192240005.png" alt="image-20211219193053485" /></p><h3 id="重启提示"><a class="markdownIt-Anchor" href="#重启提示"></a> 重启提示</h3><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/202112192240205.png" alt="image-20211219193103713" /></p><p>实测路由器将会在一分钟左右就从新上线</p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/202112192238668.jpg" alt="img" style="zoom:80%;" />]]></content>
    
    <summary type="html">
    
      重启家用光猫路由一体化路由器
    
    </summary>
    
    
      <category term="女朋友的小手册" scheme="https://www.marxcbr.cn/categories/%E5%A5%B3%E6%9C%8B%E5%8F%8B%E7%9A%84%E5%B0%8F%E6%89%8B%E5%86%8C/"/>
    
    
      <category term="路由器" scheme="https://www.marxcbr.cn/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>关于博客图片无法正常显示说明</title>
    <link href="https://www.marxcbr.cn/archives/ce7c2b4e.html"/>
    <id>https://www.marxcbr.cn/archives/ce7c2b4e.html</id>
    <published>2021-11-15T14:56:38.000Z</published>
    <updated>2021-11-15T16:52:51.135Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="404-not-found"><a class="markdownIt-Anchor" href="#404-not-found"></a> 404 NOT FOUND</h2><p><img src="http://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/404.png" alt="MarxCBR的小屋" /></p><p>各位读者十分抱歉，本博客的图片因本人的 疏忽 以及 懒惰 导致存储在阿里云OSS上的图片均由于过期导致被清空了</p><p>本人将逐步恢复博客的图片，以及尝试新增一个图片墙的栏目</p><p>十分感谢提醒我博客图片失效的同学 @cheems骑士<img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/202111160051787.png" alt="img" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/202111152345367.png" alt="image-20211115225416393" /></p><p>再次致歉，各位先看着文字版的博客吧，权当是手机浏览器开启了无图浏览模式</p>]]></content>
    
    <summary type="html">
    
      关于博客图片无法正常显示说明
    
    </summary>
    
    
      <category term="小日志" scheme="https://www.marxcbr.cn/categories/%E5%B0%8F%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="小日志" scheme="https://www.marxcbr.cn/tags/%E5%B0%8F%E6%97%A5%E5%BF%97/"/>
    
  </entry>
  
  <entry>
    <title>毕业之旅</title>
    <link href="https://www.marxcbr.cn/archives/14ec9c68.html"/>
    <id>https://www.marxcbr.cn/archives/14ec9c68.html</id>
    <published>2021-07-25T15:18:25.000Z</published>
    <updated>2021-11-15T14:31:36.205Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="毕业之旅"><a class="markdownIt-Anchor" href="#毕业之旅"></a> 毕业之旅</h2><p>时间来到六月份毕业季，我的可爱居居女朋友也在六月份顺利毕业了。虽然刚跳槽工作入职一个月，但我仍要请假两天加上周末两天去参加她的毕业典礼以及毕业旅游。这种不错过对自己很重要的人的任何的一个里程碑的感觉，真的很棒。</p><h2 id="毕业-桂林"><a class="markdownIt-Anchor" href="#毕业-桂林"></a> 毕业-桂林</h2><p>17 号晚上到桂林，到时已经夜了。不过，桂林的天气 28 度外加没有一丝丝的风，仍是我熟悉的属于桂林市区的闷热。打个滴就到酒店了，一路上人、车都格外少，或许这就是我最后一次这么晚还从北站奔赴桂电了吧。上次这个点，从北站出发往学校方向的时候，还是大四上，十月份参加华为秋招失利后呢。为了第二天早早的就可以参加她的毕业典礼，订了在东区的酒店，开好房间便带着空空的肚子去搞了一包泡面。五点半一到下班时间，便火速离开办公室，吃了一碗粥和一个小油条，奔赴深圳北站。不过也是这次开始，我才发现了原来桶装的泡面也有两个面饼的类型了。真的太照顾我这种一包不饱两包有多的人群了，它会销量很好的，确信。<br /><img src="http://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/IMG_20210617_221116-1.jpg" alt="深夜的北站" /></p><p>那是一个阳光很好的清晨，七点便爬起床把房退了，准备去上车。临上车前，想到应该给我居居带上一大捧花花。到周围的花店查看了一下店面，没开门营业。便逐个给美团上面的花店打电话询问是否营业，好家伙，七家周边的花店，全都没开点，这是我没想到的。 这估计跟桂电这边的毕业传统甚至广西的毕业典礼传统相关。因为，在我记忆中，广东这边的大学，好多好多大学生在毕业时都会邀请很多自己的知己好友从各个大学各个地方过来参加自己的毕业典礼，一起见证自己的人生里程碑。这时候，校门外的路都是摆满卖花的，还有各种各样跟毕业有关的物品。可惜在广西，至少在桂电，我没看到这样的一个盛况。</p><p>坐上公交到学校的时候，校毕业典礼已然进行了一半。各院的师生都坐到大草坪上，校领导、学生代表、各界代表都上台发言。流程还是一样一样的。不过他们幸好有椅子坐，天上有云，不至于炽热的阳光直接亲吻每一个人。典礼后，我看到了在散去的人群中，那个四处张望寻找我的女朋友，略显着急，脸上又是充满了期待，真可爱。哼~是我抱上她，她说出的第一句话。嗯，这是一句因思念我太久，又没法见面的“哼”，很好，她还是她，那个想我爱我的她。后续便参加院系的毕业典礼，拨穗仪式。</p><p><img src="http://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/image-20210627012249911-22.jpg" alt="学校航拍的毕业典礼照片" /></p><p>到三院之后，见着了好多好多老师与同学们，那几个之前特别熟络的同学都跟我来了个 big bug。拨穗仪式的流程挺简单的，挺快的就完成了。但是，这个仪式却很重要。这代表着学院，学校对你的一个认可。意味着，你已经在学校中学习并领会了许许多多的技能与成长，可以带着这些知识到社会中发挥作用了。振翅高飞，不可限量。可能谈不上为国家作出多大多大的贡献，但是融入社会，并可以在社会中继续学习继续成长，并担上越来越多，越来越重要的责任是每一个毕业生的基本要求吧。</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/image-20210627012740264-24.jpg" alt="拨穗过程" /></p><p>到了学校，她下午才可以办理完离校手续，那中午自然就是在学校吃了。可能很多人都想，在学校最后一顿怎么说都该在食堂吃吧。但是，我们选择了螺蛳粉。嗯，好久没吃这么好吃的螺蛳粉了，馋了一年了，想念。</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/image-20210627012552552-23.jpg" alt="image-20210627012552552" /></p><p>下午办理好了离校手续之后，跟一些老师与同学道别后，便带着她，一起离开了学校，那个陪伴了她五年的校园，那个有我俩无数共同回忆的 GUET，那个教会她很多学识的桂电，那个承载着梦的地方。</p><p><img src="http://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/IMG_20210618_094545-1624729606388-4.jpg" alt="图书馆门前的她" /></p><p><strong>在 2021 年的 6 月 18 日，我的女朋友，毕业了。</strong></p><h2 id="出发-重庆"><a class="markdownIt-Anchor" href="#出发-重庆"></a> 出发-重庆</h2><p>桂林到重庆要坐好几个钟的高铁，四个半小时左右吧。一路上，都没睡，因为她睡不着，我也不可以睡，嘿嘿。就这样，跟她一路听着《三体-科幻广播剧》，在高铁的风驰电掣中抵达了 “山城” 重庆，这个神奇的地方。经过几个小时高铁消耗的她已然略显倦意，可是，重庆西站还是给了我们一个下马威，让我们直接 <strong>&quot;找不到打车的地方”</strong>。嗯，这就是特色吧。</p><h2 id="住-环境舒适的来还要交通便利"><a class="markdownIt-Anchor" href="#住-环境舒适的来还要交通便利"></a> 住-环境舒适的来还要交通便利</h2><p>因为高铁到的是重庆西，离渝中解放碑那片地方，挺远的。而且，解放碑附近交通比较方便，以其为中心辐射周边的景点区域什么的都比较方便，又有小吃街，于是我们订的解放碑附近的酒店-麓枫酒店。跟步行街什么的，也就离着三四百米的距离，走两步就可以到了。</p><p>入住的时候，他们前台给我们免费升级了房间，住的更加舒服了一点，这个还是给他们一个大大的好评。可能是因为连订了三晚，也可能是住的人不多吧。</p><h2 id="玩-好吃的好看的东西太多了"><a class="markdownIt-Anchor" href="#玩-好吃的好看的东西太多了"></a> 玩-好吃的好看的东西太多了</h2><p>这次行程，主要都把时间花在了找吃的上面吧。俩人，跟着大众点评，小红书，美团什么的，各路神仙软件，去了大大小小好多的网红店去吃各种各样的东西。有<strong>串串、火锅、酥肉、包子、奶茶、面食</strong>。也去了很多网红景点，也在到处瞎逛的时候，看到了一下并不网红的景点。</p><h2 id="第一天"><a class="markdownIt-Anchor" href="#第一天"></a> 第一天</h2><p>第一天大早上，八点多便出门，去吃上了当地的面食。具体的名字我忘了，实在不好意思嘞~但是，料很多，面也挺好吃，当时感觉这面再劲道一点点会更好些。考虑到我们俩后续还有很多很多想吃的东西，就只叫了一碗，俩人一起吃。既不撑腹又可以甜蜜一下，何乐而不为。</p><p>吃完早餐后，那必定得去离得最近的 解放碑 逛逛嘞。不远，沿着街边走走就到了，大早上的人不是很多，车也少。一路走呀走，就拐到了解放碑。只是有点可惜，天气不是很好。但是，阴凉舒适有点风，可以让我们走好久，不怕晒。</p><img src="http://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/IMG_20210619_093648.jpg" alt="IMG_20210619_093648" style="zoom: 50%;" /><p>第一个买的小吃是，“肖炮酥肉” 如果没记错的话，它的位置挺难找的，一个小店。忘了在哪个平台上面，它属于霸榜级别。兴致勃勃的找了半个小时才找到。但是，我说但是了，没错，就是你理解的那种但是。它虽说是网红酥肉。但是我跟女朋友俩人吃起来，实在品尝不出它的美妙。我只记得，第一口下去，麻了，我麻了。跟她都只吃了几块，就吃不下去了。为啥呢，一口口的花椒，你能吃几口呢。不知道是不是我们恰好就买到了他们家品质没控制好的那批。或者是我们实在 get 到好吃的点~</p><p>第二个吃的生煎，巧了，名字我又忘了，也算是网红店，在酥肉店附近的。要是到当地去的话，看看有啥网红生煎就懂了。这个讲真挺好吃的。哈哈哈，不是不想给他打广告，是记忆力实在不行了。没记住，或许他们可以考虑怎么宣传招牌来让顾客记得更牢。哈哈哈~</p><p>中午吃的是秀孃家的串串。这个店让我记忆清晰。这店厉害了，跟着导航走，我可以保证你永远都找不到他们家店在哪里。</p><p><img src="http://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/image-20210627023937140.png" alt="image-20210627023937140" /></p><p>这个表情深刻表达了我们当时的心情。</p><p>因为他们家店在一个小区里面，还不是那种进门走两步就可以看到的那种，是得走好多好多步，走到你怀疑是不是走错了。但是，最终的结果，因为人太多了，找到店的快乐已经充满了脑袋瓜，而且空间稍微有点儿拥挤，就忘了拍照片。味道和价格上，还是很对得起这个找店的过程的。猜猜我们找这店找了多久，少说也有 50 分钟吧。围着它的那个小区，兜兜转转，地下通道，人行天桥，走上走下的，到处走。所有的地图都不好使，高德、腾讯啥的。最终我们还是得到了当地人的热心指引才找到了那家“神秘的店”。可能，众多食客里，也就我们俩是找不到店的吧。因为，十一点半左右，外面排队的阵仗如图：</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/IMG_20210619_120841-7.jpg" alt="IMG_20210619_120841" /></p><p>在去找秀孃的火锅串串店时，路过了一个网咖。这个网咖，是我第一次到重庆时去的第一间店。因为，当时大三的时候抵达重庆的那天是腾讯的笔试。七点半开始笔试。所以，下车第一件事就是，找附近的网咖，把笔试给安排上。当时的场景就是，隔壁的小姐姐搁那跟跟别人 DOTA，后面的人在 LOL，还有一堆吃鸡的。只要我在角落摸摸的装着 Pycharm 和 Python 这些开发环境，然后写起我的笔试题。但是不得不说，因为现在的网咖已经大部分都没有摄像头了，所以无法让牛客网检测我的摄像头开启情况。估计后台直接就给我打上了作弊的标签······写的挺好的一份笔试题就这样无了。</p><p>吃完饭之后，就顺着街道走，在陌生的城市里，俩人牵着手，到处瞎逛着，发现着一些新奇的，有意思的景点，特色，的确是一种很 nice 的感觉。当然，城市的底蕴得够，要不然，叫你在一片沙漠里到处逛，你还能逛出花来？哈哈哈</p><p>沿着路走呀走，路过了一个花店。给她买了朵大大的菊花~，乐的她咯咯咯的笑。一路上发现了一个教堂，被一大片房子围起来。</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/IMG_20210619_131859.jpg" alt="IMG_20210619_131859" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/IMG_20210619_132222-9.jpg" alt="IMG_20210619_132222" /></p><p>在穿梭中，不知怎么的，便到了 郭沫若旧居</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/IMG_20210619_140528-11.jpg" alt="IMG_20210619_140528" /></p><p>进去里面，人并不多，大多数是上了年纪的大叔大爷。里面陈列展示着很多材料和故事，甚至还有《屈原》话剧场景复现。</p><p>出来不久后，再走走就可以看到这面墙</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/IMG_20210619_140123-10.jpg" alt="IMG_20210619_140123" /></p><p>走在步道中，忽然瞥到一个小巷子，尽头是一个咖啡馆吧，门口摆满了鲜花，布满苔藓的阶梯，还有朴实的“咖啡”二字。着实让人看着舒服。恍惚间觉着，在这样的一个地方开着一个这样的小小的咖啡馆，每天跟几个有缘到这里的人坐坐聊聊，是不是惬意文艺到起飞呢。</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/IMG_20210619_142114-13.jpg" alt="IMG_20210619_142114" /></p><p>沿着步道往下走，可以发现一条从屋子里往步道延伸出来的桥，应该算一种桥吧。哈哈哈，这对当地人来说，可能见惯不怪。但是对于我们来说还是觉得有那么些神奇的。</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/IMG_20210619_141647-12.jpg" alt="IMG_20210619_141647" /></p><p>走完步道后，便出发前往重庆美术馆，里面正举办着《红岩》的主题展览，一楼都是书法作品展示，二楼则是主题展览。不知道是不是因为主题展览的缘故。并没有一些油画水墨画这类的作品展览。</p><p>休息了一会后，晚上去了弹石子老街，一层一层的往下走着。发现了一个娃哈哈的奶茶店，真是太稀奇了吧，之前从未见过他们开的奶茶店。所以点了一个娃哈哈的奶茶，讲真，味道一般，可能是点的不是招牌，喝起来的感觉是带着娃哈哈的味道，以及其它材料的味道，但是还是觉得没有其它的奶茶店的好吃，可能是我比较喝果茶吧。话说，喝果茶，还不如直接吃水果？</p><p>准备继续往下走，在走到下行的步梯的时候。灯突然亮起来了，哈哈哈，一下子就烂漫起来了。谢谢开闸的大哥的神助攻。下去之后便看到了一家冰激凌店，顺道就吃了个冰激凌。她开心的说着：“嘿嘿~别的宝宝有的东西我也有喏~”。</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/IMG_20210619_191136-14.jpg" alt="IMG_20210619_191136" /></p><p>就这样走着走着，天色便渐渐的从明亮转换成昏暗，慢慢的便可以看到高楼大厦闪烁灯火。</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/IMG_20210619_194956-15.jpg" alt="IMG_20210619_194956" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/IMG_20210619_200359-16.jpg" alt="IMG_20210619_200359" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/IMG_20210619_200708-17.jpg" alt="IMG_20210619_200708" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/IMG_20210619_201030-18.jpg" alt="IMG_20210619_201030" /></p><p>逛完弹石子老街后，便出来吃烧烤。叫啥我忘了，在弹石子后街那条巷子里。那一排排都是烧烤店。人挺多，环境看起来比较一般，跟广东这边的大排档和烧烤什么的，感觉还是差点儿意思。起码，感觉这边的场地要干净明亮些。烧烤是自己挑，然后给他们烤，各个地方都是这样子的了，没啥特别。但是，他们家的生意实在太好了，我们等了半个小时左右才把第一批的烧烤拿上来。味道是挺不错的，还有一个叫苕皮的，吃起来也有它的特色。第二批拿上来又等了差不多十分钟，但是，在还没吃完第一波的时候，就拿上来了，没啥问题的啦。第二批拿上来的吃起来，感觉可能是换了师傅烤的，稍微要比第一批的差点点，而且味道也偏咸了，反正总体味道还是挺奈斯的啦，但是个人感觉要是像我们这样特地走了差不多一个钟的路，为了吃它就有点儿大可不必了。</p><p>离这家店不远的地方，还有一段路，里面有好多好多间那种，普通房间改成 KTV 的 KTV，每一个门口都正对着街，从门外看着里面泛着一层粉红色以及各种灯球射出来的斑斓。当时还没走到，离他们几十米远就能听到震天动地的嘶吼声，或许这样形容不对，那就是豪迈的歌声！</p><h2 id="第二天"><a class="markdownIt-Anchor" href="#第二天"></a> 第二天</h2><p>第一天走了两万多步，晚上会酒店还看了一部《攀登者》才睡觉(为啥是这部片，因为电影频道的回放只能找到一天前播放过的攀登者，hhh)。睡醒感觉实在太累了，所以，临近中午才出发去吃饭，选的离酒店不远的一家店。叫 “丘二馆较场口店”。入口也是那种小小的门口，经过一个脏兮兮的楼梯，上到二楼。那条楼梯曾经勾起了我小学的记忆。那种水泥扶手，水磨地面。</p><p>到店里面之后，那生意也是火爆。俩人想找个单独的桌子都没有。最终也是跟别人拼桌，但是看到店里好多本地人用着本地的方言跟服务员和老板说话，倒是给了我不少信心。一家本地人都喜欢吃的店，应该差不了。我跟她点了四个菜，蒜泥白肉，女朋友心心念念的一道菜，可以说是为了吃这个菜才来的这个店。宫爆鸡丁，经典菜式，不能少了。手撕鸡，隔壁桌的人点了，看起来也很好吃的样子。鱼香肉丝，这无敌经典的菜式，之前在学校就吃了不少这道菜，到了这边就更得尝尝了。</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/IMG_20210620_124846-19.jpg" alt="IMG_20210620_124846" /></p><p>蒜泥白肉，拌好汁之后吃，好吃，但是她说，没放糖，没灵魂。更多的吃到的是一个感觉，辣！宫爆鸡丁的话，一大盘基本都是花生，鸡的确是鸡丁，不多，但是花生和鸡肉都好吃，好评。手撕鸡，好家伙，只能用一句话形容，那味道是真滴辣呀，根本吃不出鸡肉的味道了。鱼香肉丝就是鱼香肉丝的味道，四道菜下来，一瓶王老吉根本不够喝。饭也早已被辣椒红油染成了红红的颜色。</p><p>下午去了磁器口，不得不说，里面的商业气息十分浓厚。去过这么多的号称古镇特色的地方旅游。似乎每个地方都搞得一样。都是借着古镇的外表，无数家店买着差不多的特产，差不多的商品，人头涌涌，喧扰纷杂。或许就是这么有意思，没去某个之前，大概自己也能猜到会是怎么样，但是你也总还是会去一趟。</p><p>逛了大半圈，便撤退了，去探索新的，没去过地方。比如，李子坝 观景台。应该是这个名字了啦。因为李子坝这仨字就足够让你检索出大把信息了。打车到达之后，是在江边。面朝渝中市区应该，我也没细致的看地理情况。背后是一栋楼，一条轻轨在楼内穿过。很多人在观景台看轻轨穿楼。但是我感觉有那么点儿小缺陷就是，李子坝站就在那栋楼里，所以，你会看到楼的左右有两列车进站。过稍许才会有车出来。这并不能让人有一种连贯的感觉，就那种，一列车从楼的左边呼呼的穿梭到右边的那种连续连贯的感觉。不过，之前没有见过轻轨过楼的场面，也是让人觉着挺有意思的。</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/IMG_20210620_170056.jpg" alt="IMG_20210620_170056" /></p><p>接下来便前往 大扶梯，emmmm，咋个说。并未给到我们一个比较大的印象，就一列电梯，长长的，挺多人。不过，在电梯运行的中段的时候，往上往下看都不易看到头。视野所在均为电梯和人头，这时，如果你的坐标参考系有那么点儿混乱的话。你会感觉自己是垂直下降，而自己又是斜站在楼梯上的感觉。不好描述，有点奇妙，顺路可以去试试。</p><p>然后打了个的过 洪崖洞，准备看看洪崖洞的景观以及夜景，洪崖洞作为网红景点，人流量自然是比较大的。我记得以前去的时候，并不需要去公众号上预约的。但是，现在去的时候，需要预约，可能是因为疫情的原因 bia。但是，进去了里面之后，发现卖的都是那几乎可以说是千篇一律的 火锅底料、酥肉小吃等物品，还有一众采耳店。我女朋友好早好早之前就想采耳体验一下，所以，我们也随便挑了一家店，试试这边的特色，采耳。套餐啥的，我忘了，emmm，大概就是 基础采耳、洗耳啥的，然后叠加一下，变成各种套餐。我寻思体验一下采耳，就不搞洗耳了。但是，在采耳的过程中，给我采耳的小妹疯狂给我推荐洗耳，整个采耳过程，约莫十分钟左右，甚至不到。给我推荐了五六回，她怂恿我道：你老婆都洗耳了，你也洗一个吧，会好很多。然而仍旧得到了我 拒绝升级套餐的答复。然后，我采耳完了之后，我女朋友的确选择了 升级 洗耳套餐，看起来像是用湿润的棉签去把耳道清洁干净。但是就这一个小服务，竟然要多收六十。还是有点儿小坑 bia。事后，女朋友告诉我，她说，给他采耳的小妹也说，你老公都洗耳了，你也洗一个吧。因为采耳的时候，你并不方便大声说话，环境又嘈杂，只能沉默的给他们采耳，你信息就难以进行沟通与确认。哈哈哈，多好的一个利用信息不对等的商业案例。</p><p>不知不觉到了晚上，寻思着，到重庆怎么能不吃一顿火锅，要红锅的那种。六点多，饭点时间，要排好久队。一开始预约 佩姐老火锅，但是实在太火爆了。要等十几二十号，无奈就此作罢。转移场地到 沧龙火锅。 这边等的挺快，十几分钟就可以上桌了。门口有雪糕冰棍可以自取，一人一根。挑了个葡萄味的冰棍和一个雪糕。不过，他们在门口炒火锅底料实在是，真的是，太太太，让人容易打喷嚏了。到这店的第一个动作，不是拿冰棍，也不是找门口的接待员说排号。而是先打上几个喷嚏·······</p><p>等到可以就坐的时候，是可以用手机扫码点餐的，不过现在应该大部分地方都是这样了吧。毕竟方便的来，也好管理。选了一个套餐，两个人吃绰绰有余。</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/IMG_20210620_203827-20.jpg" alt="干一个虾滑" /></p><p>由于实在太辣了，吃的就很慢很慢，过程中，疯狂喝饮料，酸梅汁根本不够喝。吃完之后就已经很晚了，店里人都走一半多了。但是空气依旧是火辣且带劲的。出门之后，就准备出发去看洪崖洞，因为想吃完晚饭，洪崖洞的灯饰都亮起来了再去看景色。懒得走这么远了，才挑的这么近的餐厅。</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/IMG_20210620_215110.jpg" alt="IMG_20210620_215110" /></p><p>洪崖洞的夜景确实挺好看，金黄色的灯条，镶嵌在洪崖洞的建筑的边上，一整片过去，浩浩荡荡，甚是壮观，恍惚间有种重现繁华的历史的感觉，当然不会这么亮啦。甚至在桥上拍照片的人，也是络绎不绝。</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/image-20210725021557324-26.jpg" alt="image-20210725021557324" /></p><p>这条桥，在白天傍晚时分就已经有很多很多的人在桥上看景色了，等到了晚上，更是热闹，会一路延续到桥中间。之前清明节那一次，更是厉害，整条桥都封了，很多很多的行人就桥上走着，偶尔会听到桥底的地铁轰隆的行驶声，伴随着一种并不是很明显的震动。还是有那么点儿吓人的，当然多体验几次就习惯了。</p><h2 id="第三天"><a class="markdownIt-Anchor" href="#第三天"></a> 第三天</h2><p>第三天的行程其实相对比较紧凑，因为一点钟的高铁要赶回深圳，毕竟要上班的嘛，打工人，打工魂！所以，中午去附近恰个饭就准备过高铁站了，女朋友则需要回南京复习。所以，选择了就近的一家店，饭粑跎。店里的装修风格较为特别，充满的一股怀旧的气息，地面是以前的那种水泥地，墙面则是青砖墙面，没有什么粉刷，很朴实无华。而桌子则是经典的方桌，加上经典的桥凳，一个筷子盅，真的经典。</p><p>叫了一个剁椒猪蹄子、豆花、蒜泥白肉（没错又是它，而且比之前那家的好吃）、排骨饭、一壶青梅酒。味道都是很 nice 的，可惜我只是一个不懂表达美味的程序员。因为味觉跟嗅觉，你是很难从文字上表达出来的，没品尝过就是不太能懂那种滋味。它就这样刻在你脑子里面的某一处，你努力回忆，似乎也难以寻回那种味蕾和嗅觉上的滋味。只能在以后，不经意间，你闻到了，你尝到了，在哪体验过这滋味呢，在哪呢，噢~想起来了······那人那味那斑驳依稀的往日时光</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/IMG_20210621_114755.jpg" alt="IMG_20210621_114755" /></p><p>吃完之后，就跟我的无敌宝贝大可爱居居分别了。临别之际，真的有许多的不舍，这一别又得等两个月左右才能相见，多想跟她在一起腻歪着，一起探索新的城市，新的地标，回去之后，有许许多多的回忆，可以像我此时此刻一样，久经时间之后，仍能如数家珍似的回忆着，怀念着，谈笑风生。</p><h2 id="结语"><a class="markdownIt-Anchor" href="#结语"></a> 结语</h2><p>以这欢乐的三天重庆之游来给美妙的大学生活画上圆满的句号，也算是对未来美好生活起了一个好的开始，希望以后的生活也能如旅游般轻松惬意快乐无比。</p><p>未来可期</p>]]></content>
    
    <summary type="html">
    
      我和居居的毕业之旅
    
    </summary>
    
    
      <category term="小日志" scheme="https://www.marxcbr.cn/categories/%E5%B0%8F%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="旅行" scheme="https://www.marxcbr.cn/tags/%E6%97%85%E8%A1%8C/"/>
    
  </entry>
  
  <entry>
    <title>Visual Studio 远程调试软件</title>
    <link href="https://www.marxcbr.cn/archives/bd777f4a.html"/>
    <id>https://www.marxcbr.cn/archives/bd777f4a.html</id>
    <published>2021-01-21T12:09:11.000Z</published>
    <updated>2021-01-21T13:59:09.718Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>今天搞一篇VS相关的内容，为啥要用到远程部署调试，这个也是有缘由的。要不，闲着蛋疼用它作甚，本地调试它不香？</p><p>主要是<a href="https://www.marxcbr.cn/archives/109d9c59.html">上一篇文章</a>说到的那个项目，U盘文件加密软件的项目。为了测试一些功能，得疯狂拔插它，看他正不正常，看它稳定不稳定。那拔插就拔插啊，关远程啥事。其实也没啥影响，就是，有点麻烦，测一次就得将双手从键盘上挪走，去拔插那已经被插到松动的扩展坞，有时还不会识别，气不气嗦。</p><p>所以，今天还真的用远程调试来比较舒服些，那我远程部署到哪里调试呢，那当然是部署到虚拟机里面呀。那缘何要放虚拟机里面，前面说了，因为我懒。。。</p><p>哈哈哈，主要是虚拟机有硬件连接的功能啦，就是VM右下角那个东西，它给我提供了懒的基础。</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5C20629640b6582adbceaccd3871d7e209.png" alt="20210121202604" /></p><p>这显示倆，是因为我怼了俩U盘，一个接到主机一个接到虚拟机，点它就可以选择对应的U盘是否接入虚拟机</p><h2 id="部署环境"><a class="markdownIt-Anchor" href="#部署环境"></a> 部署环境</h2><h3 id="接入测试用u盘"><a class="markdownIt-Anchor" href="#接入测试用u盘"></a> 接入测试用U盘</h3><p>插到主机USB口之后，会让你选接入到的设备，我这里全部接到主机</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5C5697c5b94161cef5adf8273dd294fb0b.png" alt="20210121201858" /></p><h3 id="部署远程调试软件到虚拟机中"><a class="markdownIt-Anchor" href="#部署远程调试软件到虚拟机中"></a> 部署远程调试软件到虚拟机中</h3><p>扯犊子这么久，正文开始。</p><p>将 <strong>msvsmon.exe</strong> 所在的目录整个拖过去，这个工具只要是安装了VS的，都会有，例如我的 msvsmon.exe 路径为 E:\Microsoft Visual Studio\2019\Enterprise\Common7\IDE\Remote Debugger\x64 ，因为我主机、虚拟机以及部署调试的软件均为64位，所以选择64位的程序</p><p>拖过去之后，右键管理员运行之，会让你授权管理员，以方便配置防火墙等服务，如果不以管理员运行，到时走到最后一步部署的时候，会有下图说需要管理员运行</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5Cdfed84058b929bbf2bbd630761bad539.png" alt="20210121204536" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5Cbaef079ff6ca7aba4d33b5ca3e83ba66.png" alt="20210121203308" /></p><p>哟西，授权后，启动起来了</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5C458ac8da9cbf1ec411ec794402820016.png" alt="20210121203407" /></p><p>打开选项，进行配置，选 <strong>无身份验证</strong> 然后，最长空闲时间<strong>设为0</strong>，因为我记得设为0是无限等待。</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5C60363f1bbfee0b3c73270128c080ca89.png" alt="20210121203608" /></p><p>差不多了，虚拟机这边就这样了。</p><h3 id="配置主机端的开发项目"><a class="markdownIt-Anchor" href="#配置主机端的开发项目"></a> 配置主机端的开发项目</h3><p>来到项目配置，选择 调试 然后，切换到 远程 Windows 调试器</p><p>然后，<strong>设置好运行命令，工作目录，远程服务器的名字，环境，以及部署的目录，还有其他要部署的文件</strong></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5Ca93e8480a4835481ffddc90ab4fa20ae.png" alt="20210121205146" /></p><p>在这里，记一下这几个点</p><blockquote><ul><li><p>这个其它要部署的文件，可以自动将依赖复制过去，比如我这里写的 cryptopp.dll 这个，如果不自动复制过去的话，手动复制的话，有多蛋疼，懂得都懂</p></li><li><p>远程服务器名称，可以用 whoami 看</p></li></ul></blockquote><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5C4147c962a2f1cfd573c296316d13ee0d.png" alt="20210121205711" /></p><blockquote><ul><li>部署目录如果不写，会无法自动部署，如下，灰格子</li></ul></blockquote><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5C1bd04a2646632c1cc9fcbb744dfe24ac.png" alt="20210121205846" /></p><p>配置完毕后，选择好要用的调试器</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5C783dba67fcead5c2f6ade0398ff494bb.png" alt="20210121210628" /></p><p>点击调试，启动，芜湖，起飞</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5C3955be342d68de0da19984b11ea54c66.png" alt="20210121210726" /></p><p>往虚拟机一看，芜湖，坠机</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5C36313f3058f36377bc64d223193d38e7.png" alt="20210121210806" /></p><p>好嘛，忘了将QT的dll弄过去了。</p><blockquote><p>这里有点儿小坑，似乎是没法将本地机器的目录在配置里面直接拷到远程机器的，为了弄清能不能直接部署目录下的文件过去，特地查了一些官网说明 <a href="https://docs.microsoft.com/zh-cn/visualstudio/debugger/remote-debugging-cpp?view=vs-2019">https://docs.microsoft.com/zh-cn/visualstudio/debugger/remote-debugging-cpp?view=vs-2019</a></p></blockquote><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5Ce867a4c9852add47cc37a9ad289d4ecf.png" alt="20210121211118" /></p><p>所以，远程机器并未安装有QT的环境，所以，是不行的。那只能指定要复制哪些dll过去了，或者手动将需要的dll复制过去</p><p>那我又不知道缺失什么dll，一个一个点确定，再一个一个复制过去，那不显得很憨？</p><p>所以，就用QT的部署工具，将依赖dll全部给整出来，然后再全部复制到远程机器上</p><p>Windows键之后，找到QT的命令行，然后输入一下命令，当然你得换换路径啦</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5C284d365d9c9c79bd8fe20f896f1c597f.png" alt="20210121211751" /></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> E:\Code\UdiskEncryptTools\UdiskEncryptTools\x64\Debug &amp;&amp; windeployqt UdiskEncryptTools.exe</span><br></pre></td></tr></table></figure><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5C1bbe0f12817a0cae1f7d7e8b06110743.png" alt="20210121211940" /></p><p>自动打包后，依赖的dll就全部都在这里了，来看看目录</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5Cf4af783e032275ae90f3fe577f79fa76.png" alt="20210121212033" /></p><p>没毛病，将这些文件全部都复制到远程机器上</p><p>再来远程调试一次</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5Cf9c360223e23fc6885dd3eaa60c8a63f.png" alt="20210121212430" /></p><p>好家伙，还缺一个dll，ucrtbased.dll，这家伙在C:\Windows\System32 目录下，手动复制一下到虚拟机上</p><p>再来一次，肯定可以了</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5Cb5279a1d12f84733555c2c8eb3cee18e.png" alt="20210121213149" /></p><p><strong>芜湖，起飞！</strong></p><h2 id="断点调试"><a class="markdownIt-Anchor" href="#断点调试"></a> 断点调试</h2><p>在 处理插入U盘处下断，看看是否正常命中</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5C0259856f083dcc6026219dcf6584fc1d.png" alt="20210121213327" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5Ca845f1c1fa118676e8cc32fc7e7ab262.png" alt="20210121202534" /></p><p>这里要用到前面说的，将U盘从主机接到虚拟机</p><p>然后可以看到命中断点，以及调试信息什么的，都是正常的，岂一个美滋滋了得 ~</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5Cc1a4fc829b01dbc5494cffd57228e3fc.png" alt="20210121213535" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5C8017c656ba98e41a3797d0b4c0f1fe26.png" alt="20210121213612" /></p><h2 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h2><p>折腾这么久（其实写文章花了不少时间），就为了节省拔插U盘的时间，顺便复习一波VS远程部署调试的小技能。哈哈哈，阔以了，快乐了，调试去~</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5C6597a437dde934717c9610a47c6c0d3b.png" alt="20210121201216" /></p><center>要是感觉不错的话，就留个言评论一下下呀，欢迎各位大哥指正</center>]]></content>
    
    <summary type="html">
    
      Visual Studio 远程自动部署调试软件
    
    </summary>
    
    
      <category term="C++" scheme="https://www.marxcbr.cn/categories/C/"/>
    
      <category term="Visual Studio" scheme="https://www.marxcbr.cn/categories/Visual-Studio/"/>
    
    
      <category term="C++" scheme="https://www.marxcbr.cn/tags/C/"/>
    
      <category term="Visual Studio" scheme="https://www.marxcbr.cn/tags/Visual-Studio/"/>
    
  </entry>
  
  <entry>
    <title>解决 C++ 在调用 Cryptopp EAX 加密模式时无法进行MDD动态编译问题</title>
    <link href="https://www.marxcbr.cn/archives/109d9c59.html"/>
    <id>https://www.marxcbr.cn/archives/109d9c59.html</id>
    <published>2021-01-20T13:38:00.000Z</published>
    <updated>2021-11-15T15:34:49.225Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>许久未更新，实在没想到这一拖就是几个月，小半年也过去了。这段时间，没能坚持写一下内容出来，也是没办法。工作了，就没有了上学时的清闲，但是这都是主观的。客观上还是有时间的，只不过是自己懒了，嘿嘿，不辩解了，回到正文吧，看看有没有小伙伴遇到这个问题。</p><h2 id="问题描述"><a class="markdownIt-Anchor" href="#问题描述"></a> 问题描述</h2><p>问题来源是现在空闲着写来玩的一个项目，主要是做U盘文件加密解密的一个小软件。这个时候，就需要加密算法了，我这么懒不可能手撸加密算法的，而且要是在加密的过程中，可以采用多种加密算法的话，就更好了。有OPENSSL和Cryptopp给我选，然后快乐的选择了Cryptopp，以为OPENSSL在大一我编译它的时候，给我留下了不少阴影，哈哈哈，当年可真菜，虽然现在也一样。</p><p>看一下导致问题的代码,摘抄一部分如下</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">typedef</span> EAX_Final&lt;AES, <span class="literal">true</span>&gt; aes_encryption;</span><br><span class="line"> <span class="keyword">typedef</span> EAX_Final&lt;AES, <span class="literal">false</span>&gt; aes_decryption;</span><br><span class="line"> aes_encryption* encoder_;</span><br><span class="line">aes_decryption* decoder_;</span><br><span class="line">encoder_ = <span class="keyword">new</span> aes_encryption();</span><br><span class="line">encoder_-&gt;SetKeyWithIV(aes_key_, aes_key_.size(), iv_);</span><br></pre></td></tr></table></figure><p>然后，编译的时候，快乐的报错就来了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1&gt;symmetryEncrypt.obj : error LNK2001: 无法解析的外部符号 <span class="string">&quot;protected: virtual void __cdecl CryptoPP::EAX_Base::SetKeyWithoutResync(unsigned char const *,unsigned __int64,class CryptoPP::NameValuePairs const &amp;)&quot;</span> (?SetKeyWithoutResync@EAX_Base@CryptoPP@@MEAAXPEBE_KAEBVNameValuePairs@2@@Z)</span><br><span class="line">1&gt;symmetryEncrypt.obj : error LNK2001: 无法解析的外部符号 <span class="string">&quot;protected: virtual void __cdecl CryptoPP::EAX_Base::Resync(unsigned char const *,unsigned __int64)&quot;</span> (?Resync@EAX_Base@CryptoPP@@MEAAXPEBE_K@Z)</span><br><span class="line">1&gt;symmetryEncrypt.obj : error LNK2001: 无法解析的外部符号 <span class="string">&quot;protected: virtual unsigned __int64 __cdecl CryptoPP::EAX_Base::AuthenticateBlocks(unsigned char const *,unsigned __int64)&quot;</span> (?AuthenticateBlocks@EAX_Base@CryptoPP@@MEAA_KPEBE_K@Z)</span><br><span class="line">1&gt;symmetryEncrypt.obj : error LNK2001: 无法解析的外部符号 <span class="string">&quot;protected: virtual void __cdecl CryptoPP::EAX_Base::AuthenticateLastHeaderBlock(void)&quot;</span> (?AuthenticateLastHeaderBlock@EAX_Base@CryptoPP@@MEAAXXZ)</span><br><span class="line">1&gt;symmetryEncrypt.obj : error LNK2001: 无法解析的外部符号 <span class="string">&quot;protected: virtual void __cdecl CryptoPP::EAX_Base::AuthenticateLastFooterBlock(unsigned char *,unsigned __int64)&quot;</span> (?AuthenticateLastFooterBlock@EAX_Base@CryptoPP@@MEAAXPEAE_K@Z)</span><br><span class="line">1&gt;E:\UdiskEncryptTools.exe : fatal error LNK1120: 5 个无法解析的外部命令</span><br></pre></td></tr></table></figure><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5Cae5633098a85569d03cc2bcda9d08b9e.png" alt="20210120205550" /></p><h2 id="分析问题"><a class="markdownIt-Anchor" href="#分析问题"></a> 分析问题</h2><p>在这里可以清楚的看到它提示，缺少EAX_Base类下面的SetKeyWithoutResync、AuthenticateBlocks、Resync…这些函数。</p><p>跟进一下 EAX_Final 这个类，可以看到他是继承自 EAX_Base，而 EAX_Base 又继承自 AuthenticatedSymmetricCipherBase, 然后缺失的函数都在这里类里面。</p><p>部分代码摘抄如下</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">CRYPTOPP_NO_VTABLE</span> <span class="title">EAX_Base</span> :</span> <span class="keyword">public</span> AuthenticatedSymmetricCipherBase</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">// AuthenticatedSymmetricCipher</span></span><br><span class="line"><span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">AlgorithmName</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">  ...</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"> template &lt;class T_BlockCipher, bool T_IsEncryption&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EAX_Final</span> :</span> <span class="keyword">public</span> EAX_Base</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">StaticAlgorithmName</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  ...</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">protected</span>:</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetKeyWithoutResync</span><span class="params">(<span class="keyword">const</span> byte *userKey, <span class="keyword">size_t</span> keylength, <span class="keyword">const</span> NameValuePairs &amp;params)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Resync</span><span class="params">(<span class="keyword">const</span> byte *iv, <span class="keyword">size_t</span> len)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">size_t</span> <span class="title">AuthenticateBlocks</span><span class="params">(<span class="keyword">const</span> byte *data, <span class="keyword">size_t</span> len)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">AuthenticateLastHeaderBlock</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><p>好的，有定义和声明的话，肯定是没问题的。再编译一次这个cryptopp.dll看看，然后再编译咱们的项目。依旧是提示缺失这几个东西。我。。。。</p><p>不急，一步一步来，看看dll里面有没有这个EAX的东西，用DLL Export Viewer 打开 cryptopp.dll看看<br />太多了不想翻，直接搜 EAX</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5C02a4a438a29d2c02222c9edd0452de22.png" alt="20210120211829" /></p><p>还真没有 -_-</p><p>那就说明了，编译dll的时候，就没有导出这个函数，那肯定找不到符号嗦。那我们只要将它声明导出函数就可啦。</p><h2 id="解决之路"><a class="markdownIt-Anchor" href="#解决之路"></a> 解决之路</h2><p>来打开cryptopp的项目，找到编译dll的项目</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5C043e62dcb921f27b7515c221f4b8eed5.png" alt="20210120212135" /></p><p>然后会发现找不到eax.h 和 eax.cpp</p><p>所以，手动添加进来，添加现有项即可</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5C9c9695d0a64d7750d47869e77658973d.png" alt="20210120212307" /></p><p>添加好之后，兴冲冲的编译dll，然后去编我的exe，然后还是没找到</p><p>淦</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2019-6-9/VS%E5%88%9B%E5%BB%BAQT%E5%B7%A5%E7%A8%8B%E5%B9%B6%E6%B7%BB%E5%8A%A0%E5%88%B0GitHub%E4%B8%AD/1560080829083.png" alt="" /></p><p>所以还是有问题的，回去看eax的源码，比对一下其它有导出函数的类的区别</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5C43083492c6b5d115aceaed9cdb13ae63.png" alt="20210120212555" /></p><p>答案是一目了然的，它缺了一个宏来修饰，以下是这个宏的声明，是用来声明导出的</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#  <span class="meta-keyword">define</span> CRYPTOPP_DLL __declspec(dllexport)</span></span><br></pre></td></tr></table></figure><p>那解决方案也呼之欲出了，将这个宏加上就可</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// eax.h</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CRYPTOPP_DLL</span> <span class="title">CRYPTOPP_NO_VTABLE</span> <span class="title">EAX_Base</span> :</span> <span class="keyword">public</span> AuthenticatedSymmetricCipherBase</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">// AuthenticatedSymmetricCipher</span></span><br><span class="line"><span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">AlgorithmName</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">  ...</span></span><br></pre></td></tr></table></figure><h2 id="编译"><a class="markdownIt-Anchor" href="#编译"></a> 编译</h2><p>编译一手</p><p>8核16线程的U跑起编译来简直不要太舒服<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5Cdb7306c6d5adaee5bb4f13ebcdc46ab2.png" alt="20210120213126" /></p><p>用工具看看是否有导出函数了，可以看到找到了，稳了</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5C548cbb5b43a06a366baf3cd9765fddad.png" alt="20210120213355" /></p><p>编译项目EXE去看看，也正常起来了</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog%5Cb8c227fc21a149d2d1403156e53d71b4.png" alt="20210120213602" /></p><p>嗯，差不多了，问题解决了，文字也到这里了，要是能帮到遇到同样问题的同学就最好了，没的话，我下次扑街了也好看博客来找到解决方案</p><center>要是感觉不错的话，就留个言评论一下下呀，欢迎各位大哥指正</center>]]></content>
    
    <summary type="html">
    
      解决 C++ 在调用 Cryptopp EAX 加密模式时无法进行MDD动态编译问题
    
    </summary>
    
    
      <category term="C++" scheme="https://www.marxcbr.cn/categories/C/"/>
    
      <category term="Visual Studio" scheme="https://www.marxcbr.cn/categories/Visual-Studio/"/>
    
    
      <category term="C++" scheme="https://www.marxcbr.cn/tags/C/"/>
    
      <category term="Visual Studio" scheme="https://www.marxcbr.cn/tags/Visual-Studio/"/>
    
      <category term="Cryptopp" scheme="https://www.marxcbr.cn/tags/Cryptopp/"/>
    
  </entry>
  
  <entry>
    <title>我的大学(︶.̮︶✽)大三</title>
    <link href="https://www.marxcbr.cn/archives/c6a55137.html"/>
    <id>https://www.marxcbr.cn/archives/c6a55137.html</id>
    <published>2020-07-18T08:21:54.000Z</published>
    <updated>2020-12-23T13:48:32.322Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="抱歉, 这个密码看着不太对, 请再试试." data-whm="抱歉, 这个文章不能被校验, 不过您还是能看看解密后的内容"><div class="hbe-input-container"><input type="password" id="hbePass" placeholder="This blog is encrypted.You must enter the password to read." /><label>This blog is encrypted.You must enter the password to read.</label><div class="bottom-line"></div></div><script id="hbeData" type="hbeData" data-hmacdigest="62729966482d85f9c91b73d3fa6994bd86ceba04d91b13ab09a2057251c10537">bef36e4a47b53f3e932b91de681e5f361b841e79d3769ea8864ff868cb4c201807814c96431ba554964c3bffacb4c15f1db7ca81edbd840b209fd1363a42c695d2b51777e3166eee62fdddfd2373586d4c17f6b370bb2e1a3ba99fca3776ef0725f9c8b85680265627bb6379a5ba111a1699adc950407d317b1e3b73ba4e9467a91437dc1b11e1a27e9573bfe6fd0cd2b8079bc88cda99645f18822fd7b1ed10f2f2033aa0063bef89fe45fca153ae8ba0714d02cfd746a75eb7e11bef6d2f590a5bb0f32aa0fc4c655203a3c89dcc86cca5c427a4132ef89086e508d46cf2d8c0658db7c14a56870b15a93463566c334c84406e8681baf9ef4eadca1eeeb090f49ca007bb287b54394ee2d708ca5e3039bbcce6361da766ce56bc9b3b8f63aebffc30ec644f1fa255055f6d213f42b02b3f5920d2ce9b8477166f4953078ebc181c6e545679740edf8cd8a18d95db576c67e85ea545185f52b61e2ca418fb8267ce3546a6634de3a4b09074438845d4a80d9ee06e806090450d82027547529750ebb3be62c1ea64dadb8b3c3ebac13441284f4ecad00b6f866f7a052187c25d2bbcf3e1b1645f76c26f8de0923fd01a5c37c78cdc37a1789a87c97f7cc69ecd79314fd4608331d91efe204a9913473fcc5b80a9bdcad8fcd540366cf76ce24e08782b8bf9c864ff10f0373b126d0ef0cefc377ffd35491890a6de6d7b8aef7c28066390256567f09acee1bc24047712c325637fbf09ede7d6f2872ea1f7d2303f2f2dc4e07019756367f043123b3958ad34d731a601943abf64acd4da0b2ed293611530efd02c394666a0f9af1e0b758d472292a92c2e8b33820677066c288401105b3285929749e2f6baafcf1132d83f5622a087243c0f45b9a2acfbfb43d640123807cdc7ce300671413414aac5fa72f06ea66f9ddfa0a45d331637db6c8d53e00e3b6a41e27a4ac304db899e8c103b89b5f551e87abd20ba76b6fe8860f7aa51e69a214250541a09f8ade2ec45526661843e312a1b88a69ae7c705ae8d39e1cacbc235c45dcae7029f310c1b67b659f5e555f562e0d0b7e8e5c698308212848d41a3ab8c8f08778c8df758be71c08fcba57c950f802e0312c2412ee669e9e4e8b5bfe9faa13e58432efe2ec3469bfc8ec7caf8115a516c4b765db57b9da50c0c652ee6e3e3ac363f767b4172e48d427180526db972afa5a52a95726cb1081ed4b495c078d6a947170cbd9df932c94a082ab9ff461c3032cb7d3a0f6fd8533288a9cb83fafa110b264c5bc279ca8d8787c88bd2fc28f011d2f1eb72f7f587d80e3145d0ba6ea42ba99483b2d395efdfeb2a630afa29b35b98eea61b67ccf7756b3ca507980ad78cefb27e09ada3a48ec16643447a10cbbb90b4c653a77d950f5a34dfc19b2bb709860eb45bfd39193e87a23c994ebec69f68c7f3e3d8769d049d85f1497da2938b9a84e3e06d16796f738a6ebff42827737424161e6b2a1293b6d36270c133f835ca137c7b1bb78109f5d078dabc72fd558de3dcde137d3b45d733d7d657ca150a91c924c27832be3ab2c75e09a2b927060c66d534fa9bf81a985bb754c2a36b18945591ed85cc3204cb6a70673499a92dcbd2ecc7bd5f5924148731cfcfef5d505da99fe6f15c58b1cc53c1001011809d2c23c88f13f986bb4d34d74fab5ba8a2ff1681f2eee641d68cd794cc5ee0ec1dadf1c49b30a0078c6a9fe7d3001e34a12b6ab83e6545d434c7392e05e60e6a4a61a49c2254c946822f68315ddfdfcfb74cabb058ec562eafb1fbd3a574d2eeb1ed3469ac12bfad285a3e0ef8843e6e3c62589bc78ed69cc2ec10ae56b0fe918b74acf96281d099f4a2c75dc0b049e45eb8dc9eeff600a708225879770e81c4a8832f4bc67e448004501be89b7a9d94a7e1ee8ec9db8aceca2dc033f573b20cac22559c08bf6181473c42e5f73c2eedd8fcce755e2c4b813fdfd9a56562ae276af90254f75028d12816b9e4b75134a23544adaa38cca073edfe7b90bd16d0401c3c875d9bd8888028f4cf54a5e35df53ac93e80cec143f645ebc362d20b6cf942cd33b5d8a967a80f3ba41d598b04c0b5e02654db457831e53f36f35549b825e3f754b9dee8c6643c85912c2a8fa527140d658fb1e13335e54e85fdc35ca5e672c5a429a80b4a490b5fc2a9864a243cadc89e35cf3a9fbe5200a86092705c09d597b904fc390e46c3549346a0635ef66c251a0ab65be6aea76a82f8d2d0a15c67a2a030ec3e84a182cd4d318266ba92f9806a77051654d525b0d783669928fe85a9cef9e09d39dea5b4583680636bd2be7081af94ae9dc4a54f98b96ee206147f638d672d5d0f980df3ec5c5722dc6273661ea704281ee3a748c7e41842990c0bb7b2797bb226be9c0d8e90f8be9344e2e9edb50c04a13000e9cc13655f16e9c367bcd8dd2d96544e9342ebade8a5266014d684394ecaf3ac3cb7d35692bdc93bf1620650dbb0d1c10d89d67fe95cb4c43a192022c1caec2410d75de7b3f88f62307e4964fe4508b4aabae70d318bcbee22724c4048ee4f933d67985b56e8101c991ec5651af8932fda954cecec94f41e0c36772dd355cb89167d644707aea952006ac695b34aeecf5b8f3ad81ed7bd83bff67bc86a9d2a6221be54763507b07f58d6a874008332dd8b91f348df8e0318fad049db1954875e2d52d8ff98676839492adb61012c096cf6305a1b02e7c39f38894a2f25d596213dc98e4195809e0526f975692a227c9a43a73d03856adef4e20d098b0856d2b678c23a58249ab4260b0d7728d3f3130ad992b9b1f255f1808a1bdce78d5f15b5e8b81b2d0e16605f03ccb34858850c5f28e5b48d697d6fb9af12b4b83ed9e6e6107ff6e11a54c55a80bc99d3c71f9bc35e78f4c87344cea88f01a7420626d16aede426909ef62d117e1b5b2f080b3e6f1277ceb75a91b0ffb6f64331d9b760a9bea06ac8272367c209850f64814051d0db53ca644474c37420656a783b5b61c558d9c977496ffb6f0aab492b15fea58e53bf34c25805d2fca79e9cd6979d232a15f2dfb0ff28936ca7e65539b347ce325652f650f991801364337c8266363c9b425635f75c58d36dd9aef70f2c7a7d5ea463951913c97e83e8037099cc010a40b99c891dc897f0c0baecd23985aeb4cff0482d1d9d5df424ef029d2f5a3f81236fadb25edeeb24f1fdbb1cbbdde3e7ae8ca09ce0d4d12269da95796b1bf707e6834c778316b815073c3a73b3c5df57e9c641dab4d6dece4eeb8e2ffeac323b153b2b149032213f7cc7f294e933f4ad56fcc4f9fd5feddd4f8e77205cb3bddf10ac43e1baa3d8b1838c0dcc50f54867d714d28f4a29a4e379161f3fa9247153805de55051aec89596f3b3240c8775df8be7afc90173ef75818018762f0ad8b24adb91405961941153156f28b4550494659ec5789140ee762bd5cc04ad461b0b578e3f3565a3fb32cd979376449996c13578ac219a54853515e3d215c13259a908f4b6ed83371625b8b57be5ba1979a81c3c17246c0ccc4bd413301fc1b6f3d41e2b35f30b1f5f1cac0820a6224c2cb2752e45d583aec090f8442666062c85ede60fc43106a2c7863c06d743fd266d07d26c0381ce5cede800d0b6926b059f8ed373d3d7ec95e334fa59524f173372e1c3ba3a640193c0a5817c37e98873b6a9503abb470b71f9a25362c74cc9a7c5ac488183b515065e15fc2e77d65db9ce27380792fc90f181c72bef439f13af8a19427a7e5b9be21667f2a8f56c69de53f826f3c5ee51a87b8f26a8ffe4334eb248aad65a3ce0c1c4b69a7259d09ef4786334acafc9469661019f243dc5282dff44ac50d1a9ce840e7bba8ccf18e46414e97bb4cc068d7cccefeed29b67890fbb8e983a337115c5e21b63e8ccd8b62b1512080e5e48b15dd1a9126ac5dc18d306e1a6e74ba611813762e9c461629cf054650857afe54c932a652352ed18dd87e4ac66552d80a8c7e34b9845de88a02b7218b03ecf2ba9834f03c27f462e2775a11367f0b45588daeb65ab0624e485f68e85056f53f0fe08b306093fb1efc632295f6fb24beb807586a9936f976891064dd72fa5a72e218e1d7a92e4d9c5fd74c8122cc8d33976a8ec81add7fb2c2240ff1a280c6c4cc07e99bd9fab36388a5cf5b32fcf45f8d0f24df04ecd4783849ed1d26ca4f909315ecb7dde4f75c241f4f30889229fec7692dff0399a4d0063be5f499519a97684dc6ba4dc036b9c3ad085e9d794759bd13a36be398aa29f25bdaa80d5b4fe5ff885bb30e4760b091f3552810018e453ac4a5fdd8d6e14db2ded12089c06aab37584c027946a9631eccfbc3d1e0bb3d6be92854c2cf22bb25d6169c1d45136bb30431786128519bbfbd7fb23f44046d54f8b393fb7e9dd2733d7914326009e0fe1953f8fd56674d477c82d8834a55bff18d05181d8971edea1c304ff457c5de61552457d7385cf4567a8453f7fd7754b4ecc85afd02798e82e182a5d230d21bd101f7074abb0fcd0a34df11002b5eecdc46ced834bed7e1b600349e8aa7af53c1c8a745f9e1128202de0cb14520fa27c02a7ceed9b0ccf08fe1c226ec0acbddc3f1d30eae82a78e054ca112242336770cfd502def53433d883c35bfbaba1df270ecee08a8b0f66a5bce4623d4c22f5eeecae82104f259b107ff5d11afe4d15d0bdbe1cc7a60924d249bcdef4a552d8f8df8034083a70741be2ce7b46ed5f162df864c9b1acbaa99b956065ba21aca72d02fe9b0bdddf653a9f3500221bf4ac1376a4e369dbc4d7310ec29e4c4a0b1292b545dcb68e266f570c9370c6cf5ea490473680dc66ee8f82f26e922da7288e34297330d4a3962de6c1c7e1cfdcb837fed57a61904e25f71b2f5ef7f54f5edae9c4bec44fc3e11b841f0ec590eae0c002d974b7e1c5cc087fd4c4b1333e3629f895f330af8640a31b97a8f8f32c936d11d93b9e4df068059c193a9b63724817a9b1f4cceeac15f7ff08777992ca54fe729370d49428ed1d45fa88f1bedce0c7403bdd353f93654baadc202de632b08d1ce8922a876dd7d42f7ed52d64573f241633e6798849a3d41d91f1693fbca7ca1b3ebd89cb173b6bff81c82ab7bbe8e973e56e01b6ae4a2a716cfc0a0ce5eb22c17aa27c7e7b379329ab0bb3afb904937ce4eb94386be3cafb2afdc2ec252018548092df0025f03aece6d53c699fd43da2459def441ee71dbe32abce5d1c04b149ecba9a9cb952d795516c92b4497ad0befbe64429033681e4743373cfe77e2aa94dc8818815c7aa13bc9eb65f8fe08f2b81321270a0d8568b94612836cada42cbb0d5a3243ad8c6b0316c99eeec41b5234e55ce34ce97e34731d4611a840a59855618755220c3ea32ca2dd9279cb375c369ae85a6d3ca29e9525a155ad22cb61086a28c30e0362a76aeedb0bc8b3b89152c453e74ecdb24af9a73de414a6a7582a26159b8cf88f54f4ce708ffe6981df7d768e8b4aea6b1a65d0db7243945e5ce7a1c175a190c6e75056a13f12c0b75a5b0092524a29c0b9d0da84935732818cb79ed51fdb046152993782c215859f340758c667de2c02915bfce1647d06a6719ce4894cc74495261eda2aad55a24c101fab8687d5b6bd371677ef372b59e8e703128872057b518e0024cd7429c15439f5fa5289bb4e5223a5dafce07dea556965ac2ed22d1c350bc9f6c7b4883f39d255c60014bba00557b7f540db3649e3f3ca22d1e31ed4c3cebfa74d1a18dcda8568c4739a5477fb7ab16681c2f49e6e31625b82785b7f83c2b71515f3f99cc0c3c20e3e2da1492f1ccf1cf9827ba266ed44dc816fb0f11af1f8ee039581252a9721dce02b6e2eb3bad60ed4d603515ed0c6a0502028b59183b04a026920ab8bd6bd86a3de81baeaacab2cad5024ebe3fa7e28a28fb431bc8b4815f06294d13a484e8608ecc386094f2751c2584fb78e79430bae6495c4af6cec170887a3b4fb137f3c50f72366b2a7e5bc64c85afa3e2a4819bd7376df2584d67d08e9f253beb22488f593e5fa0097e34c4a3aadc03864465c69d67084a7d197797910f0a81b570b0197db7a8c7971e659ce5dbfb2c0106a0b9c3d9163d4b4c699935a553a7d8cadd255b86433edea005c3b25ad74f6d8877019e3c72a5e151eaea3331c7f1beccfe597f501e3c539b8d8552e0f7e8eeb2e96d17b9fd3da83e1f11ce5697cd695bb4babea3e098429f0b21df08e476d2ad1edb538c3c519ae52a7f3bd16d6a6de680e0a7187ccc14dd64769d99da6909511efb4804c59076b8650958af1a66e3eaf9cdb3b3007a6ed619337d249832331e3fc01bfc2b2af8d42bd38c713bfd648fb07c4c8746d144349780d19846af0e113d5b4b8bc822e95c3e364801b0a3a92a25df727081acbcbc3d5b54fbc4fb1349dffa42491f6ee9888ba92ea0f7ee6e8cfdc8c3275b8fd902317c3792553e3e211942dc687414dbefa563d07cdef67b529d595656c3f4ae03d6ce19c17d6e5e60d6221e184f7069cb6a2e55b8350cda92f941bcdb5b82b2a667730a711209d2e8eb083aa3870514f9171a4389b1a33d11f73982eee163eef60b627d8db66d5c6436d36d4f573951ecc82419ed08441c0cd45f934abe998e9407112f6d59756d28a61dafb207e165bff74441b9a8aa163ce4ab4b07aad1343922b367b938e59e1d6ba65e27e4818e80a6ca0e27e69bbd9be012fa44b40bc3f85396a22ca4d067d4fdb53b2caa770a5aa17565c4066d9842565022a111f32921d8f8ab3274760350fad488bcb0573e2af595c1f24289d8e7fd5f5408078c3c41f8cb81842e0276f7b5a785262fe25d2410a8f39c46d574aef2e15a73b787d02a866035bcb90b4e9204d3bfcffdcbc8868e7704b5f979aa70e7508493984ebea873d4083505accd0d6380ec609c473937595d89f39d40be2166bf62930226c454452137abd440851bcae20d4b68472b9bd37dd1dd854f6a4440e2c40ae70901779810cbacea8479519bc1dcede6ac2fa7c44e8d7a69e13f441394ef545b6477af5f2ae8054a87569ee72c3fd172d5703e0792c54943707e59e090cc7370f40e4667ad8a0c492a1dc0be8e5dc5b4e2491a145e3e26f3eddd602796daa7dbadc034831b2c78623a46b045c9d0fe0a7d03c07c44f0d3ee0b83cc4ed12e203ec6a67434e8650d0e155292a5d2258ef2a6b3fce39306dc3d2dae9a68b445bc9fadd329484197d067cfd4ced3d1bde3e236fffcb69cb97ed36ff5ae31ac3f18f3e8c5c29028a3d492ad2e774ae15a4a45549ebd465f792d3d0aefeeab8da4b81912c87697d3cef2125f7b0e36da4c61b1b12702af1dd949b9e662f4c87e8844a949925f5e4a18cd5d7f1c2f5d9737cd6be8aaa64ea50d7dad30f73ee0865b72db5a05b60c857908d6c25f7b41f795acd4b26e7e87fe57edc9a564d3bd16bc24be206b2b539ff31a62f557592b16113c12f1d256cbb5fc5db6be9a021a55c970ce4696fc68a593be0ee9ef4ddb038e2d2fc719a29923a5519fde6fd0bc1110b731954f0446a6c6d960c8226e1a1250fe05b8244e4b7cbb05182e2309b8ab2174051475edc1f521daea5c22d58216deda662af853ca5738dbe26ad170c0e7d9e8a25a89f7efc00ae5a33993ae5552f11674ea3a94a06143958f01ab0f23d64bd07a9135b7248d180333018badb0c04be9852ba6be25249c7fc11257cc72423f2b22dda47ab17550384f368cbd1d23a87db5ac15f93c0080447b33718cd9009cff0fe8c991db97d892d57a18343f1bbd40c4f4d244ca9a1870dd53be65bc7ff9a73d0b8233b45a02dd66fe301e75b9e164741bb4ef6d1bdeaad2f0cd430c4b099636f9d0d3a5d688920b702f5977dbeee1e3438d9941fad1a1b7f3487e9bcb61b1e64c97cc2691f7b9daa62d11dbb85caacd9bb9dd257fb7e2b0e467f0aa92bb472da2be6e469ff03334754522979293a3e8a23ef3b693b022950c2d05aabb2edc5d0dae0ae496ae187ad69853646be04e2545eab72ad30025b14d38bfdb4e76c689480836352f0ee60e843ab2bc154a70835d6615b714e206d292d82fea1ddaeef2bf3683de00febdae7aacce20da9f117c7e52bb5f64dbf464931c88eacf129dbc2125d2f77d1ba49f10883e5a462a3b5b7c4855b9394a05420b4ef97f3559a4b15642a3abb47897b32133756baf41b1f0e6b84525d7daa2e78328db460324938da7f79e4465a44ee667a67d800c91ab892dac696ca3afc0c1b7e4ee50d881e95f74ee9c4cb61089a2fce7ca40b246d1871ae60d933e2d767a20a6ed365d21e533f2a80c1ccf1d3894ac9f08ba64dc0fe897b41d439d0f56f83b4cfdb13d35b7a1c343b7ba9c590cb8f17060cdc421e15fe66f6d4880c88173b3e035d8c9ce41117e9023d182e55eac9ccde4a3893ed61be472d4ab2f0a21653477161f528b664fd85a87d838b2a453a2e04b4d6e04cd13e54c4e43d4ae8f1f3ddbd03ac933c7cdb1f4d7e56a537e5b1739d7f44b555bedb7ddafe50126cd7c6fa7604e3ab5ad46bec7ad7f7ff0eeaa68e16795cd001119be93821be0caaf931f4a2747aa1e4a1b9dd868833f3cd68e16dc67a3998cd24eff4506030264bea61c7e3862db0b2850fae538e3a00ebf29db59af9060dea455a574d9cf67a79def46dd43771965ebf58a03bf86c5ea8e53d76de9ca7fcd5edfc4dedd427116614f397a323874030d9a94d98d1c115ce301ec42c6014f1293a3960e2390f2755a236fa402af11cfd0d87c11e36fee5b3b81bbb18ec5048ec43f4c196a491eb6bc01e1b7de337971d00dc6b66f34202d071d6c795aafb05141998f6af1ea95bb726b89712f1d19026d0dc756bcedafaf39801d43e86b8048fb7476ca1c55cfdb7aa9a209053da0afb2a1e0a233496381da030be3c568fe83d7f9b980874be94c7eb062988edfaaa036ba40cc6143997f63e9575315a5b1a126fe7636263edd8370cf76fd4438c22f6f92e19b2b9f1455659a0d1ff3ad90631bd75d23b7225c6c8993eaa4a45ceffbd95a454a0e665226e88ff8b7f45a14d14081ab6b0d36357e3af62044320cf4c6178f64cb13ad0e82a4533eb47b1098ba6261b28b387d71a0f775fd0b07fc4ff197aff031c4b4f24ffd09aaddf60fd844e3037ad4b598fbd985f7642833559e3759dbdca05cc9b24818db8afcac5f5782758af79ea28e4df0284e1dff886d0c10ed1032540acf461f9b0581de0afca0f155de87f3b4a860b76c77aae109c4d99b6286f63ba8f713a884168385587be2377903132a16e3e733082c55bd2d0fbe27a80c60ca83c8e0a665ad7213b04f4fab273cccc7a90c3033124a82a753edfffbc7de912dd6ac428d32d6963c01fab1b953bbed169b39af8fe4ec18d3e342a631ca83dc4064e2169cbc4d491c33f60674e0e6ba8dd2bb36425abab89c3e99c8ed6e4531167b16df8a35f58bb7a93d22fcbda3595a56d99d4e630ee4a05edf38aa43995a2941c3eb977191dee4f8de562ec383a4b76dfea89575eabe3b1fe3ffb7faac4f4b4a24cabc95f6a908fc980def7a3336537bf14af362effed6e40d32c21d1281b6d86b43635103e0b2b9b9b145b984b52951bf6e1c4ff15192a702853fb4129279a8adeffe87a61fa606335aa55547884373cd2d2851500db5bf17443e2330920e6556c21a98b97e9c489410e38c15879f5cab28e65996754a86440d7c92e3944c7db769f8110b492477261e7ef8e6507f77f1579112fa95f7ab5a9547eb81dd0f5ebd8c60bf17a92e3ddd35f049f22f064f3cef56257d6d6a4eb5ca3c55da6bb1865f9d4f433f6dca98fad743d3755c540f6162cb457b618de7947c49b9b48abf9a763ec5dc2e2357708122a9bdf0e54ce6090015539a489db25931d041c92f5c7b50a1fa81d5960303d1f588ddab8ae994a2d52b18266d96091db4b4daac5482d1e4d265ebf02d0fbcb446ff1897785703aed70d21c879752ecbc69582a8cd70ed2be18042105cd6bb348fc6595aac4f86f496add7b564182707f875f41d21efc58cf339a528a1628c542ce7102864ea8f1d9eb0af683a436f00953b8d10541e0b31cff498b21e547962d0e0d7bd3842123c80d84dfd006bbc08496b0e68af2623eb376b2e659d096cad60a7216ed4a89fab17ba059195483a4b43b9da2228ce275efb2127d94a1dc2c59ebd1400068c8145fcf20a1a9f5e627cd85b2eebdf70d92a9885c3c965b11ee92efea5febf323d7b8894750de119f06c671b7afffd15db41cf0624f34bd27370a66d88d4bf73338914f81b0b1947c1353758c8051c21bc0873e7ac9ce1898cf9f1a4277711db58b4accde78bf30ced14672aaac55cebbb29a9e2e4ed59c1ee9170b211cf45070c2acd0b8976f3a73931533244d541793d38c2c6ca0d5c80de282f313e9824870bbc0d7f47146ac8ca512afe9b3d091c789679a2d37649864544b482898b3274434d96c07496d45747ddb4394cdc85cefa436839fc485bf695ba9f6559a0e8d483bc9d33bb958dac0a56ee3b29ee2d6516929b5c36578905d45fef6b670cbdff9f3d82e80b6b813d8b19f7fb333e3eeccacfcf62f7d70e9cdbb26137a4f80447b972bb87ec7d491c09e65d538a949f819a3d60438edb0786b3df64e69360ff56e851c709bbffef9b34dd03825a7d8e665d7c38433138eaff9023f2e0e9cb1b543abf9f1ffae50d9cc8f424c6cd6477ed794cf57616202e9e25339f16857bf1373c23b21537961bdaade30881201713e012730897c8f6ff665de1d40b9e3dfc478e39429338a8002cfe3a7d004b9e127694621cfd3c6a301871cc1fba216e6e4f8d3d09b79770bd593f53789885a7280d1c3b04721eb1df8405a2b8b55d9d7b2d14b15df8b761ce14e1838ebd57ba83ca57cd433e19a2d83f342e1b9a97df7f6bdd39b2c489f48d9c47d4dc2cc70325008876d43b484d00c25e72d5868d3ec16669bfc3050a0cd7788c73ce43d7456776626879f0a64459dbfd646b9d02b5af09f053dfd857a37cd15cf966e58c356d446d165d84cc7ebabf95448870ec7378cfd40a8296b2bf9808f87ee0a7f41e7fbda1cc4de792fc55d7c127f2fb6d23be053bb6ac7d309e6e51e855b1432c1a139e91795a931adb4b9d9c24d28f61406cf23bb868c8941e4e55ebf08b08f07c99bcb597890bd6b77c15a8c1283baa1ffce625faf50d845e4568fbbd7ed2b87ae6e756cd60b1895406bf97e4fca7185520f84aefa897ba92497d42dd514a128766c16fe161f13dd70809ea7b9026b2481a6d4a53420ff423ac3e2900a827dddaf632b2d78edee0ca94d296cce0bda24a6968b6a61a51b4f5f6b3df080c4ec35b3656fc1f063697f8ef919bc2db4a3a657b46a43fadd28e3c6dfd8d9ac22a434c37369b6fecbf6a6558f9379a3e55cb596bb1e352bc45f0f311fbf0456fdf565bf32fff398c3bf549b7d02c73bfabec248aa6208751613ff2ef0b8db22fd7b04b87e8b216b873a05761c9219d7a2de352c440db8aea906fc1f869138fed9b7f14d0e1fdc7f9da831721b958d9deb75f64fd23c57a677ea90705d33ce83d14b0bde563d8d5e4ab604772b5f17ee677a485dfca9315739c3225de494fc128f1ca135bca7a30f54871309024a1b7bdef40d196ada8c9568b040f56ac68d44b8546512cf3c4ed70c3c25bfc3e6c12e137a2d09055a0eca3ed56c02893840b08d99fc569c365493d69c16fff0d353f9af0dd238c1216b979cfb73f52443fc14670a71dabcebdd2b313a479d9248d3de7224fdc5fa302af03694321812f1391c8f6d6fe1435e2d947185ee9883040cf47a586eaaa39a13b6be6a17cb604c6970b03fc08095071f8b1055183b28f61461f9bf87d0d23e8cc40a23fe8cb8fb874a4215ccb3731e77581afcd0b34e1d7f7bb622f9e8a9af6540df1929dd55ba52de4600902b776331bf6969fc89c2e58e934de5981b323c84c3ae1ba06654415d0e270da0afd65b045dcc8db7b1d33e44b68a580a2ee7fe0dcb09abbeb0d100c4566f5de69354b356e8f1cfb590767c7bc006eba8b7aae03d8c8e1e807c60158f2e50eaa1ecf62f2b1ebd1766610418cfad40e4b5406200823619dc50bb287984b6b7eabe6f8f87833fad368e57ae69e858dbe27a41f5f536d6132e0b5d57cb36e2e0469b5abe6ac6b0aac8df93bd2a8f812dfed18163d3b2d4a5050b62246b587b148ef9ae285010a4c87ab555e49727188bca4f0aa899c21dcd5dcfd68925c7337874f3e6ad473fd7a39608a4db0699f7090ab743989582164fe873d1ec564b0599c920be2386582fad731fd3cbe85a39bb5644493db02ae0d52fd31b1378589723c3bffe359c9da2fba5a281c96cb538b05d34bf2debd6e64838bee61dae29e5ddf6b6b7069a3bcceaea20155ed93af215a3eeb5af96468d7c8df52c99d13d77956b8b853edd11eead8e90f34e9fc0341d11f08cd9c8785a99f8b5ca48a43c2fce57e4834aa1a8a2118afd6b1977757cfd287aa2cb143ab6ca6685ed0d30e7f61e83b1ab04bd63c68f210c55d89a480e4ec5ccb78f243cbea592666fc204d424b9aacde587cda278a98d2e5864230496aa7830ca99b0c50baab9dbac0160a6db415c97b1997c4a4829269cf1040b715d25577cf3dc9c03022d44ed43e524c0ea6a6800a962df3604f6bcda439abf04da59a34875688bbdc1d51f9726a021b82f18334c428218f9537731cdc2a1b04a13f65b258dba5e27ffe31c977360e757c6879c1c38c98c669f8f94d5890a85cec668807c92937b475b5c1c49df7e2555f2fe730b6f55a449c925c82ebe902bb39f1afe6935aaa245ee20fb675d58abd2184115b5a7021cbf4f25452f990fca243ef421dfcc0b3f61f8a9bcfad939debb0d3d9cd3976a251058926d48e06664672d350d296b20053cef62573319edb16b2d12071489e9f48f044a4d0722400a457b56cf90c2ce8230067f564ab6294f96a1bd07d5e5fb08e5e34697bbd323a00853ce32118f25caf94a1d6925510690e2ae1fa533a9687b2d8dc7b4059b03b03251eb3b5a4df95695302b50f9f51ac2c0482c9f06cc44ec80aa58cc6e406c88df4207e45e6b87a391b51d3e524be71aacd68b39d74ba410e56867c5784969863d459026dd6055ddffecfce83258e5ab8950acd0db871a8dbb0822d6da2a1d8484c581cb64e2fd7a2028b957ae2100161be115e37f561ece1096cba636b6b78bdc08f7e819e428eab72cc588c6aea6ab28aaf09120947eff19982221881a700a95852c33a5516fd96c2b8ef2edf58ad6a0e74b87ac01cc436b5c33f7e437331eb26e65940e168e4c796a9fecb3f1898897d4b381a13f2a2aec556bcb1dbdd74e58747e85368013bb509b5589d35b9c694d928608b5e7003634f08734d7c5894f15875a81272283138cb4e74d6fc1a4620c6765b2b0a972d1bb9b78e989f62b8d382d44b5cbeb752d4dc052ca8ed6d96bdccebb29a012f8c3b864da259e5d087b8761ce8fa8bd28526074a02216db00ce0eea693aeed815523210b319fa59e9f916053693f95b4be6d7eaf5eef67e101426d52acef308d657f0b11e5a29efa0142e2fab0e799bf46b21cc16e37d686284e45ea60d4bb5f1b8aa32625f0728c94f5f97c9d5f5963fc1586f0889a1cbb1428c4a95b8ec213e151a184fb639b980db18fd0f7e98739619ef0e9ea33153478d7959021441f6d8ea905c4a445d488e915e63c6a61feaa4e38e54a2403f528c76c232e9ac3027e0745967f961ccd0b6cc58a240cb839b13f33b6c7c962716c1d7a78db8220e8336e9b04fe5e83002e32903e71ab36ee269cece865b14ff5e2654d7bbdef5f120d11f56e52c6ba51c5ee4008acaed5c67d663695d485acdbdeb54d5a9df6f61abba4a2a93543f20dafae17589dc1f5f6d376863149feb74addaba83b43a3a2f75602d1663a3dc38334a70601596d0deb73afbabc16f8ca4dbe969894171e8002411bdc518e642aa3d93453561d5fa2bdb75f68f6c761edde2a35891fe4f6ccc512e376db949da79376131be0a255fd17fa0fe37acc6186b07fdd26f5d0e1902c3bf1b6c7361d23959ca26084f89c36b25f518f1832b9fdedb778d91d899a3d9d752dd23dcb07c9a2c77d5fc635938e6c605416f579fedeb0c7ea7f1e8ffd1a8f3e8644b023cdf2fe22aa34434d7eff44d42316b87784743a65bf6929f78124db4ff516625acf924516b5c8d956782cad06fe5c7c69520a35d4af5a480f79c9546b4d7cb627035bb996bbc2a01bb48d69a6b7c14e262c33f460b36b312f7b0c752d379241503894ed1ea6c17374e6ad0bb21a880bda1256a734983ab7a339f8290954c08d1f7704fd06ddfb6ec3a07a2d76bea09e6d21b636cb2fad7e3c58fb8bc16d02c7869eb918249f202a59db86b033e9b66ae060be06572113336943a26656008a6f2490e3aec45d33eb801853bc4b470627922d0018b1137f44a0daa38d61c483327ca4a1f76f11b48d8754482939f6765abc4c85091227c4fd226b6e659609decec5089df5e5503f59d23b61fb4030812d69be1cce3ea57d737f40e975de0d3c16e23cf3a4b09eb095ed4b2fc8e5b7c6022e02b641ad043dd04076d450e5635b9c9a7818fd152ab3a772e28160ad8a5458b005ae1bae101af884e3f4b90359d2679977600bdb7b519af79fc9aea4aa91677a028e841f2a28a05f6db4ee54031e4aaa77777b2acc2d094c5d098f388a24bf1ffc84f65cd72f4e1f2c5aa88f8dbdddb9614cb83de5c3c0c4ebbe69170acb6afd49b260319388f15879aae62c4b519c6eb39110448d934e750f4c8257529f97c63f25976bdf286d83dc658b37f61a67447df2e34e2a1871e5fed8a911d19d52cbe6278d503a6b9387a32e0a877e0f4b5b9bb8f4a1e31eaa9af2ac293710de56b3b2c7c48bd8f9629a637380437d877fc11a44c24d736d9ef3ec6ca146792c5db48593360d59cf2170c006912c61c4316758ca739b566bb724c8499fc16762f48bd9ba8ae7c985e9a19d01e1507afc68c02e592b6cfea126ed4ee1cae4c53d4134a10a1e5895bac7a3c3a3d7ca9456cf278b69e7b4eca75c782a49bd87c9e7a09adee8b5a36db85a370af531bdc94b4f57ef24ad2b45ddab93fad8ef9150396d992f8f3c6a17980fdf2f2f15702e0fff16659715784c3e6290f427fdcaf0731a1814e35b68a1fc7ba477a15cb13c0f371b6a449229ce5f6a97db3ec37912d149b3dbcbf10389d589ecd2d2b176736243f23b431b67f700901ddf61d0a80c7cb3254ed2fc6eb2ce303d19b0896a06120cb8a06845955154fb61b62d2f28b2c3743230f51fdadcc18a488f48e532f8c9220d69b41bfb6d54808ff1f86430c811fea72a29b3dc6b09060d1d76f73c1cfeb00315eebcab6cccefeec47bf8ae6eb884b69b6b640c97e6e5c57420458f84285afdaa60cb08813cfef1784fd75fb9c02b8a82d6e450c677b53839a7d7bd46a8a44b80428eb51bb4fa9892f68aa403b9c6ea1fb00b09412833944942ffc875606e02065acf2eb3c6280f257416c8158729336f43a7b4b40bd885aa0fe62da15a90a0cfb4d71ea28c10431ff0f7419765de608af88c3a08d4504d5a465b06030551a31c2e19ac14ada965294cc1ea5727c16f3b2a3bdde7416d671d4bed35310174acc4117e9c69460e3a3a03d3501173dbf99eaa0b46c78aef434c56da9c2a05083291b40e31d24ed12bf09699f530fef63a5c563d9bc376c941e66c90e84c088bdc3e03c882af46858d83440ca5656c7e46ec64dba7bc9c96bb4ceba75efbaa4dee6d4d67ab021a05f08d833367a2e0c1135ba6e358d9233b24e4cab36e842b16532640ac13b3ae43579ffa4ff9623eebcee6bb4e551043454fcacad432a37a27942fbb23980147332cb41fbf21068368696bd2f2c1a662139dfa07519a6cae42e3c8879b25efdfd76d0a61c1c18f9c07d08e18a06b9de143f4059d4041d5f549363685b376e39045ba55881ed4590f4443ccc48117f027a54cb3439aff9ba36084690569fd44b021e21c3f232c4e14c4ed3e20eee4664e4403716d1a7354470067df76ad5425fd981dada1f475516bd45e24c258ccfcf840a97802f40f9d3202ad616317c04d600329ecfd8ac7e9caf81e9093103cce87b618317614282f828024d1a5f33b9b3f99fd373de5400037b85b728ae502563b2b79ce4fb6d6b5b4075b454a0a873c8e96834e573f0b49487b8263caed80446c35105601abec77f1b8ed8401dd589c046ce868d224efb4dfb180519f4d9414e9220380d92b5726a159a038373ea658a946de19e2f9f4d86ecf20aa9381ff2a4b8b87f0bc4f11fdbbddc08524fb03ebbff75c6e91ac85f5c75d2787aac507750b56163885f9a871ac669ad4c06b89adf524abd22172f8b3f5b4d0e1538648dc7e35f58eb33a3713fc4892024aa75675c6cf78c1aef99c39986030678ccb94decdf26a4e0896c7b660896f6e6cce1ae70b23b604378e49cebcf382267c5b437adf2ed74c45ec362cf56966dfcf2ba60cd6b93e271dfbe9688bedac3dc993c84907251a617f44310060d073ae1beb30989ad7d773d82c55133f1bbd9394a3bf5b9a5b4a5f55e3240587247dd4b34841ff5facb5df7b34dc5c3594ff435b899a8c20ef833472434b0df234d75585e17a3ff7aaa47ed8a708b96d6c1455a9ce0ba46c523d31d709fef42da7baba9a0c34aed3efe92d6ec7a516318c9afa8e3480acc735918f4f81f8171d89950c5674557db84d59aaddf5cdc7896e1f628db2a483e5f792c4191d5d4bd2409c66913f48cb383dd823e4068d8c5e79d0205c5e1db72a11419fdd57a8c811b2d72b0131810491c84991dcaea03e89c8b6053e1cc1b5ceffaf51dbaf594796f0574ba332aaa2f32b22f4c97ca4039445d57f01f58cfeab0ed6e12c4bbb2d9a86ee5a2bf3cc1f6b4a4996565ab08dd028d66f8c4b05b1c710501e51d9b5213ec60a4489f1be9e2c18c4ab8d640b844ad41c944d9fb3e2de90fe5f7463772ee890d6c9b73894c57d5e5aa166a641ca28b1a1f57004355910aee89d864646d5e2dec4d4a47c38d2f3fa1100977385e73e387cd8c3246264fe2115eaf61f5fc31884aac0b75313c542a1751b4b495e490bb88d03441910a4ce485856e091242cf8fd03599a84e414257405cd3626bec90ad292a96e114b1c9341948ed672383e65d133f413697c22df99c5cab6e0fa83ee98bee6fbb257d8a7e5af67c96e3c48c2161554959250150eb9866818aa1d030fc55ae3cd6f76542b613058395f79c818b9a6e0a15a8cbe74ef416d98fd73a972b42035e10acdd8e1c292c997911ae8d4885152695193fe5c99bf519c4be66530541d4e6e538dbc8a49079791b4c492191cc19a9fcec91bacd175abca60cf940d182cbb57bb7d9c15597ffb722b8dae92d87317ba5ba85a7bc95c59d46832bf5625da4001df369b5a714d7075ad571c3172bf7574e6e42b49b2acee034a26ab09ae44fdf09c8d0b02bc599c34a4e6286f1a95996797adf9e3d16a41a859185bc1cddd0394973ede1d7b38a373f363fa613d6e3fe46c6fd58d08d7abb40133aacd14c9af6c6e1b4523926c83fc39fd8c5be7318a45ac7c899458557dee9d1b24b0ecc078c2674cc7241b6199818c9efe3af7c6ae5ada33765bc147ada640f851f07077523e14c2c785d7a1935e2b3c80dd9de16a5ccea9351276371c432f14f460739188f6c896fb0e42ac49a044c7a9fabb0b61ce7ca7162d13cd4419a85be171f09ecf9d631790e9ca750bdb445d8ffe488825e45f8b1ce20bcf52a5f7b171e6add3cfd49a183e51e33c53e39e7d65d8c3ce9f23ef28cc853a78f89968eb048690b7738a988bd9461f9ea898e9e864485f4b2516ce8395ef8f2c8c5c9b9f4b7fde7696d57ab890addc30d3e212b77b31d520f7f802f9e9b5a21615dfe7cb9b8a5fbb647c4c433eb7c21f3e207214d47ab21b0c38e50427608c32e96cf180c07ebb30ac9b</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      我的大学(︶.̮︶✽)大三
    
    </summary>
    
    
      <category term="小日志" scheme="https://www.marxcbr.cn/categories/%E5%B0%8F%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="小日志" scheme="https://www.marxcbr.cn/tags/%E5%B0%8F%E6%97%A5%E5%BF%97/"/>
    
      <category term="我的大学" scheme="https://www.marxcbr.cn/tags/%E6%88%91%E7%9A%84%E5%A4%A7%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>我的大学(︶.̮︶✽)大二</title>
    <link href="https://www.marxcbr.cn/archives/84f9c73a.html"/>
    <id>https://www.marxcbr.cn/archives/84f9c73a.html</id>
    <published>2020-07-12T08:20:54.000Z</published>
    <updated>2020-12-23T13:48:32.323Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="抱歉, 这个密码看着不太对, 请再试试." data-whm="抱歉, 这个文章不能被校验, 不过您还是能看看解密后的内容"><div class="hbe-input-container"><input type="password" id="hbePass" placeholder="This blog is encrypted.You must enter the password to read." /><label>This blog is encrypted.You must enter the password to read.</label><div class="bottom-line"></div></div><script id="hbeData" type="hbeData" data-hmacdigest="31628a70a58761d65a549f4d8ae6398fe0ff8a3bbc8d6518e600049e390b48a6">bef36e4a47b53f3e932b91de681e5f361b841e79d3769ea8864ff868cb4c201807814c96431ba554964c3bffacb4c15f1db7ca81edbd840b209fd1363a42c695d2b51777e3166eee62fdddfd2373586d4c17f6b370bb2e1a3ba99fca3776ef0725f9c8b85680265627bb6379a5ba111a1699adc950407d317b1e3b73ba4e9467a91437dc1b11e1a27e9573bfe6fd0cd2b8079bc88cda99645f18822fd7b1ed10f2f2033aa0063bef89fe45fca153ae8ba0714d02cfd746a75eb7e11bef6d2f590a5bb0f32aa0fc4c655203a3c89dcc86cca5c427a4132ef89086e508d46cf2d8c0658db7c14a56870b15a93463566c334c84406e8681baf9ef4eadca1eeeb090f49ca007bb287b54394ee2d708ca5e3039bbcce6361da766ce56bc9b3b8f63aebffc30ec644f1fa255055f6d213f42b02b3f5920d2ce9b8477166f4953078ebc181c6e545679740edf8cd8a18d95db574a0b425da4b440c7d3e3941a42cb4f90334b32e1cdeb9d35b4f6afe4ad278a75bceb8227c19bdc90b4658103dd1e7c2970b1f9d684bb10138c3b20f77a384fcdce9ef5ec5921413efe746311c7d2d0f81ae30670913455703fb143fa837e5e9021803ab7c17f5a61f3d081c85be4fc19037ac0b999916d787c7e42a8c1308f2cde70b635b08c9a13a5a9a2893d2703f2f77d362b7b55b7df6e3d85208431df91810a64b90b2b041adeeb6c61313520d2bcb92f93d92d0c9831f3746f136fd7045ed7aed12ebacf5495fe74a59a1f75cce9f02fac3489b207e29acff77a90e35648bd0f98eaf6d1cd7e3590fd996e196b32a35a225dd81c02ef7c78d60056b9179120c3bdb604aa4a10a6e3950f98f0a210b91daa633e32f7aa0ed193ba918afd367a39559fba2d9f53817ac6c1c786df2c69a616d25929b2b906255a6d2f44ff41173a56cbecdf94d4d49f6f04eb37bdf0688e44884e5bcf9adac1d1b42d84cdd6ba5e0cb3b5e71c41691e754ac2d35838efe84bfdc07f2821b352523069eb12160b61a67aede9e766e670984fe478210ccb355ae827cd6da4d42a45abc68fe6e421b1056417583a1712629589818063351aae9ba5c1c90bf4fb71587cb8370934082d0b33320128f3f73e707fc47fc28f5c98aa813e0548f01c371c5e32f3994dcec3e61fd24d8db6f2b157260a604a0d3a8aca5c0ad1ec9b45121d85991c90c92ee2135bbe8076f781024e8e70cba7621378d643a83de0564c2b831632480ecf6484ac0a3efae07edc4b31dd21b370d485428efd6d29250754e01f5d0b9c1cf56bda479ea8423b636321b91632a08c59ce7260217c4f648c3d23d180ba4e6abc8205b309c418d04bc7ede58e3856833891e710cf5fd783be803b5596b7f474327298cfe415319a628e42f732169006ab82ad0d2e5f1717ea611ad0d7f5fff3173eaf97f288185ab8aafdb63b479df5c7209ac141d5e4520770dc7cf1becff7c6e9f6a6c7d8f44322a369970cf271072032330785bd5c7186047887d869828dfe34e926f02c4cb82fd4e0837ba900d8ad63db4b3988e0e025c407eec0f4b9595b8da488c5fda8bbf496ed0bfe922853f74a744efbbfe9682e338e8c1ba51b1ab78d36b4821ce27d2e9967253ec810959669ff7e79108858aee8f5f1bc25dc79316a04fca181bd2d9e2e5aabd4264407fc2ac163967ff3b4fd8560ae41ed0416f0c24e2a06cae83bfc4a5ded6ca7340c6dbb35c7b19c8cbd78bfac6e771e5eac1e87201003c1ba7dfdf0990a50eaa626e24e9d68dcf0e1a9c9bd1dcd6c5292464848e12d4063f4c83fb2f32fd1bca087ab3b6d9e4df89cf984e95875d90b132b99e4aac1b5ec79ce592d790a27dfd934766dc8367bae94ba2c8b496e7f1b733bc74b672a9003bec17c5aa470b312b20a1f997ba16994a423e3de7f71a7741dbb1cc09ddf851ebfea6043917962aa0e8671846c4d613be5345a839f560dd7ffa18ab38810d006e61e2d192d1457ecbd142fae8a295c9f82bc7ae8da7cc024ab73a5bf8f4be65b96e791eb51e3477dcdacc52bd59ee86e28e2a64a6a2457ef24044b12671ec79000a014a2d9e44ba89bf581d50318fd44d27099e539c8f1a86d11b5a8f7ae63a72851d78bae04852e971ccb3c8812bd80e8597e7e1a6b9a511aa72404c0ff8788925794044e6ac91da067823026b3e42a0d26be099d010c6749e29efbe428fe60e3a5605ca2aa02502b4376c0e279f0246add13ed0eaae00918c2d23af5d201f00f3efe601ba6ef9cdb36416ba756affc313bbaed8f4a357ba5c5d5ef4ee38579da1a4e5908d1bc8d65f19f4194e8cd6fd5e595c40d90dbf843009f4a7b032991c00c1aa2d5cc0c251f321aef63f3f9ff0e87df455dc7b3585c37378645c6f571763dc3c01de88bd7526ca5c3bf71a486de294877ce2bb5299a9f028838a04c642e74ab1429da467c017dc64903f8caccdf107b80e9223837a47fd291bc87c8365eb2ae49b8bca6cdef1179b50c41386d54f9eb8f33fbf3f64a2ae32dfecd4c41546b71cdf51e4c9aff957ae39c81e556ebd22ffb3d4bdf945163008135e117ba4a62a975f3b81a768247294e7a9ad9b6f64bee847bde00fe9dcfa88b4dbcd2833dcdc3e24887354ea68fa4837958820238eb928f0dca5212ff7866e871356a1183a760ae3777c9f72d13eaab863a28e90787c1ea534e589e3b3aef1dcae2f7bf761707fbcdd8a72012069f6bf59ed1b3e7b3a8749a9738805ccba23ae8c5f81c6b5ba581aa48ea0f3dad4121eafcb000ff94152ff45e713d0ee749efce23b56162dbc750d1be2fff067359a5898126ad58a2e0e7bb98e8714ff469ddb40adfd88efe468f507b099399531ddfae16983f124e1740f86704bdf025ec1ff1a0e2551df553db0161d896dadbe78382c8381bf85f35c78e3c90c4991371475f93ee71faf036ec6b172c34d7c52c5fcea66a5ed9ee54fae7d6d04572d7b1a5346e3a107c28a15e64f4a8c009984730934fc0d46ddda3008594479d20131bd29b45eefe5191a653a17e41ab383d3178571d0684b9a84c3fcacb605c18ec6cc129accb144687a2a93dcc1913bc06d11db5b6586f8e64e021f8e6d14b1a55d4195392ef4558500f9b67f51a05561540040c2bc7e846ed2dba438c8cb4fbc3138eec4e29349e192f6823677daf1c0dd76676ef92a29ba98891720bc026d0463fed79f7e5cc821c6b13cb539b60ced3d4d897ac3bd1bb149bf873ff0c94bd2c10b41cbca5cb189736e7a2c32cff56b7afa55a2c4a1cd0a22b13cab946a05745f41e8dd38b9ddb0e96310c412a3d78c07a1d7632fa88052bc96197ee837ec00e5e840fd941a2c6b1ca82bec8a62527972d6b7ee5d97a0a655933ebc8e0f968155dbaffe7c9a9b959ae6059dd48502a7bc8dea7dabe7c0822068da7aad0b8ded0d7d6098b7aae5966905aefcec664a3e60c1028563eccc72ba8c74f61b953893c68eba4ba997b85f2161382c4f8fb7b8167d5c0149dca06cfa979e73379a48cbeb610cad8e967a2f871a171c1d5744bd6ce2fe3a95b4c7c5d5b8d772eb4be8f23c5fb29d490ea3862428942c6e370ebc79743720a3f5862443583e362bc5463704a65416fd382f074c8e8adc3ed091313f958bccadaa045352cec53e0b6a64aa9c24bb7397bedd80ff24fa360f85782d56292908a492735fba2083c35925398e3a7df757dd7379714abc5cd4fdbb2a517ecd74ffe4371fea99bd83c05f2a5b4cb2655e52a673978d0e428f22cec675e822fa525f4b3718879a97ae4d2583d58bc2a8b7478e5b1d8ac87cde1c95de56872056480d03aa12a6d5d022a6651fc1b14053773e3893bc2e5872f161db4ce00f0b8b4a6412bba3e0fa16c7fe6749f789ccb7c7ac4ae401e2d64b469d086a69bc52870f848c1152791a87077e2c809e36321f629b84453e022229c65cc77b53f4847b9f2a0e16869069f7fe36424ac4c298483218192611a14b0c58f02465cb9d0dc2de4fae426ccb434cbc5bd80dc4c58cb907b340aba7ab3d769a228b35a50340c88d5d0a5ed5747419b4d300bbb763bfb5d7585e36c7582dfe870caaa8d259ac7ab9cece7eaf8d904c775dac9d8b4f27be64c6a9c7eb5e7042d11ebab13f83d4d65dc542998f9989aa662cb26fc22998e653aa749527dc0b783fa11ac54d4f52d5b9259b1b469251da01b4d8864b1a33236e8780f9e8036520e8fd691d8e64f9f01454b69344472a6ce328480be3c48d7bda5c25f919e73db8d31862c8da38f8329b9fb97cb7278c3c11c3d2ead93c67b1d7360b434946ae3bed79b19a8903ce0cfcd06b76f00835d22f4824718c842eb4ff7a7c6d84bcc2acdf2019394b9e07d54804a975244e83a877fcf0b2a71fa0e5dbcc08a1d4ff5aa2b3d0d7051010b70b992d48e6c6c0dd869902d5cbea4d585074fbd0cb7e9361eaba291b34a60e344e306be0e9c958e217d08cb25eaa9be166ad6f93b5e97c05d440da5f41168b10399281c88fdd054ac85c8c8c2e31692b85df7fae8370f3e44dd797e48e972996e068f9419301e5e1fd982b0e4543509219f3d463c513e63072e6430b0744260ab91365c5ef4e9eab434c847c1664b8984b3a96f851eb2b26dfcc70fe67630ee7f078396d354b509c7113a2d97a6473bd982cf301d279fbaecb68fd426b644df3d05d99f900f8dd0c2a0a587d90d67f7338c76316fdb0fe12dca67c16912b1eb333c55fd2e1fbba1fb2978a130b26bc1ce5a45a5272e56f3a21f7716f2f0e2da7ee078feff59fc8266d1422d1a881a35fd0ab3147fa726fc47caf734a138fc216157237083fb3b6f988f2cb013ed986a786a13b413a3e5d7471e7c158e296225a3002f779f32bfe57ed0579d84ac0337fd9821f0251925f740c5691600b66b09a4baeba82375b7d55a2c19904432587238763e951b8d986a87946636417c5fc441d20ca8e4932a1d0aabac93314c727c70c9101902ac49f2616344e8f92bcb5687af5fb8a891a8214c9c1026e87f819e0b446a3affc94402b6b8d1f4ab8171e7dfe1b5723cf1823fbbd4a3ab03d6f040fa4cda9eacaaa975a579b09d6b0ab1263dfdbca37dc6b0a1d39b24b81ebca5d4d0d6bd24f0e3d0e213cd10cf03aa102449357cadf23c766953b7cb7b18dd348e00b005548fd6bf8bd6894a79272398d1e60f945320960878b5c4275f5b17c4d5866b4530e02a571a1e806c90f97e6c944a070fcfb4b5391402ed78edba0a6721976e2117ad47c9f451f18d5180212a674d157bee78587d6a2af0333147a51b8dfa903203b118772fca79cf2945f7754fec02caefcfa670c1c4e7101b93c4733165e9bb99fb92a5c51a9a03c1c84d2492008d169f3b0f755713dd8c4a228a8f5e778b47e200065eab9fcf5ada26c814c7ee11ef0a4ccfc768a16c5d6e199fb4622922fa652222a57110d2cb0cf638304a216a482e6b1c94d26dc477ce6029982b6d38a880c5de0e21e818a1a4e83669098e082946ba09dd48acfc5d65c12718bbd57c8ade70b01caacaa726ce497194c94a5eb784891447d823ef706c63b438e05e7b969d6b640518a3478c6b9cc82505525ffc1368de0341bfa7057016a04179e106f072ba0f3c501fd05c0349b70486eec6aca6cfe5fe679f24ef40b0ef336194f8b2d157c32473497098b5adb5bbe35f42ee0117ec70b81c783ff42309b28996f9e29f0b2868d10d9cf468d530f59ce5f77d19415c2075dc63683cb7b60df29a634a71170bf233a2e761173d5d74acdf07c635fbdb1540f4f94fb12e0b3c620fcc10ca77e0e73e0dd230e7fceffb6c9eefcd17effa0667e0228ffe6314cd03de809bc7b918901f64c6332b6be742bdf299d1b703b5ebfd8df90bae38c35626eeee157d1fd1c80bba2044356669555750e1a7e8b356b81d052ae410ea6d5355d61a25a9ce91a708b8afbf0ae056c75a36dd32fba73f8e3f4673f8c82441cf9ac99a23010a056322cf7fedcbb235ef36ef7da656adb25d4d3bab77fe8a6454bf9f2cf5757b191cc9370217d3f3284d0a3470eda1ebf84da38b4e3ddaab1769ee62cd1b55f3c0e4fd2acd6120b48a5f4ba010eb80adbfe4d02b3d33c466184516c8d329b12308b6cbde9c490d7dcbd1dcd563280b4fd1eda0774ebd2aecbe118025ffbe5e9a3c9363450c65547e9e5c6ec8c45174c1aa9f1f4e531d9206dd7b3ed44777ef8560f8b928e4ffcd0c660e222f39d893c6ce6a05eb1b00084bae0b83594708b28aafc1f30235695d223aa2b255dcaa46db1ce08013ee8eab7ef1cbba08f9c6d41909f1d8cd43054423295d16279524685b3f8f8e1d17c57e9b76845de66cdcd5e43171753d693680ec65a8c0183d2c40f6c57149ef53f4e804aafdf6af172a28572f311d4ef3406132eed20987ffde6d8a000e52501c635321d5525ec9696ec56a0363a68f1005638c5bff4713af9f8cdd68eb2a876df00a99e32660f9a247fe51e3730fec97d1f23921740dc70eb34cde9ecd62dc49366f47e4b65050ab11a99395666e1bddcac02241b845d90dd7ed5b89359d5019ef32da7dbf1405b818ec57b8a897b519866f07b3c7a33737951a3d1bb2fb177b32311e25ffb3cc45aef0403321d515d47b71c7f1444fde631b1af2a4f6bd0f668ad93b6255c0368c5da321fe9de3aae33ab3e074921d0c9812adc87208addda69ae1ed7b3670b4256f7713a0c6fb0331050d55a09cddd57953a64e33ac1d3da6630f7953d8671ec0c03058ab1bc27de6c0776a8cb434cc19dfbcc2b88366894c9dea1fa4c38081661209f1a764f439831c81b1fe19d34cfa1160887d9afc88ad999761b62d627349740f25b41401f2bb25bcbebb16e7812eaa80c13e0931615cb2bce07ac262101b79025c49d67d0bd403f182ebd850544a97b45a85a3c90188606b34a853644c35bcf746a2ab2e17d42dcb0865d79c6ecefbbe4f968e6b3e95276aa21b31d99f854deb53d24da882ed2bc14b237a4b0285de5d130005646d39e1da38528be5147a31c5fe3fb8c00f9f91f522a274a715c4143de1f5427ca5a65595f19f3f43c23f9ddee150cc19b9d74e304ee91a565412984c478bb9f83cb1fe056fd8a1e1d19ce564a3cc278b781a7c64de98bdd6277be6d0c863f8a5397a338109fe9ea96688ee4129aa175c8eb29c318eb0851b87e560ff38382286be33fc088f2b4eb164f6a184e7a2aabb3f67104deda9350fb88a03f3c9c5a70ef5625e198c2e5766367d611c01568a5d67276e866916a8ebfe1e2957054058f67b93c938d0213da07e54f8e1a7085e17cfe776d7f68d4c4d5baed21dc56fbf372a1d96dac950344b2eaf2042e8a8c93c3c3db2776f1e633882a0c06ef042661d96c836479b4a77cb933b1ec1a81c6b3a0696efc102cac7ed96cd4cb1990d0c8a2035f3b7941fd4ec36e54fb060f8f2b76e70c122233f1e6d07deb0324f1197a78246f7c725a91d566af98e3011842353c1200cd974b13a7c4b86ee59430322f088bba013c27f73f0920d194cbb0a5078e5163f509c7bea17bfc87a221be70b8148b90512ddb7ac2266b0b694e36a29d3c6dc9b0281dd18b2ff0818613b0c04644d5ae837b20f31c34c47b5573d9553925cf094f0810c4f4a86b1c8890bdb62451f5c433033af3700d1b2e63bc29d9bcd120f96be2ab34491ced4262ac73aa3f5c6bdf9b583ca820a3ca9109f5ed1cc9d3d5bb01353e3452107f3dc0a12b810774189e6925d98e35e4c1bfeafdaefb13b831560200a20dfe3956fc4ca8aa1dd80ec9f60fe3572bb2d308bc4c88f65208fc812b05cf8aacb8751d3275f08cf02bd5ff209e439092c8ae68146137b5fc8ea1f25fdf71ea0c97bce501f661d030feaeed05dbc56d0fdfa29ae22888465a26d7ed8c5bfa2603ee17f4061d730b845e511df202edcc2519e0108664ea4c7c56cd8ddfdd415e7612e68da1c0045fbd9e33d0e7fcccc0ffe4e95b852bf7b978560d25d32ca4c63b006ec40ce1d97628b5bac411538818602653719d1e51e4b5d596c9fe80f591e8ac651af070d66f80b113130f63435b4998617dedefab8900121f6a5128d32b6eeadce4f444f57277d14b1d59b1d23465e4435d71aa9a41c86f5bb73fa7f8c5984d5d7a36846d0d508229512bbb21ff4b5158860e05f6267f863e35d339ec630edb93330db6814514bf1753f5445619d29c17c2c3103027d5121fa47c8eacc0fe51d73f249727059da2beec809193befadd612d17b986f812783b546f0bf2c4fcdfe072bbb5100d67717e51616aa5b2a06afa06f8e16ceee0609ca4aee5dde45ff89021596cc540e7b2162ead645c9372bc35df2bf6a4c548116a6a9e172134b5e4a7c98baeeb67eab019f87efc25ecc02c4be68a565315e506080e89c566d1aabb625d773cedf5c3583f5f7728e7ecfcff50c676307ed69e1c0ced23e1de065c6ec9ae6f39ef0c769c9028c5705306e91cf05aa5937e046ed52e8d072536d9e66057177dd16ffa21103e40798357c44641c5909b2f2519a20a1d234d2b6afeeca8a12f57b88dbc203162fc404638bccc721ceae9b240173ea28c602fdf4054baeab96f2dc16a40981490ecbfbcf6977a3961a1e90090d1b036d07ec8f3f0bd0ca043bef09ad16c1d8f46b956f9b9a085312c1cbae72057bec6f34cf367e1b62e3f09f0c58d042898ef6f1041cad2c446bc22fe6322032910d6fae3b7749a2ff30206e8a880cc622d6195ef3cae76beedbd953499f887f5d33a9376f9e23bbaded64645a1cd8d182f00952ce1af26448d2d0a2d680705237e18032bfa3bacf9219d122fdc27eb57ff381b4f6ad6b864abb35385b6620f08391ec1b0f068ad5c9c7f9a03e2a44f4c890101e52cf6fd6ae9eeb143ef9558d00ba2fe6eead2655f2558c3bc6a3ea6708f6358147428880130c416707a542bb7bfcf326b03f3a4c70db34d12037afa85d22849f5f10e3d2d8c1144561880d2b870fb3b2e8192f5924fb016ab36470714513c252b0d25e69ad45c7507a661474fdc41dda67ed8a457c34eb200d9a3e28b39f21da527d062971689690b12f53f9634aabb63abfdb3f4f0b94537f31291296a9a69413b973c841242f187c7e7d2d8431b3cbb43c004208e47938c3d4009bd345f86cb8a68c3c5d53cd74159242a918896486cdcb445ffa3dc4e5df67663cfe2b54a474d3437f95eb7aa1916f7fd3224d0cf1065248d641818fab3f79777eec389248e2eeac29a8a3e75a49506d93f2a1af249f25669ee2ddb387d007203f16409aaa202d673ad58cb34bf2400f706a4acc41ed1ad32a220e1429d9dde98d5b028924da53a81578f2c5952b09375cff297764a52017fb22053b513a7fdf1d90a2da76c05d10c599e2f1fe9267c88ca8be6781eba9cd66d237c89124fdebcd43ed35631eea75e39aedb12b1b788a8bc54c2ec8146942c5c5c161fe63df4f1cec5628c107af927cf023a39407cb8062bbb3081eddee2c64ec4c5650e999688fe82f761011535bae26f0a1188b4b6c3441105dfe6847478395784382eceb64cf2b294dc42f7a82ec279908d4b56da693c634345a8105b244ad7adfc56bc6abc44c5ee6ccc59c619347a0725cd0d0cc43fd3859b751fcc2cea6998cf81c8cb5ad8ded97d5fdcbd9419bfa6d1935f35846e7918cd25dc33e46f90edcf97e8308b9d2b6174f6943efe388fc18715f7045119ce787f3a8ae33ca2d92785eabfadf0e77a63b48ff7b00b21d2fb596fa46ef096eed93631a211758d04a011048eb25686ec05cfa391de36f05e9f1d30c894ee9b10c67f7cdfa15682d314ef83adeb148daf623c9da9bc2539667151d80df9d39c47041654f37c2860906c5e3802351a8634570505a670555069ee3995c95cab61bae72ad350afd8f35157f74246b3cbef71078fbed65e3e984ef4161f541c99e7b329ca4fc6633a72974aa4fa46e31911832accdd99814dc15a74d54dae08a02a23ebe0d2a944c352a30de7177b072fba1cc4bf4e256ef282cf3a8f8aab1b7ef04974a002bc625e60aefbec115582f4fcdb77e06982df9dedb21677c4e43b94c9919d78d85669370acc2484fc13b6fdc665dab3b20110e61963d0f</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      我的大学(︶.̮︶✽)大二
    
    </summary>
    
    
      <category term="小日志" scheme="https://www.marxcbr.cn/categories/%E5%B0%8F%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="小日志" scheme="https://www.marxcbr.cn/tags/%E5%B0%8F%E6%97%A5%E5%BF%97/"/>
    
      <category term="我的大学" scheme="https://www.marxcbr.cn/tags/%E6%88%91%E7%9A%84%E5%A4%A7%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>我的大学(︶.̮︶✽)大一</title>
    <link href="https://www.marxcbr.cn/archives/bf79e993.html"/>
    <id>https://www.marxcbr.cn/archives/bf79e993.html</id>
    <published>2020-07-11T08:19:54.000Z</published>
    <updated>2020-12-23T13:48:32.322Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="抱歉, 这个密码看着不太对, 请再试试." data-whm="抱歉, 这个文章不能被校验, 不过您还是能看看解密后的内容"><div class="hbe-input-container"><input type="password" id="hbePass" placeholder="This blog is encrypted.You must enter the password to read." /><label>This blog is encrypted.You must enter the password to read.</label><div class="bottom-line"></div></div><script id="hbeData" type="hbeData" data-hmacdigest="28f1bed6507dbb5b7c64ff7d96146ba857c74ac3d1dc6b089b914aec9bc793e9">bef36e4a47b53f3e932b91de681e5f361b841e79d3769ea8864ff868cb4c201807814c96431ba554964c3bffacb4c15f1db7ca81edbd840b209fd1363a42c695d2b51777e3166eee62fdddfd2373586d4c17f6b370bb2e1a3ba99fca3776ef0725f9c8b85680265627bb6379a5ba111a1699adc950407d317b1e3b73ba4e9467a91437dc1b11e1a27e9573bfe6fd0cd2b8079bc88cda99645f18822fd7b1ed10f2f2033aa0063bef89fe45fca153ae8ba0714d02cfd746a75eb7e11bef6d2f590a5bb0f32aa0fc4c655203a3c89dcc86cca5c427a4132ef89086e508d46cf2d8c0658db7c14a56870b15a93463566c334c84406e8681baf9ef4eadca1eeeb090f49ca007bb287b54394ee2d708ca5e3039bbcce6361da766ce56bc9b3b8f63aebffc30ec644f1fa255055f6d213f42b02b3f5920d2ce9b8477166f4953078ebc181c6e545679740edf8cd8a18d95db57ef3724374f539242ce42b714469a1ac70f066be6c0d0ba12f9d448c507b3780eb99ced0757450ea7f9f3b1e7f0c188131eb5d05b0909a999568abfc6e0f2c84bf3c2012fb985cba908bd1d62649b35254cb2d1265985018cabc8166fd150aeee5dde69b095f7753f8d8c0e49467beaf26c6b4bd3596e54b3c477e7e2fa8ad5476f942b534529a72554120c5a5d828b439151d8e6b9918d598642b8ea378f55c3768fc3a43a6223db8ad7fb5505fac24e81fa1eb83d315280584a5574b92cc341ff0769921d6dc34c19d0177b0e32eadf3a2fad0bbdb3a853618980e50c4f274c4d8a43ce8b8675a8de9d0154e8d25431f2233d1023fbfb92286b62d3912653ef3a52d7ce3d47847400c60d1aefb844e8b7ddc9ba72a937cf45690e7ff5f347a2c9fe04fd5886b82e1cfff15d16e7dda75421883a892cea5955c6283cb1cbc965e7f985efc07d1507ebca9b1f74db703099b91984fc9daf44beea761833ec6e6df608feb2419cb6a7a18aeede10383ff3e2cb03cd9040216dd2ae0a4c55de4dddb37f5a256bc74abd82d219530663554a368cef5e0aa80035f386c899b7108ebe740cd8fa75af28d549a31aa82eb95cc6f1e1475fe73e87b287b274968986f0a8407641b9d822c0a1b0dd64d092583be0ce43f0ca389809c9be0da7bc02eca88b98d6446f9c58ea4c62c5bf9eafb51959b3b1093636f7be0c2e5acd05a0df044a854349428026d7bd1d963d533380610b4601efd1e1f5e9826e9472e5a09edf6c5501f9057c021f8c5c33d4499dd9d08e52e3a42ad3c7fd72726145378292b54547d9e340ddac64642889fd6c5d29435d08839403cc64a49540d8a6f34d064498b5ea515b51807ff94228dd797780c0dc15cfc499bc60c6ea44e7e308d7e9ad85772ad7fe69b8ada5a4b96f0b3be212d0c77935e2cef573f2b95f82b70337b417fe63d70b90251cd114f5efda6c8d7d5bf014401951ef343bdba3ebd970be53e485008c69c0be2ef448823f3b9fbbade4394d544f99981c245e77a13a786501849afc9de9cb49a89734cac88f254d2789b2b8de18850794975cd049ffa7d110a27582199ff91c8378b2dd94fc0449bd2bb418843ce40296a6031c7bf7cd7f77a8359e6943fd53d842e3bc7b18a9c0be0f538eb095c6247c632a3b988a925d4038ddd76a56d2a4243f79d7e3c0f05b51eca375d040c654b57f0a0523e44179cb04379bc64a7959b72a80e127ef5f839350d9a118a862d53fde2b9b90607c2cbe0fbc5c0a33a9e19c215002f5bf3a3c4510d75d6b3bffeb08579e96e8e7d77515906f1bb233ecc5a01bc2fc08414e210a4b8276bbdd5ddda846eb3b4058678517a27750da56cb58411d0aec2a98700111ac54bf549e88c8a6e18f69d76b8e3c61023923c907cb34b170da6320bcee320594881512ad3e3cac12a6be2c7a255dd3b26638ad6e7e6469d529d8fb0ccbc310760ccb0f3e79580d6c221400474417603cbeae827ece6fead434dc62fcdf70da6a1c87442c686fb6e3e3dac958b4c1c06de29810f4e299174d4146c4f74e22d3fb3ee2cf2f8b7a3e0fe78d8e8e6a10a5ac2b8aa73dbde02ae88447ad65f9095e2d5ab4e6fa55b6e1c0773ce96b68d4f827444b8aed66499cf60b8ca409abcaa09574d7d3f68080aa391ee17758ab5d0f602852ab5c781ce17a43e767e0cdd6d586dbf17bd50ac96325ad146dfc5c267aab5b25dadf873a1f6648ff9e7a5b85efdfa1c5813a3ae3d010c9cf0b926aab6d38802a7df15f74502d5730048cb5c9128c0ee80587ea62193c9bd3739cde0a29979c2ffb1cc3a5893be4891909b5ab4ef6dbbdf66e15c060b0a3cfae96317c11720560f664bc7664deb97caa5bc0859c14a3764bf4b2ca1cdbf57cc1c8dbb4c280a944fe7bb892db70dcbcebe11bf7e13e19d3cdba80b88c322b034dd5be1e495095f67e09164f5307f6f2e3622c9e11d8067028cbb66709c540498a79b8ebb664d22bd2b94adbf08842f137dae6023bbc382937528f8714a7b647b6142c712c752cd1b7756d1ee8511eee689f64fb83582d8bdd0554a094effa14eed478414e29b43bb7945309e19f9811ae986cdda82ec659b520aa51792c35e3a38d60b51a401b1a4d91992f15aa0ef1c16a01871fde83a9e102ff3b76349a46e71f4ff4eb54892437728cc873dc4b4bb92b309122ab254456baf17baa548194ebf4a4770020d2d5a1720c3b746895159e3d3f95ee842dd28b1ad622a7628de7561caafe459f04be3097196f43f5dec4f91618782f784d4fea0e892c1fbbb61b30581191adddd187dd99716a6bf6b5f13abffb07020f5451e7ae5501fed4d977234fc171bcfc2daddbbc9bba6d5044d6d1d2dceac129a172111b545a06ba61c7bff81afcf7450cc28239ccac6abece6341b3b6edd934b1aa261cf62cfd8147b9adf9fcc6a54357afe549e5cfcb7cacc4249c57178d1db7ad85cd27a0181410394b057d538d8138e928897fa6f784ef802b699c3b36ce71edd00eda2959ffb91e7f58d34516558e1aff3a590c22142d36fb0de3ed0d43ae370aff0587148fc7d82dbeadadc1229c99f90b7080b960d94a59051d75fd517a491e274a539f21e09c755a6907c5231467d3b5943eb4a38c7c001edd97ff7f2f9c0c0a815c2824ecff806113a4b1976f0b6597c154f36493cf2995404302c721d09b99906ebf4e1cfe9c2f5327a13e1bbff91b608089f40277b30e020bd1d9296b56db87be9b38fa5c489b90db62ff529b56d271f14ecca2ae590b91d9260a9f58c3659348574f7ee3fa73e42cc96c5cc91512402a567259e701144a33d69d893c90dae39394fa76bf4845664cb4aeba8f8820d85efc0c23f79a46f979f1959da33f4d3a8df09ba7721f70fd615954d278e79683b5e4a29a0f84787c7e259d5deacb0c464c244baf995c8dbe9f0acd89279aebbb37fbb64425e52b7e8ab1288d3586a99bbeb5dbb98188dfb4f81d63c76620146e1e7e7369535ec55911a523f5df20c3a119e859201694f2e94ffedf005d85594e1212abac4320a4e37ebaef0ccaa51603d4a69859b0672d9985fe3002d5e38d8d5b02bd24be0a5016dfd25e214415244688746b12f104d5ed54651f1f3e1be16864fad23804e87dc313d13409780216fffd40a9a3342f343084f9985ca83526db10490f17b1720e6dccad771fab9e116ae9a7383002a0f760fd1499630e8ed1af5243603bdf4b2664d39f6369d232069c0be1f9cb27a4b3e46d182d8ce0ef0a0087f122fa55c7718226677b12d343d9cf3bb1c08b35b2f427dbc8c6aba8000eb1c13b4da513b7514960841971a365c31c04d7001fe77e6330b72931a2823e1655fcb89b662dfc7e0162184a63c383d2101de7db05689d4205a5c0b69ba49d6497dbde9bff51b1a31282e734264cd3db8761e9b43e7aedc68c7199fd38a72d2c3b39bde12ed5c7cfd0931da40f6e80ea1fe4a288178d136ccfd005b40cd731f3a1eb11a2ae30600c810b33863c784494766bfd189cb0f8406a23583f3e7f309e355d405da7cbdf9a26b3d936d54f43f8d3f5b831816a8b8271cb5d9a6e89adfa138466a484c2fe269037b6770f83c3e184f51a36e4c2e7d786629c9d38821e82da1dfac1fe9d21894e30e13197a88030d0ec733707fa4bd82fb941ac2bd26e288974130c450f7f2e6481e0fe4505b06b93d8841409951503476133ddeb47e02ff94825f73e28190a169038f7dd477c661f3c4d576d8112845cd04062336a42f31760a6de2f01bc4b3e50156ba552987b60c814e76e7f1a5d0c03432a3beac8bfc6478645c1340b6b2bc7715a6d842ddc6edec9031ead22e0a625f99da1f98f0a6e2b7a810ef3b4642bc397737bfb635bc46c8b39bfaaa62f254d064e7c6f477e5668a7eeb5c9e244d5029f6e20f9b6c7e2683748d10fb078e6652f3fdb5c0b118857fbef444a608b2829e64dd0c98ba528255c4d9543ca399bceb7c962b5cf4854b43c3609a01ccad8baa7019163112d5fece14abc17e6032b17ef04288ad0ad9145fe8fba900b04d1e3b7a5e36a647085b9f3b82925cf213ff432a4af8d87d6710a045a3cc831bba3096bd652010f6ab41e52cae2ccec08aeb6abd22a9d362af2cde763348e256d196c580de7087c963cfa3dfb466f27f355f416cc4d7d931df11c90a0a39d7207cd8e99304d22fb73e2b9a300606eef37b6a24b762f5dbc5cf15e18da42400a37d458aa36b442a3de89e0ac07d6ae89b903e3cba03b5ebaeefcf3a074ff1a8a517a1306ce271829305cfe047d1c57f87a96766a7fd3f3504dac14c89d080698fb4235f07bb715eb941d8a78e6c3aff5fc118fe7aa7780252d660c5b6d69a24f143e6895d68930aea5be449cd2e39594ef27dbb73d13cb8638940340cc0f83e18f986f7db474acfcf7147d7ef2dee76007eb0dc8c5cbb66df72bda5ad93db1fa2c2d462f85ad00e837bb176a99f1e6c73541e1d9afcc8cb2dc2422da3a986a3659a048f8eba8c552f0d0481ab639bb0e376f253a2f655ed76fa2e4f84ce02422fba7a86e89496ca072df5d5ff13a8ec116eb2e1f3f893fa102df891dfee68f8e634f8cc81d6efd9b268a4fe6c130f09b458cf4f4ca021b4a7e1a2f6235d89cd229f91ae0efa322e6e0fdedf48c1d2d4d31c128446b118848423149a2b7b225ae47026d9032a7962f41059d70f2397ac5a0d1b02212b59413d8e7935ce293c04ff3175000123554a2f1333e8932025aaed4142b08d3127129b689ad20ba7de6feba1e0a57d4fff26497799d1fdc12ec333e6b9d64e37cf2cf899ae67bad106cf302fd1583aa12e1fa32a11b875d9b978920d769cc9a37ac3da9f3f3a143e690794eaa67e1a5bd09004840776097a03ecb6e2a5f455289768bfac18fcf54b12a34c0d0f919d44f757ffb1e79bb2fd159139ca17a07157781ce5a32c82fe261062b57582f44bf615656c16bb0baaf44ea9ca563feb0b04b53575a9d3d1f319ac962466d61f2756fefbe4451b5cc300f11492791b453c95cd634e3dfafb8065470e95134d8f142e8326b8d0cf5c05619481c174ed86ab6deeaad9048795a46aca3c6ae63642bca3c6fef95cfa60ef82bbe2589db26940d523a47d53651dc6de2b3de0a795a5270e0103ddda000277405cec436038d2b03030ed797b4122e6595e9161a5f9d59123e210fb36644574bfcc7ad9a834b25dba2b6047b054ead672abd5f428ef6770ce28879423348f719e6662fdaeb7d8bd6a4b82e21ed3264902436a0b267a281435a90e18aca5ea6befff1038117a23b6367d734ce492b7948d8e39d848deded794170ca8089be3471d5de7664fad929e194eed78d57e8d0e1d8c2b0285ce11ee0e16ed1e4530cf64e4789d7650a22534f8e77f992535518bf015c7a9694951e87d86c1f42e1a706a2b8f9b188f7b2864dcf50e24ca5799432882e702043c4f07bbac57e9cb42433c5c4a8446304da3802a9efc706e17e32591b9d3a7aa00a843da779aa400782ec6cf35f9cc4a0b7f6ba00ab0a189a6e1aae2e895818d5240fa693d355263b3385540e04f496c2b1bfc2091366c226c1d289c5eafb73e73ad38bc24ee7926fe6f5b28cbfb35133208802f8bab398671f3b2457ce22f8d52e7ab0485e48cda348ba0abb83669b9acac8d5459fee5f1579f2702573d46cd06a02b75f06ca24b98c94303859f401ff8fdc424607633d2e05ed04eaca10a043827c0a2e3c0bf9b32735b26d2bf8cb629e396f390052cc3337f670259ee7d42a09ad7251ad59b2b1ccc806cd9b004bbfe60be67df9b10a81250cd39955fbab360fed629e876184237d79934a47361d88468814a487a0ce1d2470b2eb4e8f631996552784f9cff692b35f055c91a7eda787faf3e5f13ff5f1784295846e98bd418a7e2b066f8d8b3e8cf50861440d4a09513cdcbdad1c7d51332083fd38b217ed9d8bc32f23057c147a51a9fffe677e14643263954f48901678a8eda8ea8e0a80dd8689c314069c627cefc871b463d5a923b9e07e54f59f5d92bf6226e469e0e2171018a1f0f22aa6be51cb8f9bd7a612f162edf1dd16ddf5e0b73221acb16c4e2b468814aa3265d6e3306a4e3d7fd1ca5301a6959f9d6dc88ce2c3a2b143e3a0cdcf9456ba44d64f64a92731a5973c48327c68abc3e41a73f342f02a25b54c091f8ba21226e39a6273e2548ae81b2145e1bb4d65c2040e23f4d23388d0314e9225421ccbf455abc62debb14d9c75a594d722f741de178602f74b75f6055f7470ebb11adfc3abd38ac7a55f34ea17a892d29d3d92b030560caa46746c26eae491b7096fceb1574391617a5127065827314d6f937752770e5f3cc7fc6453e6e88645a25b5bc0d5ad7d2abbeaae7cf671a492b065db16c506f726fb895361a93fe8fb88dd303f08d3fd27732f3ad638615cb02749bff25028fac68064ff5a644f0b8f844d95d161a29d6b02249cb2561228894c4d9a2709bec8a7b59f65cd765c3b20dfeb8ea64af84716f4c0c89a84b06f830b063c01d7bb3f2ca275ae14c5b8302fcfd7404da3c419538f02ac29fb2c8872706f9ba4937468e19be8166d6bb01d9fe0bc36da4884abd16b1171fc962de8afb7ee7e6e83e9180d8d3f9edb8bf6f3b3b9110b29246f64bb12ef54fadb9dd142a0a71f4d3efd02cda3e6f5847afcc3ca531339a88d5e554d51d4204a3d1b4fc2d3a19d18a6aa471d8e50f808742c1297e6f00efd315ac3e281894c8150a22a1b7d600ba17c46871a101b635c9144910f5cdf6aa7a01095418e54857b6c2f0954e97442eab52f1e7deecab5903af31245a0993b16123a2e9f222cd4a26476d1181344acbe773f08c964f6e5214b1866dd9a0f226efb933ce356bd4db1e967f58885a3343213d609221f1d7bcae769f4169b1dace82f24b245b6e728746a8893d4d0fe3ab9bd02694f81af007920b44628488ae94cfa79baf3c0b233540e2d82671f1f81e1650ba3cbcb4af576a1c9ad608138717f97573ff8d01ca2e476683398a861ba16307d2904cc997c8e5247b3b6440beb5797abf2db49ff0654410e086d1f4d0d362f08a412a89e316f7964bb649d35aebf692103884486ff3b881672a93b1dc334aa79f0142d68dcf7d7fab6b97b1ed652723775843d2a3031f373359c3d07dd5637413b1b6b41cb5cd47a2f085a0a69e9e251c944dd69a419731f93b2baf699791e97372cab7e2eff2ee6f50d2d9ba1c1b984af9665927d7e17fcf00aa41ed4cdfd685f8d77fad5ee95cfde8e4915209e256d7e68e586953253f3ffc712bb7bc7d3c0eeb077004cf187b4685ebe8215d9fdc5fa356f60edda6ddc7e63b7b9f4f0d6c6607c4d5693450ec952cc156f21e7cebefb4a5dc0aebe03b6fb44829c906578d19de1c789ff68fc07da23c17c2cf1d105ccb605e23fe1d48e618639687209abaaf3040bbc2096408044a4a4d830e10d61516e231bad7dddb58035bfde0b8a334e5163ac8d0f71d3305d59e7cc737f43d3ff29be89038e597b7e1c3395cb3c122ac22ca8ce435ece9cbf257ef47fe900dd13f916cc13e9fcf52e4a4667151b54ede1adbaf4823882082e08028ca06ad0cf9fcb8aa68cc548d8a7d2f0395bf1f90139536c9f3aab15878d9a5fa4f8e77733ae08fbcc395c0a05d7d1afbdb5d53f426643d824351aee213fdea09a181de24b01f43a2c27ce75e9a3bac028c7fe2f5e7d5557f5a8401294c2cd73de53b25290b66479780a6023ae028f1c8cc6ee7f33908d10e4f85c90526cd3f0b718101723917381cfb12714cfe2c4843be0094275609ca49bc968ae405e6f00380b2d1cf43d4758fb4e0908c9468e9a3bbd1e65a24bccf90e8f0027fa5b57012881c79f1b612f1f47df2fbda12f692630c83f1c331a667200c208b97f77b5dd6c9bdee6d0ca6b1dfeb33d4bfbacc39fafa49ce81f1588f89dc4319ebd8b4dbb82c42149c8f58a9e2ffb545e1e4e20534297f69fcbd82dcf0f1480a715bfe2a6adb870042661afb38dd301e184e4dc0c60d5ba5e1b80aa3df235634af0588c8bda158edab306dfc1929da7d62e81940c2a17c5942b22d36933ebd5f147b2445bdef0e44fe65630252b3c616a67dfb69fa4d5d1509d514680f8cfe8897b477adbf346a2dcd48f54616a43bf56251f5d3fbb27eaeda5032732fcd5549820daab9c68452cea89986662b244f95c6d37b21eec948ebf38f8800ade7410bf88119edf8529f914adb0ebd6bbf60044051b99fc260b8e385f998b4bd4b11bc6c09dd98e0db7f268fcec7525f06663a1f72aa11c682800389b4dd240a763f86216a622a9e47eff0900d322804d1d91b3263b85768a190c37c270b3034ea17cdca482701b4b415bc442848063bea59e8d0af059b09374de7ed0c15472dd0e696d1aeb3bfe84f8653646e3498f4ebf0e6c912e31b28a24bb6f47ce0062ff201b94cf4c8af1bf4f5376fe28f3d1c5a4aa49c3ca23570a687e67183e8bb1c9108dc5236e7daae44bb33adbc6439a83a8be287fa436bb7557ea8f91516bc23989740b226dcb880a95babc435469973354836af328c4be2338de895a40c678fc8759c81a79b747eaa429cce5e728164e3afa73e2cba462a4a88445b4ff80a0068fcd26cdf23c0e6d7d46b60e166a5b0a27d6bd07afb5b1c16884e6fa3485fa387257c2bfa2986a31a049a407d33799bec5a39e2b8557c0335946ae7962fc872bbd8a61b483fc1f6d52d30187ac30a3de57b0cf5e46316e65b6c8f9f4d683c6fbdcde91887d5acf3ec413562aff28d9c60f29cc3694c8380ea2bebd186027d75e3f784f8159febd2a1d45730e351c6c49615ed52f1dee146191e9d1e1fc9c2a33bf724bbfbbdf779b7cfb50102787d88ce3917ee0361979876fc98dbba5571131325a2efeb1e6cf962c9519228a71c25805be5a7d1d7f49f13c79b0ee4fa78fcfb710345e9b7ec37e5dd77cf9342f2ebe871ab32de9e4cde16ba008c73748ba06ed7a0c1136b7924dacea2c117bc91697611852408315c9228938e731977d58c750216b9aeec7bb4d1902c6a5108ab4606c0c6a5a42f0c498cc39fa52bf9e596be9194bd907ab6dbea6e063b1d05cdce6599f64e17550c1851503168d9cff16b75fa9a13d435e405571a7344d93d340778baadb477f09627eeaf9fe203597bafa072566c836e638e42d3194ba66fafb4dffd51280b70e07bd3aef496044272ed0c01fba64eaff4ed6313fae29a9a2bac674e415932cdba20588c1c30fac6aff0a9d768a790422b92aa52bc51443c95de736a6ea4fe2312e90588db8c86d9dc83b2d5c1d280c953794d6574273cd1b8ea6597d31061fff1bc539df77036365e98d81a613cac41d67920e2393f96d3bb1fefc1766782ab2681c7956c84c16984ad2dfb23c95c65409031d40c44acc5ac2e9078838273a72c330193de1c4e7931d52fda002540c806cb72243e5289a8133334ef615867af4af0d5a77f336fa5068d2b7bb9f689f176b2a25da0a433bb940df2542d590309f78dcb5f11fef721af8ad9e5b0cd4b69a06b12984e9cc4644a4d80695e44176fca9bfcf6009fd50226f821aad0e73abe850062f555b44212aca4bef39445fab578bdffd79cb90a68efc1301132357ccef74c315700fcae972022d2fa878e63d61b3b5b515d242328dbb960db6f318102390a87fd9e86998c371b5135a11ad4916f5a17d0c251d4ebcc4aa77cbddb6c25b9380cc38d5a9ea31c1cc25d4686bc9746219345d28c66d577fb11138259a43878ddeb28fdd60df8c0602c21124d9b49914bc1c52232cbf0549d217bb0b74415c9d6e1d3e0d3dbe6b7c0bd2152a165d5dd61ffa2d1c3baea2838fefe8f381b71da87bac3c5cbd94cc5b0efebf6ad88dbef62c879dac729dcece6909e3487bcaa0f849e5886483e0fb4831388edba898c7791bc680524b361ec586c38fa496835d54ba401be5ca3884b1eb2e7b462af46b11c376c32aa7ac3665ad7db67490a632fe7aabf7acbef8584f359fceac0d46b3c957bedc259acb70b76f4453664fc37cc921bf29c9e37036c2b0a0a667f479aab69d94c8f7d6a7c6fe89a4b2bc6b8056302ccda8aaa9423ca622f43de88a87d47bd278778e2f847800a3d893ce6a201694f83cc1e943869a7be1939978381988f5e7f54480c4219b55c74c951f48a43b4bff5e672e6fbdfcbd3043387959673129ea89e32005d8242a3aa789cfe86cc46b061650366b6583d18f2dd68a5902df3e8d60e430255fb90ecfe001efe9b792bc3958d265df023dc8ed0e24e0898bed4249fb63077951d2983c0a8a92e2a343f74a30004d3e9fc2a1c34daf125d90c0aa6f0b05e5aacfdd8268a12a6fc18cfb6d40cc62df1c5515bd9b0f3176ff39d2fb00e15410dd1791af899238c678a2998b12c96fab6c12cac1ee70aae230a6af6395cb06fe68c88f3ae877b6916519738889fe57cf838328aa39ec73824494c469330cfc2523182123bf8c724ff1b2388abd087267f478b87a689893bad71df0a96776770668b163d2544c25dbd61df2b3a1edc1aa7301b686cbf9aecad68d77c399d619ecd6416df5f28b94ec655046e5d03b2f02b623094e0956b34b15ef0689880843090e55af217633885bd554b1ee1c24402c37f64e198da6e78c625f69ce496cbfcc44947ef3d6b5fe120c364eed86e2efd81ba86c1882eba02ef2ea98bf8264d32b4bf18bf1f9f2f1d5985ad66b2921b8c6a4ee9244711788332d8d2945eb115e8ec4dc0c72585289ac38ec7a84033d9b985033e703455ef24e9111a53521f63330c6f3d0ffd7265fb45e29e4a4009d2c34663c2494a4fe3468e037fdbc25fab4e02da69a0a2d9001b89b0e5e3f0101431d4c50388259a43b2d5c3379afa7ef6adebb08d32be6099fe608b6149698af1fbf1aad3125169d4bc5d61e68c9445307acd6b6e64bd1e9e7f2165a48fe06d224ff2c5e60a10efd4564b03c2e2b87cb62c4773fd4e9b1c67f4e7dc398713f932f7b4a2e538122e72b0afad0bcd7c908d138855e5aa5c55b9837a7380c19fd31d9f41401e495c4d2649d00e5535c07fbacebd0a1de000a35a7bec2934dd5b9f82d4ce7060735e9fcc085093f380d1fc27940d7af4a20bb43783b7208c6522a108eb8eff23c5082ea491d541e28fe8333c7ed8d11de1b6fb49b4b3b77341b518c38db4136211e762b7a31c71597bba552f5cbe11ba36975d2e6cdcac1e0bd4dfb1a01a42a6351e03d9fd3373e5172cf2f34507d284750d050ed86859773e9e29407285a74dc3f66a66e6a3b088bd8cd5b5b9aa11315113ae8447b961c79efd1edec9957204f1c60979acbd1159f28d2089e47d844164a4487740e42e94bce6f7311f11426c655bcb7f84f627609b30790f4b2b2d47ed8d428819935826ae91648e15110b993b5ce754bd79a5bbf21a3d62fb3f236af29d2bb9b11eb62a68852c591bbc0b3a8b1a273d9909e519ec2d18b2be9f94ed93098f8e0ba0780c8ba8fece9eef2f6632076b28034c772287828acaa757be0150f4f9f081437d720484d2e603fdaffb36ee80092901c6ab42f22308434c92a031f9e8888387f7ca9b71fcd800469f0e76b23bea6b2590143356c</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      我的大学(︶.̮︶✽)大一
    
    </summary>
    
    
      <category term="小日志" scheme="https://www.marxcbr.cn/categories/%E5%B0%8F%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="小日志" scheme="https://www.marxcbr.cn/tags/%E5%B0%8F%E6%97%A5%E5%BF%97/"/>
    
      <category term="我的大学" scheme="https://www.marxcbr.cn/tags/%E6%88%91%E7%9A%84%E5%A4%A7%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>四年大学之毕业感想</title>
    <link href="https://www.marxcbr.cn/archives/9b1b667b.html"/>
    <id>https://www.marxcbr.cn/archives/9b1b667b.html</id>
    <published>2020-07-09T18:27:20.000Z</published>
    <updated>2020-12-23T13:48:32.321Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>四年的时间真的很快，回首往日，2016年入学桂电，在我爸车中四处张望，观察着即将生活四年的的大学环境的我，充满好奇。那时的我心想着，这就是我的大学吗，我即将生活四年的地方，真好。<br />很多人看似嫌弃的吐槽桂电，但是我却经常为自己能到桂电上大学感到有幸运。桂电很大，人才很多，虽比不上清华，但是毕竟是南方…,诶~懂的都懂。认真学习，过个不轻松的大学可以保证自己能学到很多很多的知识和技能。我也在好好的学习和实践中拿到了一些奖项以及赚了不少的生活费，毕业设计还有幸拿到了校优二等。<br />细细想来，我的大学似乎就是以社团为支点，撑起我的学习、社交。有幸加入到七星瓢虫工作坊这个社团中，还做了挺长一段时间的负责人。这个社团应该就是我大学待过最长的地方了，在宿舍也不够社团呆的长~~~毅神、CSB他们上一届的学长给了我很多指导，同届的雄哥能经常帮我纠错和监督我，蒋总也跟我一起负责社团一些事务，而kwins则无限骚话，MXC、YCJ这些学弟又真的是有趣，即能帮干一下小活又能带我游戏上分，社团里面有你们真好。<br />兄弟社团中的涛涛、帅展、莫总等等一群大佬总能带我飞，跟在后面躺着真滴舒服。<br />还有幸带了一群小班，是很可爱的同学呢，跟他们交流的时候，时候都可以看到以前自己懵懂的样子。<br />最后我的女朋友温柔可爱，经常乖巧的呆在我身边陪我学习，以及带我吃很多好吃的，才发现学校有这么多好吃的，有个人在旁边陪着学习工作聊天，乐呵乐呵的是这么幸福的。<br />我的导师姚老师，真滴真滴十分好十分的让我敬爱的一位导师，帮了我无数的忙，也给我了很多的指引和关心，十分感激，我不会忘记在社团打游戏被姚总敲脑阔的场景的。<br />宿舍我感觉呆的时间不长，但是，大学的宿舍的兄弟萌个个都是人才，而且换了一次宿舍让我拥有了更多的舍友，不管是前舍友还是现舍友，现在都是曾经的舍友了。你们的泡面之情，开黑之夜，真滴太骚了，以后有机会再来一波？<br />虽然还有很多事情没有做，比如桂林的很多景点没有去逛过，没有去蹭过其他学院的课，没能像姐大那样奖状拿到手软~<br />最后被我点名了的兄弟萌原谅我，还有很多兄弟的代号没写，因为怕整出一个年级大点名。你们都留着了我的回忆和记录中。感谢大家长久以来的帮助和关照~<br />大家出来工作了或者继续深造读研了，都各奔前程。虽此次离别注定长久不见，但是在江湖上行走时总会相见的，我们下次见面的时候会是怎么样呢，因为世界不大也不小~</p>]]></content>
    
    <summary type="html">
    
      毕业了
    
    </summary>
    
    
      <category term="小日志" scheme="https://www.marxcbr.cn/categories/%E5%B0%8F%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="小日志" scheme="https://www.marxcbr.cn/tags/%E5%B0%8F%E6%97%A5%E5%BF%97/"/>
    
  </entry>
  
  <entry>
    <title>Windows下部署使用Cuckoo Sandbox布谷鸟沙箱</title>
    <link href="https://www.marxcbr.cn/archives/de6fa1ef.html"/>
    <id>https://www.marxcbr.cn/archives/de6fa1ef.html</id>
    <published>2020-06-23T08:43:44.000Z</published>
    <updated>2020-12-23T13:48:32.318Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>上一篇文章已经说了我为何要在Windows下部署Cuckoo，就是为了省点内存，提高体验。然后Cuckoo在Windows下在安装部署文档是空的。</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/d9e49e05ed1c15bea791a1efdaa184ad.png" alt="Windows布谷鸟" /></p><p>好一个 To be documented ~<br />幸好<strong>Python的代码是跨平台的</strong>，所以，不慌它，奥利给，干了<br />上一篇文章已经搭建好布谷鸟所需要的虚拟机环境（即沙箱），这里主要记录cuckoo搭建的一些小坑</p><h2 id="安装python27"><a class="markdownIt-Anchor" href="#安装python27"></a> 安装Python27</h2><p>因为Cuckoo的安装要求是在Python2下面的，所以安装Python27</p><p><a href="https://www.python.org/downloads/release/python-2718/">Python2.7.18 下载页面</a></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/0ae942b2abf77eb0c011cb8dc8e98e83.png" alt="Windows布谷鸟" /></p><p>下载回来之后，安装好。</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/b7fa84b29c2d3fe96ce1e5c0b243dea8.png" alt="Windows布谷鸟" /></p><h2 id="安装cuckoo"><a class="markdownIt-Anchor" href="#安装cuckoo"></a> 安装Cuckoo</h2><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/2f2f23ad0ecc0058bc6c4fbc4710dca1.png" alt="Windows布谷鸟" /></p><p>U1S1,Pycharm他们Jetbrain家 的Loading图是真的帅。<br />来到设置里面的解析器的包管理页面，安装一下cuckoo，用pip直接装也一样的，我这里是因为环境有点乱了，pip也乱了，IDE里也配置了镜像源，就开个IDE省事。</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/bf78cd85d39a6cba1ddcb9607ee0843a.png" alt="Windows布谷鸟" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/684f76e6209c2bd497ed9978fef8e906.png" alt="Windows布谷鸟" /></p><div class="note info flat"><p>在这个步骤如果出现GMS、Crypto库编译错误什么的，可以安装VC的一个Python环境即可<br />下载安装 <a href="https://www.microsoft.com/en-us/download/details.aspx?id=44266">Microsoft Visual C++ Compiler for Python 2.7</a></p></div><h3 id="安装pil-pillow"><a class="markdownIt-Anchor" href="#安装pil-pillow"></a> 安装PIL、Pillow</h3><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/3c2b1d051e59187746715fcf117f3c2e.png" alt="Windows布谷鸟" /></p><h3 id="安装pymongo"><a class="markdownIt-Anchor" href="#安装pymongo"></a> 安装pymongo</h3><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/36d8c65f71790c95e2d6c66c1fcc7296.png" alt="Windows布谷鸟" /></p><h2 id="初始化cuckoo"><a class="markdownIt-Anchor" href="#初始化cuckoo"></a> 初始化Cuckoo</h2><blockquote><p>cuckoo init</p></blockquote><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/878926c13f84f19ae46b3c66afd0b39d.png" alt="Windows布谷鸟" /></p><div class="note info flat"><p>如果出现启动错误，那就需要将用户目录下的.cuckoo目录删除掉</p></div><h2 id="启动cuckoo"><a class="markdownIt-Anchor" href="#启动cuckoo"></a> 启动Cuckoo</h2><blockquote><p>cuckoo -d</p></blockquote><p>安装了VirtualBox 6.1 ，但是还是出现了这个报错<br />Potentially vulnerable virtualbox version installed. Failed to retrieve its version. Update if version is: 6.0.5</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/11a895a82eb1869dcfabe755093a5a3b.png" alt="Windows布谷鸟" /></p><p><strong>修改配置文件，跳过检测即可</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- C:\Users\你的用户名\.cuckoo\conf\cuckoo.conf --&gt;</span></span><br><span class="line">ignore_vulnerabilities = yes</span><br></pre></td></tr></table></figure><blockquote><p>修改好之后，启动看看，可以发现找不到vboxmanage<br />报错提示我们，我们还有配置文件没修改，找到virtualbox.conf，修改path的值为我电脑上的virtualbox的目录下的vboxmanage路径</p></blockquote><p>2020-06-21 10:55:00,121 [cuckoo] CRITICAL: CuckooCriticalError: VirtualBox’ VBoxManage not found at specified path “/usr/bin/VBoxManage” (as specified in virtualbox.conf). Did you properly install VirtualBox and configure Cuckoo to use it?</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/d3989ef69686a011e9645c6d0fdfeb31.png" alt="Windows布谷鸟" /></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- C:\Users\你的用户名\.cuckoo\conf\virtualbox.conf --&gt;</span></span><br><span class="line"></span><br><span class="line"># Path to the local installation of the VBoxManage utility.</span><br><span class="line"># path = /usr/bin/VBoxManage</span><br><span class="line">path = E:/Program Files/Oracle/VirtualBox/VBoxManage.exe</span><br></pre></td></tr></table></figure><blockquote><p>修改好之后，再启动看看，报错提示我们没有cuckoo1这个虚拟机，找到virtualbox.conf，修改path的值为我电脑上的virtualbox的目录下的vboxmanage路径</p></blockquote><p>2020-06-21 11:04:12,516 [cuckoo] CRITICAL: CuckooCriticalError: Please update your configuration. Unable to shut ‘cuckoo1’ down or find the machine in its proper state: The virtual machine ‘cuckoo1’ doesn’t exist! Please create one or more Cuckoo analysis VMs and properly fill out the Cuckoo configuration!</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/14ab5166f5f1f8ae0445b0d055ed5394.png" alt="Windows布谷鸟" /></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- C:\Users\你的用户名\.cuckoo\conf\virtualbox.conf --&gt;</span></span><br><span class="line">[cuckoo1]</span><br><span class="line"># Specify the label name of the current machine as specified in your</span><br><span class="line"># VirtualBox configuration.</span><br><span class="line">label = XP_64</span><br></pre></td></tr></table></figure><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/e0644e7467bd45a247a46415b9d91721.png" alt="Windows布谷鸟" /></p><blockquote><p>修改好之后，再启动看看，报错提示还原虚拟机的快照失败，叫我给虚拟机搞个快照再说。所以，就给他整个快照噻~</p></blockquote><p>2020-06-21 11:11:57,365 [cuckoo.machinery.virtualbox] DEBUG: Stopping vm XP_64<br />2020-06-21 11:11:57,552 [cuckoo.machinery.virtualbox] DEBUG: Restoring virtual machine XP_64 to its current snapshot<br />2020-06-21 11:11:57,634 [cuckoo] CRITICAL: CuckooCriticalError: Error initializing machines: VBoxManage failed trying to restore the snapshot of machine ‘XP_64’ (this most likely means there is no snapshot, please refer to our documentation for more information on how to setup a snapshot for your VM): error code 1:</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/5b4d505985738c1d1e74c91e3c3bceb1.png" alt="Windows布谷鸟" /></p><p>所以，给它整了一个快照</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/4167243b791750b6243c9c7f6dcae333.png" alt="Windows布谷鸟" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/b66abbca83b982af8122aaf056796326.png" alt="Windows布谷鸟" /></p><blockquote><p>拍好快照之后，再启动看看，看着这个Waiting for analysis tasks. 老夫露出欣慰的笑容 (ಥ_ಥ)</p></blockquote><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/08fc798b4650cb77cec561ba11a55d0f.png" alt="Windows布谷鸟" /></p><h2 id="启动cuckoo-web界面"><a class="markdownIt-Anchor" href="#启动cuckoo-web界面"></a> 启动Cuckoo Web界面</h2><blockquote><p><strong>cuckoo web</strong><br />可以看到提示我们，需要配置MongoDB</p></blockquote><p>In order to use the Cuckoo Web Interface it is required to have MongoDB up-and-running and enabled in Cuckoo. Please refer to our official documentation as well as the $CWD/conf/reporting.conf file.</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/9bfac5c410419cc23a04fbf7634e5cdb.png" alt="Windows布谷鸟" /></p><h3 id="下载mongodb"><a class="markdownIt-Anchor" href="#下载mongodb"></a> 下载MongoDB</h3><p>先跑去下载一个MongoDB<br /><a href="https://www.mongodb.com/try/download/community">MongoDB下载地址</a></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/d07fb1af5c1a36156a621115ee6e4f51.png" alt="Windows布谷鸟" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/6d5c56358664b718b6e725343367c1fd.png" alt="Windows布谷鸟" /></p><p>安装好了就好了</p><h3 id="修改mongodb的配置文件"><a class="markdownIt-Anchor" href="#修改mongodb的配置文件"></a> 修改MongoDB的配置文件</h3><blockquote><p>找到配置MongoDB的文件，是reporting.conf，打开它，修改一下</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- C:\Users\你的用户名\.cuckoo\conf\reporting.conf --&gt;</span></span><br><span class="line">[mongodb]</span><br><span class="line">enabled = yes</span><br><span class="line">host = 127.0.0.1</span><br><span class="line">port = 27017</span><br></pre></td></tr></table></figure><h3 id="创建cuckoo链接"><a class="markdownIt-Anchor" href="#创建cuckoo链接"></a> 创建cuckoo链接</h3><p>改好了配置之后，MongoDB也在本地测试能使用之后</p><blockquote><p>cuckoo web 启动一波，给了我一个新的错误</p></blockquote><p>$ cuckoo web<br />C:\Python27\python.exe: can’t open file ‘C:\Python27\Scripts\cuckoo’: [Errno 2] No such file or directory</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/fce4e0320bc29ba65f0a65f7604f93a8.png" alt="Windows布谷鸟" /></p><p>为此，我用mklink将cuckoo链接过去，然后再跑一遍，就给了我一个这样子报错</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/bb5ad3b315799805089eda93cc402bf9.png" alt="Windows布谷鸟" /></p><p>没办法，只能去翻翻资料，发现挺多人都遇到这个问题的，GitHub上面挺多关于这个报错的issue，幸好都被close了</p><p>测试了两种方案，一钟mklink cuckoo.exe 一种mklink <a href="http://cuckoo-script.py">cuckoo-script.py</a></p><ul><li><p>mklink cuckoo.exe</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/d7ae15ba196b1c1927ea5943caf22100.png" alt="Windows布谷鸟" /></p></li><li><p><strong>mklink <a href="http://cuckoo-script.py">cuckoo-script.py</a></strong><br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/b73648c20da39c999a07112c9ca30a6f.png" alt="Windows布谷鸟" /></p></li></ul><p>可以看到mklink py文件的那个方案是正解</p><h2 id="访问cuckoo网站"><a class="markdownIt-Anchor" href="#访问cuckoo网站"></a> 访问Cuckoo网站</h2><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/880584a4f0b413f7872f9de853525a2e.png" alt="Windows布谷鸟" /></p><p>喜大普奔(ಥ_ಥ)<br />其实是可以看到是有点儿不正常的，这个先不管，后面再处理</p><h2 id="配置网卡大坑"><a class="markdownIt-Anchor" href="#配置网卡大坑"></a> 配置网卡（大坑）</h2><p>最开始，没了留意到装好了的XP系统居然没有网卡</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/01a9a052fa1b4e5aaf708d1c212cf08b.png" alt="Windows布谷鸟" /></p><p>设备管理器里面也显示网卡驱动有问题，一度导致我想下载一个万能驱动包给他装上<br />但是，太麻烦了那样子。毕竟VBox要是不支持XP的网卡的话，也太捞了吧。所以，自信认为问题出在VBOX身上。<br />接着去搞配置，看着这灰色的网卡选项，我一度很绝望。心想：改不了的嘛，什么情况，太辣鸡了吧。</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/f37b13fa3f231e5e6dbd57ffaeb55918.png" alt="Windows布谷鸟" /></p><p>然而发现是自己蠢了，虚拟机都没关，就挂起在那里，这让人家怎么改嘛。。。<br />所以，关掉虚拟机之后，就重新配置一下网卡</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/6f0a865de6fc17168181b4ad4838f865.png" alt="Windows布谷鸟" /></p><blockquote><p>选一个适合自己系统的，要是不知道哪个是系统支持的，可以像我这样，多开几个网卡，选多几个，到时应该总有一个能用的</p></blockquote><p>从新打开网卡设置页面看看</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/91705c7311a248f6257b7deba1f0de8e.png" alt="Windows布谷鸟" /></p><p>再ping一手，奈斯</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/6b2b6cd22e3941ad6d4396d65e8e2171.png" alt="Windows布谷鸟" /></p><h2 id="根据ip地址修改一下ip相关配置"><a class="markdownIt-Anchor" href="#根据ip地址修改一下ip相关配置"></a> 根据IP地址修改一下IP相关配置</h2><p>虚拟机网卡的问题修好之后，该配置cuckoo的配置文件了。稍微根据自己的虚拟机实际情况处理一下即可</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- C:\Users\你的用户名\.cuckoo\conf\virtulbox.conf --&gt;</span></span><br><span class="line"># Specify the IP address of the current virtual machine. Make sure that the</span><br><span class="line"># IP address is valid and that the host machine is able to reach it. If not,</span><br><span class="line"># the analysis will fail.</span><br><span class="line">ip = 192.168.1.232</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- C:\Users\你的用户名\.cuckoo\conf\cuckoo.conf --&gt;</span></span><br><span class="line">[resultserver]</span><br><span class="line"># The Result Server is used to receive in real time the behavioral logs</span><br><span class="line"># produced by the analyzer.</span><br><span class="line"># Specify the IP address of the host. The analysis machines should be able</span><br><span class="line"># to contact the host through such address, so make sure it&#x27;s valid.</span><br><span class="line"># NOTE: if you set resultserver IP to 0.0.0.0 you have to set the option</span><br><span class="line"># `resultserver_ip` for all your virtual machines in machinery configuration.</span><br><span class="line">ip = 192.168.1.166</span><br></pre></td></tr></table></figure><h2 id="配置客户机沙箱"><a class="markdownIt-Anchor" href="#配置客户机沙箱"></a> 配置客户机（沙箱）</h2><p>安装增强工具</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/480adf9ad07acf389213a268f7b8d51f.png" alt="Windows布谷鸟" /></p><p>重启一下虚拟机</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/d4bdfc801d2d2befd0615abee9153beb.png" alt="Windows布谷鸟" /></p><p>下载一个符合虚拟机版本的Python2安装包，扔进去，我这里是32位的Python27。</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/29a3bbe3879033ddee8e8accc27498e5.png" alt="Windows布谷鸟" /></p><p>然后，去<strong>C:\Users\你的名字.cuckoo\agent</strong>这个地方拉agent.py文件进去，双击运行</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/f28e79739d5224f7dc214d040c65cc8b.png" alt="Windows布谷鸟" /></p><blockquote><p><strong>建议在此处给它来个快照</strong></p></blockquote><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/82ef8c154bfd9774c7d70f2c15f7f571.png" alt="Windows布谷鸟" /></p><div class="note info flat"><p>如果出现拖曳文件进虚拟失败的问题，可以采用共享文件夹的方案</p></div><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/cf15ac245bb6a021f32b2ef9f69f9589.png" alt="Windows布谷鸟" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/b65fc62573b67e4bfb903bd283a17198.png" alt="Windows布谷鸟" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/84d9ece37947617f1f30b915599bdfb3.png" alt="Windows布谷鸟" /></p><h2 id="尝试修复cuckoo-web-的异常"><a class="markdownIt-Anchor" href="#尝试修复cuckoo-web-的异常"></a> 尝试修复cuckoo web 的异常</h2><p>cuckoo -d<br />cuckoo web</p><p>启动一下后台服务以及web服务</p><ul><li>注意，没有我下图截的那个红色框的 web启动界面都是不正常的启动。而且是看不到上传图标的</li></ul><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/1811a8778ecbc88a647ee0a2013141e0.png" alt="Windows布谷鸟" /><br />不正常</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/32ef1bbb2942970f4c0ca34e8bc67404.png" alt="Windows布谷鸟" /><br />正常</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/6117af4b036f65c98dfc112a8cacd47d.png" alt="Windows布谷鸟" /><br />注意红色框</p><blockquote><p>正常和不正常的区别咋一看不大，就差了一个上传的图标。实际上，不正常的话，是无法上传病毒样本的。<br />解决方案也比较玄学，这里随意说说。当时测试，发现有几个js文件会load失败，事关socket传输的问题。一系列尝试无果，然后便扔到服务器OSS中，在线load它。然而，还是测试不正常，一气之下，打尻去了。第二天过来重新启动便可以正常启动了。太神奇了~~~</p></blockquote><h2 id="配置tcpdump"><a class="markdownIt-Anchor" href="#配置tcpdump"></a> 配置tcpdump</h2><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/2c53a5839321e88597b36f80d1ef97a0.png" alt="Windows布谷鸟" /></p><p><a href="http://www.microolap.com/products/network/tcpdump/download/">点击下载 Microolap TCPDUMP for Windows</a><br />然后解压好，放tcpdump到.cuckoo目录下<br />修改配置文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[sniffer]</span><br><span class="line"># Enable or disable the use of an external sniffer (tcpdump) [yes/no].</span><br><span class="line">enabled = yes</span><br><span class="line"></span><br><span class="line"># Specify the path to your local installation of tcpdump. Make sure this</span><br><span class="line"># path is correct.</span><br><span class="line"># tcpdump = /usr/sbin/tcpdump</span><br><span class="line">tcpdump = C:/Users/Marx/.cuckoo/tcpdump.exe</span><br></pre></td></tr></table></figure><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/dbe6c1f710cd990aadfa60405f9bef39.png" alt="Windows布谷鸟" /></p><ul><li>不过在后期测试的时候，似乎不太正常，所以这个后期再处理下</li></ul><h2 id="上传病毒样本"><a class="markdownIt-Anchor" href="#上传病毒样本"></a> 上传病毒样本</h2><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/e295335e4efc4610e3eb59c62f204d3f.png" alt="Windows布谷鸟" /></p><p>选中了待分析的软件之后，分析它</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/4a5ee0e55599a77de2f74cf61d811618.png" alt="Windows布谷鸟" /></p><p>在cuckoo -d 的日志下，可以看到分析进展，是否正在正常运行分析</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/7634dc64960f9ce8620cdc57bcdd06b1.png" alt="Windows布谷鸟" /></p><p>在沙盒里面可以看到病毒运行的亚子</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/4fb7eaa2a4f392b5c3b69acdf2358bb3.png" alt="Windows布谷鸟" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/5f15c8c3418b8869b0813378833d22e1.png" alt="Windows布谷鸟" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/f452b3442cfd95fd9aeeb36e708a5956.png" alt="Windows布谷鸟" /></p><p>点击就可以看到报告了</p><h2 id="查看报告"><a class="markdownIt-Anchor" href="#查看报告"></a> 查看报告</h2><p>这是一个比较正常的软件的一个分析</p><ul><li><p>概要报告<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/53fd1516887e1ac75337faa27fc77786.png" alt="Windows布谷鸟" /></p></li><li><p>静态分析<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/acf2291b345a38cf043bcb6a646219ee.png" alt="Windows布谷鸟" /></p></li></ul><p>下面的是一个病毒的分析报告</p><ul><li><p>概要报告<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/c65cfbfcf9b09a95aedee416fed59d7e.png" alt="Windows布谷鸟" /></p></li><li><p>行为分析<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/b4470d008997a255b567204477a68583.png" alt="Windows布谷鸟" /></p></li><li><p>释放文件<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/Windows%E5%B8%83%E8%B0%B7%E9%B8%9F/ac23335cae8d838eccc672cbdaa3b07c.png" alt="Windows布谷鸟" /></p></li></ul><h2 id="结语"><a class="markdownIt-Anchor" href="#结语"></a> 结语</h2><p>差不多啦，布谷鸟的部署，花了我两三个下午。虽说整体部署不是很复杂，遇到错误，fix掉配置的问题就可以了。然后总有玄学错误，让人无法排除。说明Cuckoo的稳定性和健壮性是有待提升的。但是问题不大，毕竟是能解决并正常使用的。就是怎么提高用户部署和使用体验的问题了。接着，Cuckoo的官网是没哟Windows下部署的说明文档的，希望能给看到的同学一些帮助，OK~ Easy~</p>]]></content>
    
    <summary type="html">
    
      布谷鸟沙箱-搭建虚拟机环境~多图杀猫警告
    
    </summary>
    
    
      <category term="信息安全" scheme="https://www.marxcbr.cn/categories/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="沙盒" scheme="https://www.marxcbr.cn/tags/%E6%B2%99%E7%9B%92/"/>
    
  </entry>
  
  <entry>
    <title>布谷鸟沙箱-搭建虚拟机环境</title>
    <link href="https://www.marxcbr.cn/archives/aaaf4be5.html"/>
    <id>https://www.marxcbr.cn/archives/aaaf4be5.html</id>
    <published>2020-06-20T08:43:44.000Z</published>
    <updated>2020-12-23T13:48:32.321Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>布谷鸟的安装使用在一年前已经做过了，但是当时并未用文字记录下过程。而且当时为了节省我那可怜的内存，避免开两三个虚拟机而踩了一堆坑，在Windows上安装CuCkoo布谷鸟来实现沙箱检测。<br />当然，结果是喜人的</p><p>当时就想写文章来记录的，可是一拖就拖了一年了，时间真快啊。开始吧~</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-15-55-29_269f03cb.png" alt="2020-06-20-15-55-29" /></p><h2 id="安装virtualbox"><a class="markdownIt-Anchor" href="#安装virtualbox"></a> 安装VirtualBox</h2><p>到官网下载安装，<a href="https://www.virtualbox.org/wiki/Downloads">链接在此</a></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-19-22-09-07_338dcdb4.png" alt="2020-06-19-22-09-07" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-19-22-09-44_29324f11.png" alt="2020-06-19-22-09-44" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-19-22-13-57_839b0dfa.png" alt="2020-06-19-22-13-57" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-19-22-10-00_f6a7743d.png" alt="2020-06-19-22-10-00" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-19-22-31-32_55e912fe.png" alt="2020-06-19-22-31-32" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-10-36-32_5f885bb9.png" alt="2020-06-20-10-36-32" /></p><h2 id="安装xp系统"><a class="markdownIt-Anchor" href="#安装xp系统"></a> 安装XP系统</h2><p>Windows XP SP3 忘了在哪里下载的了，文件名是 en_windows_xp_professional_sp3_Nov_2013_Incl_SATA_Drivers.iso<br />这个倒是很简单就可以找到，下载回来</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-16-03-56_1274f7a2.png" alt="布谷鸟" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-16-04-27_5945c420.png" alt="布谷鸟" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-16-05-05_474b9be3.png" alt="布谷鸟" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-16-05-22_45a91c0f.png" alt="布谷鸟" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-16-07-49_048d4dd5.png" alt="布谷鸟" /></p><blockquote><p>选中自己的系统镜像</p></blockquote><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-16-08-26_9716d58a.png" alt="布谷鸟" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-16-08-59_1903012d.png" alt="布谷鸟" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-16-10-08_b2566ad6.png" alt="布谷鸟" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-16-10-34_1eed15a3.png" alt="布谷鸟" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-16-11-52_3f0746b6.png" alt="布谷鸟" /></p><blockquote><p>复制文件这步，大概跑了50秒，就搞定了，骄傲一下下</p></blockquote><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-16-12-27_5d79d424.png" alt="布谷鸟" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-16-14-52_b1597933.png" alt="布谷鸟" /></p><p>next一下</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-16-15-38_cf1f6779.png" alt="布谷鸟" /></p><p>输一下管理员密码</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-16-16-26_212390f1.png" alt="布谷鸟" /></p><p>设时间为Beijing时间</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-16-25-58_1da28af1.png" alt="布谷鸟" /></p><blockquote><p>记得移除掉光驱镜像，否则会进入安装界面</p></blockquote><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-16-22-25_119c3881.png" alt="布谷鸟" /></p><p>反正做沙箱的，不开防火墙了</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-16-24-34_dff50bcc.png" alt="布谷鸟" /></p><p>设置用户名，marxtina</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-16-25-01_ea98d7dc.png" alt="布谷鸟" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/HEXO/%E5%B8%83%E8%B0%B7%E9%B8%9F/2020-06-20-16-25-30_4f289297.png" alt="布谷鸟" /></p><blockquote><p>我的蓝天白云</p></blockquote><blockquote><p><strong>虚拟机环境的搭建先到这里吧，图太多了，放同一篇文章，显得不是很好，布谷鸟的坑，留到下一篇里面去</strong></p></blockquote>]]></content>
    
    <summary type="html">
    
      布谷鸟沙箱-搭建虚拟机环境~多图杀猫警告
    
    </summary>
    
    
      <category term="信息安全" scheme="https://www.marxcbr.cn/categories/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="虚拟机" scheme="https://www.marxcbr.cn/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/"/>
    
      <category term="沙盒" scheme="https://www.marxcbr.cn/tags/%E6%B2%99%E7%9B%92/"/>
    
  </entry>
  
  <entry>
    <title>Filco Majesstouch2 键盘蓝牙连接方法</title>
    <link href="https://www.marxcbr.cn/archives/3927d88e.html"/>
    <id>https://www.marxcbr.cn/archives/3927d88e.html</id>
    <published>2020-06-15T07:53:10.000Z</published>
    <updated>2020-12-23T13:48:32.314Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>昨天晚上，键盘突然就连不上电脑了，然后折腾了一会儿才重新连接回电脑<br />所以小小的记录一下，FILCO Majesstouch2 蓝牙连接方法，免得后面连不上的时候，又得去网上搜或者看说明书了，打开自己的博客就可以看到了。<br /><img src="http://marxcbr.oss-cn-shenzhen.aliyuncs.com/static%5C960ce425bf714c1fb10aade85197467f.png" alt="20200615180547" /><br /><img src="http://marxcbr.oss-cn-shenzhen.aliyuncs.com/e581ccaa3b62697ed22bbaa6f6843c96.png" alt="20200615180653" /></p><p><img src="http://marxcbr.oss-cn-shenzhen.aliyuncs.com/static%5Ce581ccaa3b62697ed22bbaa6f6843c96.png" alt="20200615180812" /></p><p><img src="http://marxcbr.oss-cn-shenzhen.aliyuncs.com/static%5Ce17a13d5a9ef486a13b28445421b8473.png" alt="20200615181456" /></p><p><img src="http://marxcbr.oss-cn-shenzhen.aliyuncs.com/static%5Cae1b30013925e16cb3a219f7e6b1bee4.png" alt="20200615181617" /></p><h2 id="连接方法"><a class="markdownIt-Anchor" href="#连接方法"></a> 连接方法</h2><blockquote><ul><li>按住 Ctrl Alt Fn 这仨键，大概按个10秒吧，松开手，会看到指示灯亮起来</li></ul></blockquote><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-6-15/Blog/1592208669677.png" alt="Filco Majesstouch2 键盘蓝牙连接方法" /></p><blockquote><ul><li>在1到4的数字键上选择记录号 ① - ④ 中的任何一个，会看到右边的指示灯闪起来</li><li>打开电脑的蓝牙设备管理器，点击添加蓝牙设备</li></ul></blockquote><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-6-15/Blog/1592208826120.png" alt="Filco Majesstouch2 键盘蓝牙连接方法" /></p><blockquote><ul><li>搜索到键盘之后，点击连接</li></ul></blockquote><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-6-14/Blog/1592141573908.png" alt="Filco Majesstouch2 键盘蓝牙连接方法" /></p><blockquote><ul><li>在键盘上输入显示的数字，我这里是06417267，最后输完一定要<strong>回车一下，记得回车，记得回车！</strong></li></ul></blockquote><blockquote><ul><li>确定后，会出现匹配成功的窗口</li></ul></blockquote><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-6-14/Blog/1592141605842.png" alt="Filco Majesstouch2 键盘蓝牙连接方法" /></p><p>然后就可以使用键盘了<br />OK~EZ~ 打完收工</p><h2 id="晒图一下"><a class="markdownIt-Anchor" href="#晒图一下"></a> 晒图一下</h2><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-6-15/Blog/HR-%E9%94%AE%E7%9B%98.webp" alt="Filco Majesstouch2 键盘蓝牙连接方法" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-6-15/Blog/%E4%BE%A7%E6%8B%8D_%E7%9C%8B%E5%9B%BE%E7%8E%8B.webp" alt="Filco Majesstouch2 键盘蓝牙连接方法" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-6-15/Blog/%E9%94%AE%E7%9B%98%E5%B7%A6%E4%BE%A7_%E7%9C%8B%E5%9B%BE%E7%8E%8B.webp" alt="Filco Majesstouch2 键盘蓝牙连接方法" /></p>]]></content>
    
    <summary type="html">
    
      Filco Majesstouch2 键盘蓝牙连接方法
    
    </summary>
    
    
      <category term="小日志" scheme="https://www.marxcbr.cn/categories/%E5%B0%8F%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="键盘" scheme="https://www.marxcbr.cn/tags/%E9%94%AE%E7%9B%98/"/>
    
  </entry>
  
  <entry>
    <title>C++加密GPT|MBR分区表实现简单磁盘加密</title>
    <link href="https://www.marxcbr.cn/archives/f24f7c58.html"/>
    <id>https://www.marxcbr.cn/archives/f24f7c58.html</id>
    <published>2020-05-06T03:57:00.000Z</published>
    <updated>2020-12-23T13:48:32.314Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>最近都在搞移动存储介质的一些相关的东西。恰好，就有个磁盘加密的需求。这个需求是不是真的需要，我其实都不太清楚，哈哈哈。只不过是恰好想到了，然后就做了。因为想到了这个东西，但是不做出来，感觉不舒服~所以，花了一两天的时间去查阅相关资料，把它给整出来了。利用国密算法SM4对分区表进行一个加解密，实现加密后的磁盘怼到电脑上无法正常使用（其实是可以看到磁盘的，只不过打开不了而已）。</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-5-6/BogImages/1588741146022.png" alt="C++加密GPT|MBR分区表实现简单磁盘加密" /><br />这是GPT格式的效果</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-5-6/BogImages/1588742155892.png" alt="C++加密GPT|MBR分区表实现简单磁盘加密" /><br />这是MBR格式的效果</p><p>都是用不了，只显示插入了一个存储介质</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-5-6/BogImages/1588742219330.png" alt="" /><br />存储管理器里面显示未分配空间</p><h2 id="先简单研究一下下mbr和gpt的区别"><a class="markdownIt-Anchor" href="#先简单研究一下下mbr和gpt的区别"></a> 先简单研究一下下MBR和GPT的区别</h2><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-5-6/BogImages/1588763044501.png" alt="C++加密GPT|MBR分区表实现简单磁盘加密" /><br />MBR结构</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-5-6/BogImages/1588763122842.png" alt="C++加密GPT|MBR分区表实现简单磁盘加密" /><br />GPT结构</p><blockquote><p>MBR分区表与GPT分区表的关系<br />与支持最大卷为2 TB（Terabytes）并且每个磁盘最多有4个主分区（或3个主分区，1个扩展分区和无限制的逻辑驱动器）的MBR磁盘分区的样式相比，GPT磁盘分区样式支持最大为128个分割，一个分割最大18 EB（Exabytes），只受到操作系统限制（由于分区表本身需要占用一定空间，最初规划硬盘分区时，留给分区表的空间决定了最多可以有多少个分区，IA-64版Windows限制最多有128个分区，这也是EFI标准规定的分区表的最小尺寸）。与MBR分区的磁盘不同，至关重要的平台操作数据位于分区，而不是位于非分区或隐藏扇区。另外，GPT分区磁盘有备份分区表来提高分区数据结构的完整性。在UEFI系统上，通常是通过ESP分区中的EFI应用程序文件引导GPT硬盘上的操作系统，而不是活动主分区上的引导程序。<br /><strong>资料来源</strong>：</p><ul><li>维基百科 <a href="https://zh.wikipedia.org/wiki/%E4%B8%BB%E5%BC%95%E5%AF%BC%E8%AE%B0%E5%BD%95">https://zh.wikipedia.org/wiki/主引导记录</a></li><li>维基百科 <a href="https://zh.wikipedia.org/wiki/GUID%E7%A3%81%E7%A2%9F%E5%88%86%E5%89%B2%E8%A1%A8">https://zh.wikipedia.org/wiki/GUID磁碟分割表</a></li></ul></blockquote><p>总结来说，就是<strong>MBR支持4个主要分区，GPT支持128个</strong>。然后MBR中的分区表是写在第0个扇区，偏移在0x1BE上面的，一共4项，每项16个字节。GPT则在第2个扇区开始写，一共可以划分为128个分区，从偏移0x00就开始写，每项占用128个字节，即以0x80的距离进行偏移记录。然后按照常规512字节一共扇区计算的话，128个项就是占有32个扇区。</p><h2 id="使用sm4国密对称加密算法对分区表进行加密"><a class="markdownIt-Anchor" href="#使用sm4国密对称加密算法对分区表进行加密"></a> 使用SM4国密对称加密算法对分区表进行加密</h2><p>加密分区表可以有很多钟办法，采用对称、非对称加密、还是简单的异或值、左移右移来搞凯撒密码都可以。只要你喜欢的都可以<br />在这里，我会采用国密算法SM4进行一个加密操作。SM4的实现不是我写的，是从Github上面搞回来的，具体作者是谁，我并没有记录到，当时拿过来就用了，没有记录到作者，实在不好意思~</p><p>该怎么加密，加密之后的数据该放哪个位置。<br />在这里，采用的最简单的一个做法，不免显得有些蠢~<br />对于MBR分区则对上文中说到的64个字节的四个分区项加密，然后存放在36号扇区。<br />对于GPT分区，则对上文说到的 2——33 扇区进行加密，然后存在36号扇区起的连续32个扇区</p><p>接着<strong>对上面说到的那些原始分区表存的数据全部清零</strong>。对于GPT的话，还得在第一个扇区读取LBA备份的扇区位置，对备份扇区内的分区表项也给一同抹去才可以生效。因为当检测到主分区表不正常时，会自动读取备份分区表。</p><h2 id="解密分区表的办法"><a class="markdownIt-Anchor" href="#解密分区表的办法"></a> 解密分区表的办法</h2><p>由于磁盘被加密之后，系统就看到没有分区表了。那就会影响使用了，咱们就要将加密后的数据读取回来，读取位置如上文所说，利用SM4进行解密之后，然后再填回原来分区表的地方。约莫几秒中，系统便会识别出正常的分区表，资源管理器便可以正常使用该分区了。</p><h2 id="怎么让分区表一直处于加密状态中呢"><a class="markdownIt-Anchor" href="#怎么让分区表一直处于加密状态中呢"></a> 怎么让分区表一直处于加密状态中呢</h2><p>但是，想象一下，要是加密磁盘怼入计算机中，然后给他解密了分区表之后，突然拔出来了。会发生什么呢？<br />没错，是原来的分区表会保留住。下次他就可以拿着被解锁的磁盘随便用了。<br />所以，在这里，我们可以在插入磁盘，解密分区表之后，约莫等他几秒，让系统识别出来分区表之后，存在缓存之后，马上又给它给加密了。这样子他在后面使用的时候，突然拔出来，分区表也是加密好了的。</p><h2 id="密钥的生成存放方法"><a class="markdownIt-Anchor" href="#密钥的生成存放方法"></a> 密钥的生成存放方法</h2><p>SM4的密钥是128位的，即32个字符。我们可以怎么搞出这128位密钥呢</p><ul><li>随机的生成这个密钥，然后存在某个扇区中</li><li>利用用户输入来实现这个密钥输入</li><li>利用某种东西来派生出这个128位的密钥，例如利用移动存储介质的序列号（采用PID+VID+SerialNumber）来进行一个MD5运算，生成一个128位的消息摘要，利用这个MD5值进行一个加密。</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>K</mi><mi>e</mi><mi>y</mi><mo>=</mo><mi>H</mi><mo stretchy="false">(</mo><mi>P</mi><mi>I</mi><mi>D</mi><mo>+</mo><mi>V</mi><mi>I</mi><mi>D</mi><mo>+</mo><mi>S</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>l</mi><mi>N</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Key=H(PID+VID+SerialNumber)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">u</span><span class="mord mathdefault">m</span><span class="mord mathdefault">b</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span></span></span></p><p>这里，我这里采用，第三种办法，毕竟128位的密钥着实不好记的对吧，利用国密算法SM3来生成256位的密钥。然后截取前128位作为密钥，存在某个扇区中，需要时再读取即可。</p><h3 id="小小的做一下安全分析"><a class="markdownIt-Anchor" href="#小小的做一下安全分析"></a> 小小的做一下安全分析</h3><p>利用 PID+VID+SerialNumber 来生成生成标识符来进行SM3消息摘要是真的安全了吗？并不是，假设我们的加密解密方法被发现了之后，别人还是可以很简单的就写出一个SM3来生成需要用到的消息摘要，用作SM4密钥。<br />所以，为了避免这个情况，我向服务器请求一个由服务器发送回来的秘密值，这秘密值可以是128位的，也可以1024位，也可以2048位，随意我们来进行生成。当别人想自己生成摘要时，这个秘密值就是他所不知道的，毕竟秘密值长度未知，知道长度也“无从下手”，够他愁了~</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>K</mi><mi>e</mi><mi>y</mi><mo>=</mo><mi>H</mi><mo stretchy="false">(</mo><mi>P</mi><mi>I</mi><mi>D</mi><mo>+</mo><mi>V</mi><mi>I</mi><mi>D</mi><mo>+</mo><mi>S</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>l</mi><mi>N</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mo>+</mo><mi>S</mi><mi>e</mi><mi>c</mi><mi>r</mi><mi>e</mi><mi>t</mi><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Key=H(PID+VID+SerialNumber+SecretValue)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">u</span><span class="mord mathdefault">m</span><span class="mord mathdefault">b</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">u</span><span class="mord mathdefault">e</span><span class="mclose">)</span></span></span></span></span></p><h2 id="补充说明"><a class="markdownIt-Anchor" href="#补充说明"></a> 补充说明</h2><p>这个移动存储加密方案并不是理想中这么安全的。毕竟，真正的数据区域并没有被加密到。我们只是对分区表进行了一个操作。在加密后，对分区表进行一个清空操作。数据区域，还是明文的情况，如果有心去读取数据的话，可以利用diskgenius、easy recovery 这类软件进行一个数据恢复，进行提取。</p><p>因为全盘全分区加密是需要耗费大量时间的，这次用到这种方案只是适用于我当前的需求，各位大哥参考一下即可</p><p>代码有几百行，着实不好在博客中展示。就由GitHub这些专业的代码托管平台来展示吧，哈哈哈<br />项目的GitHub的位置： <a href="https://github.com/97CBR/tmp_project_in_vs2017">tmp_project_in_vs2017</a> 的 encrypted_disk_partition 分支中</p><center>要是感觉不错的话，就留个言评论一下下呀，欢迎各位大哥指正</center>]]></content>
    
    <summary type="html">
    
      C++加密GPT|MBR分区表实现简单磁盘加密
    
    </summary>
    
    
      <category term="C++" scheme="https://www.marxcbr.cn/categories/C/"/>
    
    
      <category term="C++" scheme="https://www.marxcbr.cn/tags/C/"/>
    
      <category term="分区表加密" scheme="https://www.marxcbr.cn/tags/%E5%88%86%E5%8C%BA%E8%A1%A8%E5%8A%A0%E5%AF%86/"/>
    
      <category term="国密算法" scheme="https://www.marxcbr.cn/tags/%E5%9B%BD%E5%AF%86%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>GitHub这波操作 爱了爱了</title>
    <link href="https://www.marxcbr.cn/archives/b4eeef0.html"/>
    <id>https://www.marxcbr.cn/archives/b4eeef0.html</id>
    <published>2020-04-17T16:34:38.000Z</published>
    <updated>2021-11-15T14:38:29.658Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="有个有钱的爸爸就是可以为所欲为"><a class="markdownIt-Anchor" href="#有个有钱的爸爸就是可以为所欲为"></a> 有个有钱的爸爸就是可以为所欲为</h2><p>GitHub 在 4月14号晚上九点半左右的时候，突然一封邮件发到我的邮箱里<br />邮件内容长这样</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-18/BogImages/1587141395107.png" alt="MarxCBR的小屋" /></p><ul><li><strong>大概就是开放了私有仓库的协同人的人数限制</strong></li><li><strong>GitHub Action 的时间有2000分钟每个月</strong></li><li><strong>降低某些服务的费用</strong></li></ul><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-18/BogImages/1587141930946.png" alt="MarxCBR的小屋" /></p><p><strong>隔壁家Gitee的长这样子，害限制5个人呢，毕竟要恰饭的嘛</strong></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-18/BogImages/1587142117145.png" alt="MarxCBR的小屋" /></p><p>之前开放私有仓库的时候，就已经感觉到了巨硬的力量<br />现在开放了无限私有仓，怕是会让Gitee感受到压力哦~</p>]]></content>
    
    <summary type="html">
    
      GitHub这波操作，
    
    </summary>
    
    
      <category term="小日志" scheme="https://www.marxcbr.cn/categories/%E5%B0%8F%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="小日志" scheme="https://www.marxcbr.cn/tags/%E5%B0%8F%E6%97%A5%E5%BF%97/"/>
    
  </entry>
  
  <entry>
    <title>VMWare 安装Ubuntu18.04-Live-Server记录</title>
    <link href="https://www.marxcbr.cn/archives/9c1fd75a.html"/>
    <id>https://www.marxcbr.cn/archives/9c1fd75a.html</id>
    <published>2020-04-10T07:07:22.000Z</published>
    <updated>2020-12-23T13:48:32.317Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p><strong>我们该如何根据需求来确定我们需要装的系统呢</strong><br />那就当然是按照需求来呀，比如我们并不需要界面的Linux，就可以装今天的主角，Ubuntu18.04-Live-Server。当然如果我们需要界面的话，就装带界面的发行版。如果我们打算装系统来做渗透，那么kali欢迎你。</p><p>这里我需要装一个Ubuntu来部署一个蜜罐系统，嘿嘿，不用界面就好。所以，选择了这个server版本，那我为啥不用docker呢？哈哈哈</p><h2 id="将镜像下载回来"><a class="markdownIt-Anchor" href="#将镜像下载回来"></a> 将镜像下载回来</h2><p>这里我们去清华镜像站下载，下载比较快点 <a href="https://mirrors.tuna.tsinghua.edu.cn/">点击进入</a></p><p>选择发行版</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586493199109.png" alt="MarxCBR的小屋" /></p><p>我要18.04的</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586493186710.png" alt="MarxCBR的小屋" /></p><p>用种子或者直接iso镜像都行</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586493169488.png" alt="MarxCBR的小屋" /></p><h2 id="在虚拟机里面安装"><a class="markdownIt-Anchor" href="#在虚拟机里面安装"></a> 在虚拟机里面安装</h2><p><strong>这部分可以参考以前装kali的记录</strong><br />创建新的虚拟机</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586494359575.png" alt="MarxCBR的小屋" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586494381222.png" alt="MarxCBR的小屋" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586494452916.png" alt="MarxCBR的小屋" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586494592865.png" alt="MarxCBR的小屋" /></p><h2 id="启动虚拟机进行镜像安装"><a class="markdownIt-Anchor" href="#启动虚拟机进行镜像安装"></a> 启动虚拟机进行镜像安装</h2><p>这里要等一两分钟<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586494682620.png" alt="MarxCBR的小屋" /></p><p>英文就好<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586494756765.png" alt="MarxCBR的小屋" /></p><p>不要升级<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586494783386.png" alt="MarxCBR的小屋" /></p><p>美式键盘布局<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586494837988.png" alt="MarxCBR的小屋" /></p><p>设置网络<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586494847221.png" alt="MarxCBR的小屋" /></p><p>不设置代理，这个随意自己<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586494873500.png" alt="MarxCBR的小屋" /></p><p>改成阿里源，下载快N倍<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586494994282.png" alt="MarxCBR的小屋" /></p><p><a href="http://mirrors.aliyun.com/ubuntu/">http://mirrors.aliyun.com/ubuntu/</a></p><p>用整个虚拟磁盘<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586495066864.png" alt="MarxCBR的小屋" /></p><p>默认磁盘<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586495078192.png" alt="MarxCBR的小屋" /></p><p>分区，，默认<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586495159902.png" alt="MarxCBR的小屋" /></p><p>提示要格式化，继续就好<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586495171283.png" alt="MarxCBR的小屋" /></p><p>设置我们主机的名字<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586495367233.png" alt="MarxCBR的小屋" /><br />ps：wkssd是啥意思呢，有兴趣可以猜猜</p><p>这里要用空格<strong>确定勾上安装openssh server</strong>方便后续进行ssh连接<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586495351706.png" alt="MarxCBR的小屋" /></p><p>要是没有自己要用的软件，就直接选择done安装吧<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586495470980.png" alt="MarxCBR的小屋" /></p><p>正在安装的亚子<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586495494986.png" alt="MarxCBR的小屋" /></p><p>安装完会给这个提示，并不会自动重启<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586495707011.png" alt="MarxCBR的小屋" /></p><p>装完之后，选择reboot会起不来。提示我们要将安装媒介移除，我们要将之前选的ISO镜像去了，选择DVD为自动检测<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586495854660.png" alt="MarxCBR的小屋" /></p><p>进入登录界面<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586495890490.png" alt="MarxCBR的小屋" /></p><p>前面可能会连续都登不进去，我瞅了一下回显<br />感觉是生成秘钥什么的<br />试了两三次之后，就可以正常登录了<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-10/BogImages/1586495982450.png" alt="MarxCBR的小屋" /></p><p>OK，差不多就在这样子，简单的记录一下装这个Ubuntu-live-server~嘿嘿</p><center>要是感觉不错的话，就留个言评论一下下呀，欢迎各位大哥指正</center>]]></content>
    
    <summary type="html">
    
      VMWare 安装Ubuntu18.04-Live-Server记录
    
    </summary>
    
    
      <category term="虚拟机" scheme="https://www.marxcbr.cn/categories/%E8%99%9A%E6%8B%9F%E6%9C%BA/"/>
    
    
      <category term="VMWare" scheme="https://www.marxcbr.cn/tags/VMWare/"/>
    
      <category term="Ubuntu" scheme="https://www.marxcbr.cn/tags/Ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>利用C++真正的弹出U盘</title>
    <link href="https://www.marxcbr.cn/archives/7fc2b650.html"/>
    <id>https://www.marxcbr.cn/archives/7fc2b650.html</id>
    <published>2020-04-09T13:26:08.000Z</published>
    <updated>2020-12-23T13:48:32.320Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>为啥我要用C++来弹出我的U盘呢~<br />还是我那让人可爱的毕设里面的一个朴素无华的需求<br />在那个场景里面，我将U盘插进去，然后对其MBR分区写入一个特定的标签后，再从那个特定的位置读取数据进行验证是否已经将标签写入。<br />完成了这件事之后，我就需要将U盘进行弹出，以便于后续的U盘插入并进行打标签流程</p><h2 id="c-弹出u盘有两个方案"><a class="markdownIt-Anchor" href="#c-弹出u盘有两个方案"></a> C++ 弹出U盘有两个方案</h2><p>本来我不知道U盘弹出有两个方案的，查阅资料和MSDN，最容易看到，也最常见的就是利用 <strong>CreateFile</strong> 打开设备的句柄，利用 <strong>DeviceIoControl</strong> 来对设备句柄执行 <strong>IOCTL_STORAGE_EJECT_MEDIA</strong> 这个操作码</p><p>当然前提是你句柄获取都是正确的，然后利用 FSCTL_LOCK_VOLUME、FSCTL_DISMOUNT_VOLUME、IOCTL_STORAGE_MEDIA_REMOVAL 这些操作码来排除其他进程的干扰和锁定U盘</p><p>可是这样子，居然弹出来的设备会变成这样子</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-9/BogImages/1586439632184.png" alt="MarxCBR的小屋" /></p><p>你管这叫弹出？这不是我以前认识的弹出~</p><p>虽然也打开不了磁盘了，提示叫我插入磁盘</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-9/BogImages/1586439737115.png" alt="MarxCBR的小屋" /></p><p>但是你这样子在设备管理器里面也还是可见的，即使使用不了，我利用 <strong>GetLogicalDrives</strong> <strong>CreateFileA</strong> <strong>DeviceIoControl</strong> 这仨函数还是可以将你枚举出来就木得意思了，对吧。</p><p>接着，我可爱的火绒给了我灵感</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-9/BogImages/1586440096994.png" alt="MarxCBR的小屋" /></p><p>弹出前<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-9/BogImages/1586440108669.png" alt="MarxCBR的小屋" /></p><p>弹出后<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-9/BogImages/1586440131724.png" alt="MarxCBR的小屋" /></p><p>这才是我想要的效果啊，喵的。用<strong>IOCTL_STORAGE_EJECT_MEDIA</strong>弹出之后还剩一个图标给我一点也不帅好吧<br /><strong>以下提供到的方案均已测试通过，实现效果如上文说过一致，按需求自取</strong></p><h2 id="第一种解决方案会剩一个无法访问到的盘符"><a class="markdownIt-Anchor" href="#第一种解决方案会剩一个无法访问到的盘符"></a> 第一种解决方案，会剩一个无法访问到的盘符</h2><p>解决方案这种东西，还是直接上代码说的更清楚，都是写代码的人嘛。<br />用代码说清楚它</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief 弹出指定盘符存储设备</span></span><br><span class="line"><span class="comment"> * \param drive_volume_name 盘符，E，F</span></span><br><span class="line"><span class="comment"> * \return</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">BOOL <span class="title">UsbDrivesManager::RemoveUsbByName</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> drive_volume_name)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">    QString paths = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> drive_name = QString(<span class="string">&quot;%1:&quot;</span>).arg(drive_volume_name);</span><br><span class="line">    paths = QString(<span class="string">R&quot;(\\.\%1:)&quot;</span>).arg(drive_volume_name);</span><br><span class="line">    DWORD dw_ret;</span><br><span class="line">    DWORD dw_error;</span><br><span class="line">    WCHAR cs_volume[<span class="number">256</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    paths.toWCharArray(cs_volume);</span><br><span class="line">    <span class="comment">//打开设备</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> h_device = CreateFile(cs_volume,</span><br><span class="line">                                     GENERIC_READ | GENERIC_WRITE,</span><br><span class="line">                                     FILE_SHARE_READ | FILE_SHARE_WRITE,</span><br><span class="line">                                     <span class="literal">NULL</span>,</span><br><span class="line">                                     OPEN_EXISTING,</span><br><span class="line">                                     <span class="number">0</span>,</span><br><span class="line">                                     <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (h_device == INVALID_HANDLE_VALUE) &#123;</span><br><span class="line">        <span class="comment">// can&#x27;t open the drive</span></span><br><span class="line">        dw_error = GetLastError();</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!DeviceIoControl(h_device, FSCTL_LOCK_VOLUME, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, &amp;dw_ret, <span class="number">0</span>))</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!DeviceIoControl(h_device, FSCTL_DISMOUNT_VOLUME, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, &amp;dw_ret, <span class="number">0</span>))</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line"></span><br><span class="line">    PREVENT_MEDIA_REMOVAL pmr_buffer;</span><br><span class="line">    pmr_buffer.PreventMediaRemoval = FALSE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!DeviceIoControl(h_device, IOCTL_STORAGE_MEDIA_REMOVAL, &amp;pmr_buffer, <span class="keyword">sizeof</span>(PREVENT_MEDIA_REMOVAL), <span class="literal">NULL</span>, <span class="number">0</span>, &amp;dw_ret, <span class="literal">NULL</span>))</span><br><span class="line">        qDebug(<span class="string">&quot;DeviceIoControl IOCTL_STORAGE_MEDIA_REMOVAL failed:%d\n&quot;</span>, GetLastError());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> b_result = DeviceIoControl(</span><br><span class="line">                        h_device,</span><br><span class="line">                        IOCTL_STORAGE_EJECT_MEDIA, <span class="comment">//eject USB</span></span><br><span class="line">                        <span class="literal">NULL</span>,</span><br><span class="line">                        <span class="number">0</span>,</span><br><span class="line">                        <span class="literal">NULL</span>,</span><br><span class="line">                        <span class="number">0</span>,</span><br><span class="line">                        &amp;dw_ret,</span><br><span class="line">                        <span class="keyword">static_cast</span>&lt;LPOVERLAPPED&gt;(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="keyword">if</span> (!b_result) &#123;</span><br><span class="line">        dw_error = GetLastError();</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    b_result = CloseHandle(h_device);</span><br><span class="line">    <span class="keyword">if</span> (!b_result) &#123;</span><br><span class="line">        dw_error = GetLastError();</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note info flat"><p>这段代码用到了 Qt 的QString和Qdebug的库，实际使用时，可以根据需求自己稍微加以更改</p></div><h2 id="弹出u盘不会留下盘符图标"><a class="markdownIt-Anchor" href="#弹出u盘不会留下盘符图标"></a> 弹出U盘，不会留下盘符图标</h2><p>还是直接放代码吧</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function">DEVINST <span class="title">UsbDrivesManager::GetDrivesDevInstByDiskNumber</span><span class="params">(<span class="keyword">const</span> <span class="keyword">long</span> disk_number)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> h_dev_info = SetupDiGetClassDevs(&amp;GUID_DEVINTERFACE_DISK, <span class="literal">NULL</span>, <span class="literal">NULL</span>,</span><br><span class="line">                                              DIGCF_PRESENT | DIGCF_DEVICEINTERFACE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (h_dev_info == INVALID_HANDLE_VALUE)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    DWORD dw_index = <span class="number">0</span>;</span><br><span class="line">    SP_DEVICE_INTERFACE_DATA dev_interface_data = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    dev_interface_data.cbSize = <span class="keyword">sizeof</span>(SP_DEVICE_INTERFACE_DATA);</span><br><span class="line">    <span class="keyword">auto</span> b_ret = FALSE;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    SP_DEVICE_INTERFACE_DATA sp_did;</span><br><span class="line">    SP_DEVINFO_DATA sp_dd;</span><br><span class="line">    DWORD dw_size;</span><br><span class="line"></span><br><span class="line">    sp_did.cbSize = <span class="keyword">sizeof</span>(sp_did);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        b_ret = SetupDiEnumDeviceInterfaces(h_dev_info, <span class="literal">NULL</span>, &amp;GUID_DEVINTERFACE_DISK, dw_index,</span><br><span class="line">                                            &amp;dev_interface_data);</span><br><span class="line">        <span class="keyword">if</span> (!b_ret)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        SetupDiEnumInterfaceDevice(h_dev_info, <span class="literal">NULL</span>, &amp;GUID_DEVINTERFACE_DISK, dw_index, &amp;sp_did);</span><br><span class="line"></span><br><span class="line">        dw_size = <span class="number">0</span>;</span><br><span class="line">        SetupDiGetDeviceInterfaceDetail(h_dev_info, &amp;sp_did, <span class="literal">NULL</span>, <span class="number">0</span>, &amp;dw_size, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (dw_size) &#123;</span><br><span class="line">            <span class="keyword">auto</span> psp_did = <span class="keyword">static_cast</span>&lt;PSP_DEVICE_INTERFACE_DETAIL_DATA&gt;(HeapAlloc(</span><br><span class="line">                               GetProcessHeap(), HEAP_ZERO_MEMORY, dw_size));</span><br><span class="line">            <span class="keyword">if</span> (psp_did == <span class="literal">NULL</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>; <span class="comment">// autsch</span></span><br><span class="line">            &#125;</span><br><span class="line">            psp_did-&gt;cbSize = <span class="keyword">sizeof</span>(*psp_did);</span><br><span class="line">            ZeroMemory(<span class="keyword">static_cast</span>&lt;PVOID&gt;(&amp;sp_dd), <span class="keyword">sizeof</span>(sp_dd));</span><br><span class="line">            sp_dd.cbSize = <span class="keyword">sizeof</span>(sp_dd);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">long</span> res = SetupDiGetDeviceInterfaceDetail(h_dev_info, &amp;sp_did, psp_did, dw_size, &amp;dw_size, &amp;sp_dd);</span><br><span class="line">            <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                <span class="keyword">const</span> <span class="keyword">auto</span> h_drive = CreateFile(psp_did-&gt;DevicePath, <span class="number">0</span>,</span><br><span class="line">                                                FILE_SHARE_READ | FILE_SHARE_WRITE, <span class="literal">NULL</span>, OPEN_EXISTING, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">                <span class="keyword">if</span> (h_drive != INVALID_HANDLE_VALUE) &#123;</span><br><span class="line">                    STORAGE_DEVICE_NUMBER sdn;</span><br><span class="line">                    DWORD dw_bytes_returned = <span class="number">0</span>;</span><br><span class="line">                    res = DeviceIoControl(h_drive, IOCTL_STORAGE_GET_DEVICE_NUMBER, <span class="literal">NULL</span>, <span class="number">0</span>, &amp;sdn, <span class="keyword">sizeof</span>(sdn), &amp;dw_bytes_returned, <span class="literal">NULL</span>);</span><br><span class="line">                    <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (disk_number == <span class="keyword">static_cast</span>&lt;<span class="keyword">long</span>&gt;(sdn.DeviceNumber)) &#123;</span><br><span class="line">                            CloseHandle(h_drive);</span><br><span class="line">                            SetupDiDestroyDeviceInfoList(h_dev_info);</span><br><span class="line">                            <span class="keyword">return</span> sp_dd.DevInst;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    CloseHandle(h_drive);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            HeapFree(GetProcessHeap(), <span class="number">0</span>, psp_did);</span><br><span class="line">        &#125;</span><br><span class="line">        dw_index++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SetupDiDestroyDeviceInfoList(h_dev_info);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">UsbDrivesManager::EjectUsbDisk</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> disk_number)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> dev_inst = GetDrivesDevInstByDiskNumber(disk_number);</span><br><span class="line">    <span class="keyword">if</span> (dev_inst == <span class="number">0</span>) &#123;</span><br><span class="line">        qDebug(<span class="string">&quot;GetDrivesDevInstDiskNumber failed\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ULONG status = <span class="number">0</span>;</span><br><span class="line">    ULONG problem_number = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">auto</span> veto_type = PNP_VetoTypeUnknown;</span><br><span class="line">    <span class="keyword">wchar_t</span> veto_name[MAX_PATH];</span><br><span class="line">    <span class="keyword">auto</span> b_success = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> res = CM_Get_Parent(&amp;dev_inst, dev_inst, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (res != CR_SUCCESS)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">res = CM_Get_DevNode_Status(&amp;status, &amp;problem_number, dev_inst, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (res != CR_SUCCESS)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> is_removable = ((status &amp; DN_REMOVABLE) != <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    qDebug(<span class="string">&quot;is removable:%d\n&quot;</span>, is_removable);</span><br><span class="line">    <span class="comment">// try 3 times</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        veto_name[<span class="number">0</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (is_removable)</span><br><span class="line">            res = CM_Request_Device_Eject(dev_inst, &amp;veto_type, veto_name, MAX_PATH, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            res = CM_Query_And_Remove_SubTree(dev_inst, &amp;veto_type, veto_name, MAX_PATH, <span class="number">0</span>);</span><br><span class="line">        b_success = (res == CR_SUCCESS &amp;&amp; veto_name[<span class="number">0</span>] == <span class="string">&#x27;\0&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (b_success)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            Sleep(<span class="number">300</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (b_success)</span><br><span class="line">        qDebug(<span class="string">&quot;Success\n\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note info flat"><p>上面代码的函数用到的参数可以根据 <strong>STORAGE_DEVICE_NUMBER</strong>下的<strong>DeviceNumber</strong>进行获取<br />使用 <strong>CM_Request_Device_Eject</strong> 函数，请加上 <strong>#pragma comment(lib, “setupapi.lib”)</strong> 以及 <strong>#include &lt;cfgmgr32.h&gt;</strong><br />否则会编译失败，提示 <strong>无法解析的外部符号</strong></p></div><h2 id="彩蛋"><a class="markdownIt-Anchor" href="#彩蛋"></a> 彩蛋</h2><p>其实我用IDA和procexp企图看火绒的U盘弹出函数或者调用的API的</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-9/BogImages/1586441793216.png" alt="MarxCBR的小屋" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-9/BogImages/1586442039050.png" alt="MarxCBR的小屋" /></p><p>结果就是失败了，哈哈哈，果然<strong>菜是原罪</strong>啊<br />不过由此得知了火绒的界面是用DuiLib开发的，哈哈哈</p><center>要是感觉不错的话，就留个言评论一下下呀，欢迎各位大哥指正</center>]]></content>
    
    <summary type="html">
    
      利用C++真正的弹出U盘
    
    </summary>
    
    
      <category term="C++" scheme="https://www.marxcbr.cn/categories/C/"/>
    
    
      <category term="C++" scheme="https://www.marxcbr.cn/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>在VS2017中配置CppCheck代码静态检查工具</title>
    <link href="https://www.marxcbr.cn/archives/db7259e3.html"/>
    <id>https://www.marxcbr.cn/archives/db7259e3.html</id>
    <published>2020-04-03T06:45:42.000Z</published>
    <updated>2020-12-23T13:48:32.321Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>最近代码写的稍微有点多，有写新功能，也有做旧代码的重构<br />回顾之前的代码，总是感觉当年写的像一坨翔~<br />这写的都是啥呀，哇~好丑的格式、好烂的代码……<br />运行起来的时候，哇~又崩了~哇又引发异常了~怎么又访问冲突了呀</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-3/BogImages/1585896957485.png" alt="MarxCBR的小屋" /></p><p>所以，我们不能单靠VS自带的检查工具，虽然它也能检查出一些问题。但是我显然需要更强大的检查扫描工具<br />鉴于之前在华为实习时将代码丢到CI/CD中被<strong>PCLint</strong>吊锤，无限警告报错的经历<br />我第一时间就想到了配置PCLint。然后查了一下，卧槽，要收费？没钱没钱~<br />接着就开源真香系列，CppCheck 启动！</p><h2 id="简单介绍一下cppcheck"><a class="markdownIt-Anchor" href="#简单介绍一下cppcheck"></a> 简单介绍一下CppCheck</h2><blockquote><p>Cppcheck是一种用于C和C ++ 编程语言的静态代码分析工具。 它是一个多功能工具，可以检查非标准代码。 [2] 创始人和首席开发人员是DanielMarjamäki。<br />Cppcheck是GNU通用公共许可证下的免费软件 。</p><ul><li>来自维基百科解释 <a href="https://zh.wikipedia.org/wiki/Cppcheck">Cppcheck</a></li></ul></blockquote><h2 id="开始安装搭建"><a class="markdownIt-Anchor" href="#开始安装搭建"></a> 开始安装搭建</h2><h3 id="到官网下载msi"><a class="markdownIt-Anchor" href="#到官网下载msi"></a> 到官网下载msi</h3><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-3/BogImages/1585897700228.png" alt="MarxCBR的小屋" /></p><p>我们<a href="https://github.com/danmar/cppcheck/releases">点击链接</a>下载文件</p><h3 id="双击打开msi安装包按照默认下一步即可"><a class="markdownIt-Anchor" href="#双击打开msi安装包按照默认下一步即可"></a> 双击打开msi安装包，按照默认下一步即可</h3><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-2/BogImages/1585817194646.png" alt="MarxCBR的小屋" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-2/BogImages/1585817218184.png" alt="MarxCBR的小屋" /></p><h3 id="安装vs的插件"><a class="markdownIt-Anchor" href="#安装vs的插件"></a> 安装VS的插件</h3><p>在扩展和更新里面搜索安装</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-3/BogImages/1585897820994.png" alt="MarxCBR的小屋" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-2/BogImages/1585817307359.png" alt="MarxCBR的小屋" /></p><p>这里有意思的是，你在里面点下载之后，他会给你“虚晃一枪”给他把github仓库的链接给你打开了。然后自己点击下载就可</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-2/BogImages/1585817290927.png" alt="MarxCBR的小屋" /></p><p>双击安装，他会提示你关掉VS</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-2/BogImages/1585817329382.png" alt="MarxCBR的小屋" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-2/BogImages/1585817381605.png" alt="MarxCBR的小屋" /></p><h2 id="测试使用"><a class="markdownIt-Anchor" href="#测试使用"></a> 测试使用</h2><h3 id="vs直接编译"><a class="markdownIt-Anchor" href="#vs直接编译"></a> VS直接编译</h3><p>这里我测试两个项目</p><p>之前文章用到的dll的代码编译结果<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-3/BogImages/1585898026077.png" alt="MarxCBR的小屋" /></p><p>之前文章提到的毕业设计的代码编译结果<br /><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-2/BogImages/1585817563127.png" alt="MarxCBR的小屋" /></p><p>可以看到VS一个问题都没给我找到</p><h3 id="在vs里面用cppcheck分析扫描一下"><a class="markdownIt-Anchor" href="#在vs里面用cppcheck分析扫描一下"></a> 在VS里面用CppCheck分析扫描一下</h3><p>毕业设计的代码扫描结果，上来就给我警告内存泄露、未使用的变量等等提示</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-2/BogImages/1585817639691.png" alt="MarxCBR的小屋" /></p><p>根据提示，修正之后，再扫描一次</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-2/BogImages/1585817799527.png" alt="MarxCBR的小屋" /></p><p>扫描一下DLL的那个项目的代码</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-3/BogImages/1585898308038.png" alt="MarxCBR的小屋" /></p><p>当然也给我挑出了那些越界的，未使用的变量和函数等问题</p><p>举个栗子，这个代码显然越界了，对应了上图230行的警告。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> buffer[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">ReadProcessMemory(pubgHandle, (LPVOID)GetModuleBaseAddress(g_pid, processName), buffer, <span class="number">2</span>, <span class="literal">NULL</span>);</span><br><span class="line">buffer[<span class="number">3</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="直接使用gui客户端"><a class="markdownIt-Anchor" href="#直接使用gui客户端"></a> 直接使用GUI客户端</h3><p>可以在客户端里面打开项目进行扫描分析</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-3/BogImages/1585898676469.png" alt="MarxCBR的小屋" /></p><p>综合来说，好评哦，搭建配置这么简单，就可以提高自己的代码规范，血赚有没有！</p><center>要是感觉不错的话，就留个言评论一下下呀，欢迎各位大哥指正</center>]]></content>
    
    <summary type="html">
    
      在VS2017中配置CppCheck代码静态检查工具去检查C++的代码
    
    </summary>
    
    
      <category term="C++" scheme="https://www.marxcbr.cn/categories/C/"/>
    
      <category term="Visual Studio" scheme="https://www.marxcbr.cn/categories/Visual-Studio/"/>
    
    
      <category term="C++" scheme="https://www.marxcbr.cn/tags/C/"/>
    
      <category term="Visual Studio" scheme="https://www.marxcbr.cn/tags/Visual-Studio/"/>
    
      <category term="安全" scheme="https://www.marxcbr.cn/tags/%E5%AE%89%E5%85%A8/"/>
    
      <category term="静态检查" scheme="https://www.marxcbr.cn/tags/%E9%9D%99%E6%80%81%E6%A3%80%E6%9F%A5/"/>
    
  </entry>
  
  <entry>
    <title>利用 Detours Hook CreateProcess 实现进程启动拦截</title>
    <link href="https://www.marxcbr.cn/archives/79a50542.html"/>
    <id>https://www.marxcbr.cn/archives/79a50542.html</id>
    <published>2020-04-02T08:00:57.000Z</published>
    <updated>2020-12-23T13:48:32.319Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>为什么要去利用 detours 进行 Hook CreateProcess 实现进程启动拦截<br />因为学弟问到了这个问题，就结合之前发出来的那个 Hook OpenProcess 的手法一起给做出来了</p><p>进程启动拦截的作用</p><ul><li>监控启动的进程，最近有什么进程启动过</li><li>在进程启动前可以被我进行一些操作，比如<strong>扫描是否有毒</strong>，有问题劳资就不给他启动了，对吧</li></ul><p>所以，就做了一下这个~</p><p>我们知道 detours 是需要 一个和原函数声明一样的假冒函数的，所以，可以大部分参考<a href="https://www.marxcbr.cn/archives/1dd9aa1.html">之前那篇文章</a>进行处理</p><p>这次代码贴的有点多，所以，就直接先给大家看看效果<br />想先看代码建议直接拖到最后看代码。</p><h2 id="效果"><a class="markdownIt-Anchor" href="#效果"></a> 效果</h2><p>Gif文件过大，不适用放到博客中，请点击打开github查看<br /><a href="https://github.com/97CBR/VS2017/blob/master/%E5%90%AF%E5%8A%A8%E7%9B%91%E6%8E%A7.gif">效果GIF</a></p><h2 id="安装detours"><a class="markdownIt-Anchor" href="#安装detours"></a> 安装detours</h2><p>我在这里使用的办法，虽然是最不硬核的办法，但是可能是最节省时间的办法<br />那就是在<strong>NuGet</strong>里面安装</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-3-31/BogImages/1585663612306.png" alt="enter description here" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-3-31/BogImages/1585663665739.png" alt="enter description here" /></p><h2 id="创建准备注入的dll项目"><a class="markdownIt-Anchor" href="#创建准备注入的dll项目"></a> 创建准备注入的dll项目</h2><p>创建新项目去创建一个dll项目</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-3-31/BogImages/1585663805600.png" alt="enter description here" /></p><h2 id="声明我们需要的自己的-新-旧-createprocess-函数"><a class="markdownIt-Anchor" href="#声明我们需要的自己的-新-旧-createprocess-函数"></a> 声明我们需要的自己的 新-旧 CreateProcess 函数</h2><p>注意Windows有两个CreateProcess，</p><ul><li>一个是 CreateProcessA</li><li>一个是 CreateProcessW</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">BOOL</span><span class="params">(WINAPI* pCreateProcessA)</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">_In_opt_ LPCSTR lpApplicationName,</span></span></span><br><span class="line"><span class="function"><span class="params">_Inout_opt_ LPSTR lpCommandLine,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_opt_ LPSECURITY_ATTRIBUTES lpProcessAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_opt_ LPSECURITY_ATTRIBUTES lpThreadAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_ BOOL bInheritHandles,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_ DWORD dwCreationFlags,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_opt_ LPVOID lpEnvironment,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_opt_ LPCSTR lpCurrentDirectory,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_ LPSTARTUPINFOA lpStartupInfo,</span></span></span><br><span class="line"><span class="function"><span class="params">_Out_ LPPROCESS_INFORMATION lpProcessInformation</span></span></span><br><span class="line"><span class="function"><span class="params">)</span> </span>= CreateProcessA;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">BOOL</span><span class="params">(WINAPI* pCreateProcessW)</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ LPCWSTR lpApplicationName,</span></span></span><br><span class="line"><span class="function"><span class="params">    _Inout_opt_ LPWSTR lpCommandLine,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ LPSECURITY_ATTRIBUTES lpProcessAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ LPSECURITY_ATTRIBUTES lpThreadAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_ BOOL bInheritHandles,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_ DWORD dwCreationFlags,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ LPVOID lpEnvironment,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ LPCWSTR lpCurrentDirectory,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_ LPSTARTUPINFOW lpStartupInfo,</span></span></span><br><span class="line"><span class="function"><span class="params">    _Out_ LPPROCESS_INFORMATION lpProcessInformation</span></span></span><br><span class="line"><span class="function"><span class="params">)</span> </span>= CreateProcessW;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL WINAPI <span class="title">newCreateProcessA</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">_In_opt_ LPCSTR lpApplicationName,</span></span></span><br><span class="line"><span class="function"><span class="params">_Inout_opt_ LPSTR lpCommandLine,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_opt_ LPSECURITY_ATTRIBUTES lpProcessAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_opt_ LPSECURITY_ATTRIBUTES lpThreadAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_ BOOL bInheritHandles,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_ DWORD dwCreationFlags,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_opt_ LPVOID lpEnvironment,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_opt_ LPCSTR lpCurrentDirectory,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_ LPSTARTUPINFOA lpStartupInfo,</span></span></span><br><span class="line"><span class="function"><span class="params">_Out_ LPPROCESS_INFORMATION lpProcessInformation)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> text[<span class="number">128</span>];</span><br><span class="line">    <span class="built_in">sprintf</span>(text, <span class="string">&quot;HOOKing！: %s \n&quot;</span>, lpApplicationName);</span><br><span class="line">    MessageBox(<span class="number">0</span>, text, TEXT(<span class="string">&quot;提示&quot;</span>), MB_OK);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 假设我们只拦截禁止 cmd 启动</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(lpApplicationName, <span class="string">&quot;C:\\Windows\\System32\\cmd.exe&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">        TCHAR  text[<span class="number">128</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">        wsprintf(text, <span class="string">&quot;HOOKing！禁止启动: %s \n&quot;</span>, lpApplicationName);</span><br><span class="line">        MessageBox(<span class="number">0</span>, text, TEXT(<span class="string">&quot;提示&quot;</span>), MB_OK);</span><br><span class="line">        SetLastError(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pCreateProcessA(</span><br><span class="line">               lpApplicationName,</span><br><span class="line">               lpCommandLine,</span><br><span class="line">               lpProcessAttributes,</span><br><span class="line">               lpThreadAttributes,</span><br><span class="line">               bInheritHandles,</span><br><span class="line">               dwCreationFlags,</span><br><span class="line">               lpEnvironment,</span><br><span class="line">               lpCurrentDirectory,</span><br><span class="line">               lpStartupInfo,</span><br><span class="line">               lpProcessInformation</span><br><span class="line">           );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL WINAPI <span class="title">newCreateProcessW</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ LPCWSTR lpApplicationName,</span></span></span><br><span class="line"><span class="function"><span class="params">    _Inout_opt_ LPWSTR lpCommandLine,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ LPSECURITY_ATTRIBUTES lpProcessAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ LPSECURITY_ATTRIBUTES lpThreadAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_ BOOL bInheritHandles,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_ DWORD dwCreationFlags,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ LPVOID lpEnvironment,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ LPCWSTR lpCurrentDirectory,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_ LPSTARTUPINFOW lpStartupInfo,</span></span></span><br><span class="line"><span class="function"><span class="params">    _Out_ LPPROCESS_INFORMATION lpProcessInformation)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    TCHAR  text[<span class="number">128</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    wsprintf(text, <span class="string">&quot;HOOKing！: %s \n&quot;</span>, lpApplicationName);</span><br><span class="line">    MessageBox(<span class="number">0</span>, text, TEXT(<span class="string">&quot;提示&quot;</span>), MB_OK);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 假设我们只拦截禁止 cmd 启动</span></span><br><span class="line">    <span class="keyword">if</span> (_wcsicmp(lpApplicationName, <span class="string">L&quot;C:\\Windows\\System32\\cmd.exe&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        TCHAR  text[<span class="number">128</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">        wsprintf(text, <span class="string">&quot;HOOKing！禁止启动: %s \n&quot;</span>, lpApplicationName);</span><br><span class="line">        MessageBox(<span class="number">0</span>, text, TEXT(<span class="string">&quot;提示&quot;</span>), MB_OK);</span><br><span class="line">        SetLastError(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pCreateProcessW(</span><br><span class="line">               lpApplicationName,</span><br><span class="line">               lpCommandLine,</span><br><span class="line">               lpProcessAttributes,</span><br><span class="line">               lpThreadAttributes,</span><br><span class="line">               bInheritHandles,</span><br><span class="line">               dwCreationFlags,</span><br><span class="line">               lpEnvironment,</span><br><span class="line">               lpCurrentDirectory,</span><br><span class="line">               lpStartupInfo,</span><br><span class="line">               lpProcessInformation</span><br><span class="line">           );</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="声明dll共享节做-hook-的控制"><a class="markdownIt-Anchor" href="#声明dll共享节做-hook-的控制"></a> 声明DLL共享节，做 Hook 的控制</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//共享代码段</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> data_seg(<span class="meta-string">&quot;SHARED&quot;</span>)</span></span><br><span class="line"></span><br><span class="line">HHOOK g_hOpenProcessHook = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">BOOL g_bStopHook = FALSE;</span><br><span class="line">BOOL g_bHookInstalled = FALSE;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> data_seg()</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(linker, <span class="meta-string">&quot;/section:SHARED,RWS&quot;</span>)</span></span><br></pre></td></tr></table></figure><h2 id="利用setwindowshookex进行全局hook"><a class="markdownIt-Anchor" href="#利用setwindowshookex进行全局hook"></a> 利用SetWindowsHookEx进行全局HOOK</h2><p>在OpenProcessHookProc这个回调函数中进行处理我们的HOOK</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导出函数 加载全局钩子</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> __declspec(dllexport) <span class="function">BOOL <span class="title">SetGoableHook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    g_bStopHook = FALSE;</span><br><span class="line"></span><br><span class="line">    g_hOpenProcessHook = SetWindowsHookEx(WH_GETMESSAGE,</span><br><span class="line">                                          CreateProcessHookProc,</span><br><span class="line">                                          ModuleFromAddress(CreateProcessHookProc), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (g_hOpenProcessHook == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">char</span> text[<span class="number">30</span>];</span><br><span class="line">        wsprintf(text, <span class="string">&quot;HOOK失败！error : %d n&quot;</span>, GetLastError());</span><br><span class="line">        MessageBox(<span class="number">0</span>, text, TEXT(<span class="string">&quot;错误&quot;</span>), MB_OK);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="调用这个-拦截启动hook的方法"><a class="markdownIt-Anchor" href="#调用这个-拦截启动hook的方法"></a> 调用这个 拦截启动HOOK的方法</h2><p>声明两个函数、一个是进行HOOK函数、一个是取消HOOK的函数，可以灵活处理</p><p><strong>此代码处于另一软件项目</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">forLong::myhook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ui.label-&gt;setText(<span class="string">&quot;hooking&quot;</span>);</span><br><span class="line">    HINSTANCE hDLL = ::LoadLibrary(<span class="string">L&quot;MarxHook.dll&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hDLL) &#123;</span><br><span class="line"></span><br><span class="line">        PFN_setData setData = (PFN_setData)::GetProcAddress(hDLL, <span class="string">&quot;setData&quot;</span>);</span><br><span class="line">        PFN_getData getData = (PFN_getData)::GetProcAddress(hDLL, <span class="string">&quot;getData&quot;</span>);</span><br><span class="line">        SetGoableHook func = (SetGoableHook)GetProcAddress(hDLL, <span class="string">&quot;SetGoableHook&quot;</span>);</span><br><span class="line">        qDebug() &lt;&lt; (<span class="keyword">int</span>)getpid() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        setData((<span class="keyword">int</span>)getpid());</span><br><span class="line">        <span class="keyword">int</span> s = getData();</span><br><span class="line">        func();</span><br><span class="line">        <span class="comment">/*qDebug() &lt;&lt;  &lt;&lt; endl;*/</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">forLong::unhook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ui.label-&gt;setText(<span class="string">&quot;unhook&quot;</span>);</span><br><span class="line">    HINSTANCE hDLL = ::LoadLibrary(<span class="string">L&quot;MarxHook.dll&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (hDLL) &#123;</span><br><span class="line">        DropGoableHook func = (DropGoableHook)GetProcAddress(hDLL, <span class="string">&quot;DropGoableHook&quot;</span>);</span><br><span class="line">        func();</span><br><span class="line">        PFN_setData setData = (PFN_setData)::GetProcAddress(hDLL, <span class="string">&quot;setData&quot;</span>);</span><br><span class="line">        PFN_getData getData = (PFN_getData)::GetProcAddress(hDLL, <span class="string">&quot;getData&quot;</span>);</span><br><span class="line">        setData(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//int s = getData();</span></span><br><span class="line">        func();</span><br><span class="line">        <span class="comment">/*   qDebug() &lt;&lt; getData() &lt;&lt; endl;*/</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="整个dll项目代码一起给出来吧"><a class="markdownIt-Anchor" href="#整个dll项目代码一起给出来吧"></a> 整个dll项目代码一起给出来吧</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dllmain.cpp : 定义 DLL 应用程序的入口点。</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;detours.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;TlHelp32.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> <span class="meta-keyword">warning</span>(disable:4996)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> HMODULE s_hDll;</span><br><span class="line"><span class="comment">//共享代码段</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> data_seg(<span class="meta-string">&quot;SHARED&quot;</span>)</span></span><br><span class="line">HHOOK g_hMessageHook = <span class="literal">NULL</span>;</span><br><span class="line">HHOOK g_hOpenProcessHook = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">BOOL g_bStopHook = FALSE;</span><br><span class="line">BOOL g_bHookInstalled = FALSE;</span><br><span class="line">DWORD g_pid = <span class="number">74144</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> data_seg()</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(linker, <span class="meta-string">&quot;/section:SHARED,RWS&quot;</span>)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">HANDLE</span><span class="params">(WINAPI* pOpenProcess)</span><span class="params">(DWORD dwDesiredAccess, BOOL bInheritHandle, DWORD dwProcessId)</span> </span>= OpenProcess;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">BOOL</span><span class="params">(WINAPI* pCreateProcessA)</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">_In_opt_ LPCSTR lpApplicationName,</span></span></span><br><span class="line"><span class="function"><span class="params">_Inout_opt_ LPSTR lpCommandLine,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_opt_ LPSECURITY_ATTRIBUTES lpProcessAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_opt_ LPSECURITY_ATTRIBUTES lpThreadAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_ BOOL bInheritHandles,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_ DWORD dwCreationFlags,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_opt_ LPVOID lpEnvironment,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_opt_ LPCSTR lpCurrentDirectory,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_ LPSTARTUPINFOA lpStartupInfo,</span></span></span><br><span class="line"><span class="function"><span class="params">_Out_ LPPROCESS_INFORMATION lpProcessInformation</span></span></span><br><span class="line"><span class="function"><span class="params">)</span> </span>= CreateProcessA;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">BOOL</span><span class="params">(WINAPI* pCreateProcessW)</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ LPCWSTR lpApplicationName,</span></span></span><br><span class="line"><span class="function"><span class="params">    _Inout_opt_ LPWSTR lpCommandLine,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ LPSECURITY_ATTRIBUTES lpProcessAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ LPSECURITY_ATTRIBUTES lpThreadAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_ BOOL bInheritHandles,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_ DWORD dwCreationFlags,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ LPVOID lpEnvironment,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ LPCWSTR lpCurrentDirectory,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_ LPSTARTUPINFOW lpStartupInfo,</span></span></span><br><span class="line"><span class="function"><span class="params">    _Out_ LPPROCESS_INFORMATION lpProcessInformation</span></span></span><br><span class="line"><span class="function"><span class="params">)</span> </span>= CreateProcessW;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">DWORD <span class="title">GetProcID</span><span class="params">(<span class="keyword">char</span>* procName)</span></span>;</span><br><span class="line"></span><br><span class="line">HANDLE pubgHandle = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">char</span>* processName = (<span class="keyword">char</span>*)<span class="string">&quot;forLong.exe&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">HANDLE WINAPI <span class="title">hOpenProcess</span><span class="params">(DWORD dwDesiredAccess, BOOL bInheritHandle, DWORD dwProcessId)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//if (GetProcID(processName) == dwProcessId) &#123;</span></span><br><span class="line">    <span class="keyword">if</span> (g_pid == dwProcessId) &#123;</span><br><span class="line">        dwDesiredAccess = PROCESS_VM_READ | PROCESS_VM_WRITE | PROCESS_QUERY_INFORMATION;</span><br><span class="line">        pubgHandle = pOpenProcess(dwDesiredAccess, bInheritHandle, dwProcessId);</span><br><span class="line">        SetLastError(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pOpenProcess(dwDesiredAccess, bInheritHandle, dwProcessId);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//CreateProcess</span></span><br><span class="line"><span class="function">BOOL WINAPI <span class="title">newCreateProcessA</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">_In_opt_ LPCSTR lpApplicationName,</span></span></span><br><span class="line"><span class="function"><span class="params">_Inout_opt_ LPSTR lpCommandLine,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_opt_ LPSECURITY_ATTRIBUTES lpProcessAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_opt_ LPSECURITY_ATTRIBUTES lpThreadAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_ BOOL bInheritHandles,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_ DWORD dwCreationFlags,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_opt_ LPVOID lpEnvironment,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_opt_ LPCSTR lpCurrentDirectory,</span></span></span><br><span class="line"><span class="function"><span class="params">_In_ LPSTARTUPINFOA lpStartupInfo,</span></span></span><br><span class="line"><span class="function"><span class="params">_Out_ LPPROCESS_INFORMATION lpProcessInformation)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> text[<span class="number">128</span>];</span><br><span class="line">    <span class="built_in">sprintf</span>(text, <span class="string">&quot;HOOKing！: %s \n&quot;</span>, lpApplicationName);</span><br><span class="line">    MessageBox(<span class="number">0</span>, text, TEXT(<span class="string">&quot;提示&quot;</span>), MB_OK);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(lpApplicationName, <span class="string">&quot;C:\\Windows\\System32\\cmd.exe&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">        TCHAR  text[<span class="number">128</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">        wsprintf(text, <span class="string">&quot;HOOKing！禁止启动: %s \n&quot;</span>, lpApplicationName);</span><br><span class="line">        MessageBox(<span class="number">0</span>, text, TEXT(<span class="string">&quot;提示&quot;</span>), MB_OK);</span><br><span class="line"></span><br><span class="line">        SetLastError(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pCreateProcessA(</span><br><span class="line">               lpApplicationName,</span><br><span class="line">               lpCommandLine,</span><br><span class="line">               lpProcessAttributes,</span><br><span class="line">               lpThreadAttributes,</span><br><span class="line">               bInheritHandles,</span><br><span class="line">               dwCreationFlags,</span><br><span class="line">               lpEnvironment,</span><br><span class="line">               lpCurrentDirectory,</span><br><span class="line">               lpStartupInfo,</span><br><span class="line">               lpProcessInformation</span><br><span class="line">           );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL WINAPI <span class="title">newCreateProcessW</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ LPCWSTR lpApplicationName,</span></span></span><br><span class="line"><span class="function"><span class="params">    _Inout_opt_ LPWSTR lpCommandLine,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ LPSECURITY_ATTRIBUTES lpProcessAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ LPSECURITY_ATTRIBUTES lpThreadAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_ BOOL bInheritHandles,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_ DWORD dwCreationFlags,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ LPVOID lpEnvironment,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ LPCWSTR lpCurrentDirectory,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_ LPSTARTUPINFOW lpStartupInfo,</span></span></span><br><span class="line"><span class="function"><span class="params">    _Out_ LPPROCESS_INFORMATION lpProcessInformation)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    TCHAR  text[<span class="number">128</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">    wsprintf(text, <span class="string">&quot;HOOKing！: %s \n&quot;</span>, lpApplicationName);</span><br><span class="line">    MessageBox(<span class="number">0</span>, text, TEXT(<span class="string">&quot;提示&quot;</span>), MB_OK);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (_wcsicmp(lpApplicationName, <span class="string">L&quot;C:\\Windows\\System32\\cmd.exe&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">        TCHAR  text[<span class="number">128</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">        wsprintf(text, <span class="string">&quot;HOOKing！禁止启动: %s \n&quot;</span>, lpApplicationName);</span><br><span class="line">        MessageBox(<span class="number">0</span>, text, TEXT(<span class="string">&quot;提示&quot;</span>), MB_OK);</span><br><span class="line"></span><br><span class="line">        SetLastError(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pCreateProcessW(</span><br><span class="line">               lpApplicationName,</span><br><span class="line">               lpCommandLine,</span><br><span class="line">               lpProcessAttributes,</span><br><span class="line">               lpThreadAttributes,</span><br><span class="line">               bInheritHandles,</span><br><span class="line">               dwCreationFlags,</span><br><span class="line">               lpEnvironment,</span><br><span class="line">               lpCurrentDirectory,</span><br><span class="line">               lpStartupInfo,</span><br><span class="line">               lpProcessInformation</span><br><span class="line">           );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//查找函数地址</span></span><br><span class="line"><span class="function">HMODULE WINAPI <span class="title">ModuleFromAddress</span><span class="params">(PVOID pv)</span> </span>&#123;</span><br><span class="line">    MEMORY_BASIC_INFORMATION mbi;</span><br><span class="line">    <span class="keyword">if</span> (::VirtualQuery(pv, &amp;mbi, <span class="keyword">sizeof</span>(mbi)) != <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> (HMODULE)mbi.AllocationBase;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">DWORD_PTR <span class="title">GetModuleBaseAddress</span><span class="params">(DWORD pid, TCHAR* name)</span> </span>&#123;</span><br><span class="line">    DWORD_PTR baseAddress = <span class="literal">NULL</span>;</span><br><span class="line">    HANDLE hSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPMODULE, pid);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hSnapshot == INVALID_HANDLE_VALUE)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    MODULEENTRY32 entry = &#123; <span class="literal">NULL</span> &#125;;</span><br><span class="line"></span><br><span class="line">    entry.dwSize = <span class="keyword">sizeof</span>(MODULEENTRY32);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!Module32First(hSnapshot, &amp;entry)) &#123;</span><br><span class="line">        CloseHandle(hSnapshot);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(entry.szModule, name)) &#123;</span><br><span class="line">            baseAddress = (DWORD_PTR)entry.modBaseAddr;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> (Module32Next(hSnapshot, &amp;entry));</span><br><span class="line"></span><br><span class="line">    CloseHandle(hSnapshot);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> baseAddress;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">SetHook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//如果已经安装就return</span></span><br><span class="line">    <span class="keyword">if</span> (g_bHookInstalled)</span><br><span class="line">        <span class="keyword">return</span> TRUE;</span><br><span class="line"></span><br><span class="line">    DetourTransactionBegin();</span><br><span class="line">    DetourUpdateThread(GetCurrentThread());</span><br><span class="line"></span><br><span class="line">    DetourAttach((PVOID*)&amp;pOpenProcess, hOpenProcess);</span><br><span class="line">    DetourAttach((PVOID*)&amp;pCreateProcessA, newCreateProcessA);</span><br><span class="line">    DetourAttach((PVOID*)&amp;pCreateProcessW, newCreateProcessW);</span><br><span class="line"></span><br><span class="line">DetourTransactionCommit();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (pubgHandle != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">char</span> buffer[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">        ReadProcessMemory(pubgHandle, (LPVOID)GetModuleBaseAddress(g_pid, processName), buffer, <span class="number">2</span>, <span class="literal">NULL</span>);</span><br><span class="line">        buffer[<span class="number">3</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; buffer &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    g_bHookInstalled = TRUE;</span><br><span class="line">    <span class="keyword">return</span> g_bHookInstalled;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DropHook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//如果已经卸载就return</span></span><br><span class="line">    <span class="keyword">if</span> (!g_bHookInstalled)<span class="keyword">return</span> TRUE;</span><br><span class="line"></span><br><span class="line">    DetourTransactionBegin();</span><br><span class="line">    DetourUpdateThread(GetCurrentThread());</span><br><span class="line">    DetourDetach((PVOID*)&amp;pOpenProcess, hOpenProcess);</span><br><span class="line">    DetourDetach((PVOID*)&amp;pCreateProcessA, newCreateProcessA);</span><br><span class="line">    DetourDetach((PVOID*)&amp;pCreateProcessW, newCreateProcessW);</span><br><span class="line"></span><br><span class="line">    LONG ret = DetourTransactionCommit();</span><br><span class="line">    g_bHookInstalled = FALSE;</span><br><span class="line">    <span class="keyword">return</span> ret == NO_ERROR;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> LRESULT CALLBACK <span class="title">CreateProcessHookProc</span><span class="params">(<span class="keyword">int</span> nCode, WPARAM wParam, LPARAM lParam)</span> </span>&#123;</span><br><span class="line">    PKBDLLHOOKSTRUCT p = (PKBDLLHOOKSTRUCT)lParam;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wchar_t</span> Dir[_MAX_DIR];</span><br><span class="line">    <span class="keyword">wchar_t</span> FullPath[MAX_PATH]; <span class="comment">// [sp+200h] [bp-614h]@1</span></span><br><span class="line">    <span class="keyword">wchar_t</span> Ext[_MAX_EXT];</span><br><span class="line">    <span class="keyword">wchar_t</span> Filename[_MAX_FNAME];</span><br><span class="line">    <span class="keyword">wchar_t</span> Drive[_MAX_DRIVE];</span><br><span class="line">    GetModuleFileNameW(<span class="number">0</span>, FullPath, MAX_PATH);</span><br><span class="line">    _wsplitpath_s(FullPath, Drive, _MAX_DRIVE, Dir, _MAX_DIR, Filename, _MAX_FNAME, Ext, _MAX_EXT);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">wstring</span> tar = Filename;</span><br><span class="line"></span><br><span class="line">    transform(tar.begin(), tar.end(), tar.begin(), towlower);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//C:\Windows\explorer.exe</span></span><br><span class="line">    <span class="comment">//C:\Windows\System32\Taskmgr.exe</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((_wcsicmp(Filename, <span class="string">L&quot;explorer&quot;</span>) == <span class="number">0</span>) || (_wcsicmp(Filename, <span class="string">L&quot;taskmgr&quot;</span>) == <span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="comment">//if (true) &#123;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//安装钩子</span></span><br><span class="line">        <span class="comment">//MessageBox(NULL, &quot;DLL_PROCESS_ATTACH taskmgr&quot;, &quot;info&quot;, MB_OK);</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!g_bStopHook)</span><br><span class="line">            SetHook();</span><br><span class="line">        <span class="comment">//卸载钩子</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            DropHook();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> CallNextHookEx(g_hOpenProcessHook, nCode, wParam, lParam);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//导出函数 加载全局钩子</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> __declspec(dllexport) <span class="function">BOOL <span class="title">SetGoableHook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    g_bStopHook = FALSE;</span><br><span class="line"></span><br><span class="line">    g_hOpenProcessHook = SetWindowsHookEx(WH_GETMESSAGE,</span><br><span class="line">                                          CreateProcessHookProc,</span><br><span class="line">                                          ModuleFromAddress(CreateProcessHookProc), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (g_hOpenProcessHook == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">char</span> text[<span class="number">30</span>];</span><br><span class="line">        wsprintf(text, <span class="string">&quot;HOOK失败！error : %d n&quot;</span>, GetLastError());</span><br><span class="line">        MessageBox(<span class="number">0</span>, text, TEXT(<span class="string">&quot;错误&quot;</span>), MB_OK);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出函数 卸载全局钩子</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> __declspec(dllexport) <span class="function">BOOL <span class="title">DropGoableHook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    g_bStopHook = TRUE;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span>  __declspec(dllexport) <span class="function"><span class="keyword">void</span> <span class="title">setData</span><span class="params">(<span class="keyword">int</span> target_pid)</span> </span>&#123;</span><br><span class="line">    g_pid = target_pid;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span>  __declspec(dllexport) <span class="function"><span class="keyword">int</span> <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> g_pid;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DllMain</span><span class="params">(HMODULE hModule,</span></span></span><br><span class="line"><span class="function"><span class="params">                      DWORD  ul_reason_for_call,</span></span></span><br><span class="line"><span class="function"><span class="params">                      LPVOID lpReserved</span></span></span><br><span class="line"><span class="function"><span class="params">                     )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (ul_reason_for_call) &#123;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">        s_hDll = hModule;</span><br><span class="line">        DisableThreadLibraryCalls(hModule);</span><br><span class="line">        <span class="comment">//SetGoableHook();</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">        <span class="comment">//DropGoableHook();</span></span><br><span class="line">        UnhookWindowsHookEx(g_hOpenProcessHook);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dllmain.cpp : Defines the entry point for the DLL application.</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;detours.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;TlHelp32.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> <span class="meta-keyword">warning</span>(disable:4996)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//共享代码段</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> data_seg(<span class="meta-string">&quot;SHARED&quot;</span>)</span></span><br><span class="line">HHOOK g_hMessageHook = <span class="literal">NULL</span>;</span><br><span class="line">HHOOK g_hOpenProcessHook = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">BOOL g_bStopHook = FALSE;</span><br><span class="line">BOOL g_bHookInstalled = FALSE;</span><br><span class="line">DWORD g_pid = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> data_seg()</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(linker, <span class="meta-string">&quot;/section:SHARED,RWS&quot;</span>)</span></span><br><span class="line"><span class="comment">//__declspec(allocate(&quot;SHARED&quot;))int g_pid=0;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> HMODULE s_hDll;</span><br><span class="line"></span><br><span class="line">HINSTANCE g_hInstance = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*显示GetLastError的信息*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showerr</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* m)</span> </span>&#123;</span><br><span class="line"><span class="keyword">char</span> message[<span class="number">255</span>];</span><br><span class="line">FormatMessage(FORMAT_MESSAGE_FROM_SYSTEM, <span class="number">0</span>, GetLastError()</span><br><span class="line">, MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), message, <span class="number">255</span>, <span class="number">0</span>);</span><br><span class="line">MessageBox(<span class="literal">NULL</span>, message, m, MB_OK);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">DWORD <span class="title">MyGetProcessId</span><span class="params">(<span class="keyword">char</span>* ProcessName)</span> </span>&#123;</span><br><span class="line">PROCESSENTRY32 pe32;</span><br><span class="line">pe32.dwSize = <span class="keyword">sizeof</span>(pe32);</span><br><span class="line"><span class="comment">//获得系统内所有进程快照</span></span><br><span class="line">HANDLE hProcessSnap = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (hProcessSnap == INVALID_HANDLE_VALUE)</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line"><span class="comment">//枚举列表中的第一个进程</span></span><br><span class="line">BOOL bProcess = Process32First(hProcessSnap, &amp;pe32);</span><br><span class="line"><span class="keyword">while</span> (bProcess) &#123;</span><br><span class="line"><span class="comment">//比较得到的进程名和要保护的进程名是否相同</span></span><br><span class="line"><span class="keyword">if</span> (stricmp(pe32.szExeFile, ProcessName) == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">//相同则返回此进程ID</span></span><br><span class="line"><span class="keyword">return</span> pe32.th32ProcessID;</span><br><span class="line">&#125;</span><br><span class="line">bProcess = Process32Next(hProcessSnap, &amp;pe32);</span><br><span class="line">&#125;</span><br><span class="line">CloseHandle(hProcessSnap);</span><br><span class="line"><span class="comment">//否则返回0</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> ULONG_PTR  DWORD_PTR;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">HANDLE</span><span class="params">(WINAPI* pOpenProcess)</span><span class="params">(DWORD dwDesiredAccess, BOOL bInheritHandle, DWORD dwProcessId)</span> </span>= OpenProcess;</span><br><span class="line"></span><br><span class="line"><span class="function">DWORD <span class="title">GetProcID</span><span class="params">(<span class="keyword">char</span>* procName)</span></span>;</span><br><span class="line"></span><br><span class="line">HANDLE pubgHandle = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">char</span>* processName = (<span class="keyword">char</span>*)<span class="string">&quot;forLong.exe&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">HANDLE WINAPI <span class="title">hOpenProcess</span><span class="params">(DWORD dwDesiredAccess, BOOL bInheritHandle, DWORD dwProcessId)</span> </span>&#123;</span><br><span class="line"><span class="comment">//if (GetProcID(processName) == dwProcessId) &#123;</span></span><br><span class="line"><span class="keyword">if</span> (g_pid == dwProcessId) &#123;</span><br><span class="line">dwDesiredAccess = PROCESS_VM_READ | PROCESS_VM_WRITE | PROCESS_QUERY_INFORMATION;</span><br><span class="line">pubgHandle = pOpenProcess(dwDesiredAccess, bInheritHandle, dwProcessId);</span><br><span class="line">SetLastError(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> pOpenProcess(dwDesiredAccess, bInheritHandle, dwProcessId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">DWORD <span class="title">GetProcID</span><span class="params">(<span class="keyword">char</span>* procName)</span> </span>&#123;</span><br><span class="line">PROCESSENTRY32 pe32;</span><br><span class="line">HANDLE hSnapshot = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">pe32.dwSize = <span class="keyword">sizeof</span>(PROCESSENTRY32);</span><br><span class="line">hSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (Process32First(hSnapshot, &amp;pe32)) &#123;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">strcmp</span>(pe32.szExeFile, procName) == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125; <span class="keyword">while</span> (Process32Next(hSnapshot, &amp;pe32));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (hSnapshot != INVALID_HANDLE_VALUE)</span><br><span class="line">CloseHandle(hSnapshot);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> pe32.th32ProcessID;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">DWORD_PTR <span class="title">GetModuleBaseAddress</span><span class="params">(DWORD pid, TCHAR* name)</span> </span>&#123;</span><br><span class="line">DWORD_PTR baseAddress = <span class="literal">NULL</span>;</span><br><span class="line">HANDLE hSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPMODULE, pid);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (hSnapshot == INVALID_HANDLE_VALUE)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">MODULEENTRY32 entry = &#123; <span class="literal">NULL</span> &#125;;</span><br><span class="line"></span><br><span class="line">entry.dwSize = <span class="keyword">sizeof</span>(MODULEENTRY32);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!Module32First(hSnapshot, &amp;entry)) &#123;</span><br><span class="line">CloseHandle(hSnapshot);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">strcmp</span>(entry.szModule, name)) &#123;</span><br><span class="line">baseAddress = (DWORD_PTR)entry.modBaseAddr;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">while</span> (Module32Next(hSnapshot, &amp;entry));</span><br><span class="line"></span><br><span class="line">CloseHandle(hSnapshot);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> baseAddress;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">hookOpenProcess</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//AllocConsole();</span></span><br><span class="line">DetourTransactionBegin();</span><br><span class="line">DetourUpdateThread(GetCurrentThread());</span><br><span class="line">DetourAttach((PVOID*)&amp;pOpenProcess, hOpenProcess);</span><br><span class="line">DetourTransactionCommit();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (pubgHandle != <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="keyword">char</span> buffer[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">ReadProcessMemory(pubgHandle, (LPVOID)GetModuleBaseAddress(g_pid, processName), buffer, <span class="number">2</span>, <span class="literal">NULL</span>);</span><br><span class="line">buffer[<span class="number">3</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; buffer &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">SetHook</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//如果已经安装就return</span></span><br><span class="line"><span class="keyword">if</span> (g_bHookInstalled)</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line"></span><br><span class="line">CreateThread(<span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="keyword">reinterpret_cast</span>&lt;LPTHREAD_START_ROUTINE&gt;(hookOpenProcess), <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//CreateThread(NULL, NULL, reinterpret_cast&lt;LPTHREAD_START_ROUTINE&gt;(watch_task), NULL, NULL, NULL);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//char text[30];</span></span><br><span class="line"><span class="comment">//wsprintf(text, &quot;HOOK 启动！: %ld&quot;, GetCurrentThread());</span></span><br><span class="line"><span class="comment">//MessageBox(0, text, TEXT(&quot;OK&quot;), MB_OK);</span></span><br><span class="line"></span><br><span class="line">g_bHookInstalled = TRUE;</span><br><span class="line"><span class="keyword">return</span> g_bHookInstalled;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DropHook</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//如果已经卸载就return</span></span><br><span class="line"><span class="keyword">if</span> (!g_bHookInstalled)<span class="keyword">return</span> TRUE;</span><br><span class="line"></span><br><span class="line"><span class="comment">//char text[30];</span></span><br><span class="line"><span class="comment">//wsprintf(text, &quot;HOOK 解除！: %d&quot;, GetLastError());</span></span><br><span class="line"><span class="comment">//MessageBox(0, text, TEXT(&quot;错误&quot;), MB_OK);</span></span><br><span class="line"></span><br><span class="line">DetourTransactionBegin();</span><br><span class="line">DetourUpdateThread(GetCurrentThread());</span><br><span class="line">DetourDetach((PVOID*)&amp;pOpenProcess, hOpenProcess);</span><br><span class="line"></span><br><span class="line">LONG ret = DetourTransactionCommit();</span><br><span class="line">g_bHookInstalled = FALSE;</span><br><span class="line"><span class="keyword">return</span> ret == NO_ERROR;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查找函数地址</span></span><br><span class="line"><span class="function">HMODULE WINAPI <span class="title">ModuleFromAddress</span><span class="params">(PVOID pv)</span> </span>&#123;</span><br><span class="line">MEMORY_BASIC_INFORMATION mbi;</span><br><span class="line"><span class="keyword">if</span> (::VirtualQuery(pv, &amp;mbi, <span class="keyword">sizeof</span>(mbi)) != <span class="number">0</span>)</span><br><span class="line"><span class="keyword">return</span> (HMODULE)mbi.AllocationBase;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> LRESULT CALLBACK <span class="title">OpenProcessHookProc</span><span class="params">(<span class="keyword">int</span> nCode, WPARAM wParam, LPARAM lParam)</span> </span>&#123;</span><br><span class="line">PKBDLLHOOKSTRUCT p = (PKBDLLHOOKSTRUCT)lParam;</span><br><span class="line"></span><br><span class="line"><span class="keyword">wchar_t</span> Dir[_MAX_DIR];</span><br><span class="line"><span class="keyword">wchar_t</span> FullPath[MAX_PATH]; <span class="comment">// [sp+200h] [bp-614h]@1</span></span><br><span class="line"><span class="keyword">wchar_t</span> Ext[_MAX_EXT];</span><br><span class="line"><span class="keyword">wchar_t</span> Filename[_MAX_FNAME];</span><br><span class="line"><span class="keyword">wchar_t</span> Drive[_MAX_DRIVE];</span><br><span class="line">GetModuleFileNameW(<span class="number">0</span>, FullPath, MAX_PATH);</span><br><span class="line">_wsplitpath_s(FullPath, Drive, _MAX_DRIVE, Dir, _MAX_DIR, Filename, _MAX_FNAME, Ext, _MAX_EXT);</span><br><span class="line"></span><br><span class="line"><span class="built_in">wstring</span> tar = Filename;</span><br><span class="line"></span><br><span class="line">transform(tar.begin(), tar.end(), tar.begin(), towlower);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (_wcsicmp(Filename, <span class="string">L&quot;Taskmgr&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">//安装钩子</span></span><br><span class="line"><span class="comment">//MessageBox(NULL, &quot;DLL_PROCESS_ATTACH taskmgr&quot;, &quot;info&quot;, MB_OK);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!g_bStopHook)</span><br><span class="line">SetHook();</span><br><span class="line"><span class="comment">//卸载钩子</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">DropHook();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> CallNextHookEx(g_hOpenProcessHook, nCode, wParam, lParam);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出函数 加载全局钩子</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> __declspec(dllexport) <span class="function">BOOL <span class="title">SetGoableHook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">g_bStopHook = FALSE;</span><br><span class="line">g_hOpenProcessHook = SetWindowsHookEx(WH_GETMESSAGE,</span><br><span class="line">OpenProcessHookProc,</span><br><span class="line">ModuleFromAddress(OpenProcessHookProc), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (g_hOpenProcessHook == <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="keyword">char</span> text[<span class="number">30</span>];</span><br><span class="line">wsprintf(text, <span class="string">&quot;HOOK失败！error : %d n&quot;</span>, GetLastError());</span><br><span class="line">MessageBox(<span class="number">0</span>, text, TEXT(<span class="string">&quot;错误&quot;</span>), MB_OK);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出函数 卸载全局钩子</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> __declspec(dllexport) <span class="function">BOOL <span class="title">DropGoableHook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">g_bStopHook = TRUE;</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span>  __declspec(dllexport) <span class="function"><span class="keyword">void</span> <span class="title">setData</span><span class="params">(<span class="keyword">int</span> target_pid)</span> </span>&#123;</span><br><span class="line">g_pid = target_pid;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span>  __declspec(dllexport) <span class="function"><span class="keyword">int</span> <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> g_pid;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">HMODULE WINAPI <span class="title">Detoured</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> s_hDll;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DllMain</span><span class="params">(HMODULE hModule,</span></span></span><br><span class="line"><span class="function"><span class="params">DWORD  ul_reason_for_call,</span></span></span><br><span class="line"><span class="function"><span class="params">LPVOID lpReserved</span></span></span><br><span class="line"><span class="function"><span class="params">)</span> </span>&#123;</span><br><span class="line">g_hInstance = (HINSTANCE)hModule;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (ul_reason_for_call) &#123;</span><br><span class="line"><span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">s_hDll = hModule;</span><br><span class="line">DisableThreadLibraryCalls(hModule);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">UnhookWindowsHookEx(g_hOpenProcessHook);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><center>要是感觉不错的话，就留个言评论一下下呀，欢迎各位大哥指正</center>]]></content>
    
    <summary type="html">
    
      利用 detours Hook CreateProcess 实现进程启动拦截
    
    </summary>
    
    
      <category term="C++" scheme="https://www.marxcbr.cn/categories/C/"/>
    
    
      <category term="Hook" scheme="https://www.marxcbr.cn/tags/Hook/"/>
    
      <category term="进程启动拦截" scheme="https://www.marxcbr.cn/tags/%E8%BF%9B%E7%A8%8B%E5%90%AF%E5%8A%A8%E6%8B%A6%E6%88%AA/"/>
    
  </entry>
  
  <entry>
    <title>VS2017 调试DLL的操作办法</title>
    <link href="https://www.marxcbr.cn/archives/cbfbcb33.html"/>
    <id>https://www.marxcbr.cn/archives/cbfbcb33.html</id>
    <published>2020-04-01T06:00:33.000Z</published>
    <updated>2020-12-23T13:48:32.317Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>最近在搞Hook这东西玩，但是，感觉这玩意玩起来有点玄学的意味呀<br />所以，就想着用调试去揭开他的神秘面纱</p><h2 id="简单介绍一下dll"><a class="markdownIt-Anchor" href="#简单介绍一下dll"></a> 简单介绍一下DLL</h2><p>以下是来自百度百科的解释</p><blockquote><p>动态链接库英文为DLL，是Dynamic Link Library的缩写。DLL是一个包含可由多个程序，同时使用的代码和数据的库。在Windows中，这种文件被称为应用程序拓展。例如，在 Windows 操作系统中，Comdlg32.dll 执行与对话框有关的常见函数。因此，每个程序都可以使用该 DLL 中包含的功能来实现“打开”对话框。这有助于避免代码重用和促进内存的有效使用。 通过使用 DLL，程序可以实现模块化，由相对独立的组件组成。例如，一个计账程序可以按模块来销售。可以在运行时将各个模块加载到主程序中（如果安装了相应模块）。因为模块是彼此独立的，所以程序的加载速度更快，而且模块只在相应的功能被请求时才加载。</p></blockquote><h2 id="在vs2017中对dll工程进行设置"><a class="markdownIt-Anchor" href="#在vs2017中对dll工程进行设置"></a> 在VS2017中对DLL工程进行设置</h2><h3 id="进入项目设置"><a class="markdownIt-Anchor" href="#进入项目设置"></a> 进入项目设置</h3><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-1/BogImages/1585721941987.png" alt="MarxCBR的小屋" /></p><p>这里可以分成两种调试办法，一种是非附加调试，另一种是附加到其他进程调试</p><p>区别是什么呢，下面分成两种说明</p><h3 id="非附加调试"><a class="markdownIt-Anchor" href="#非附加调试"></a> 非附加调试</h3><p>非附加调试，一般适用于：<br />本地开发了一个软件，其中某些地方调用了 LoadLibrary 函数去加载我的DLL<br />例如：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HINSTANCE hDLL = ::LoadLibrary(<span class="string">L&quot;HOOK.dll&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (hDLL) &#123;</span><br><span class="line">    <span class="comment">// do your work</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个时候，我们要怎么设置项目配置呢<br />按照以下步骤</p><ul><li>调试</li><li>本地Windows调试器</li><li>命令 即将调用到这个dll的exe</li><li>工作目录 .</li></ul><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-1/BogImages/1585722040334.png" alt="MarxCBR的小屋" /></p><h3 id="附加到其他进程调试"><a class="markdownIt-Anchor" href="#附加到其他进程调试"></a> 附加到其他进程调试</h3><p>附加到其他进程调试，一般适用于：<br />本地开发了一个DLL，某个程序会明确的调用到我的DLL，或者，我们通过某些手段使得 目标程序 调用到了我的DLL<br />例如： 我之前发的那篇文章，利用 detours Hook别人的函数，就需要注入dll。</p><p>这个时候，我们要怎么设置项目配置呢<br />按照以下步骤</p><ul><li>调试</li><li>本地Windows调试器</li><li>命令 即将调用到这个dll的exe</li><li>附加 是</li></ul><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-1/BogImages/1585721992676.png" alt="MarxCBR的小屋" /></p><h2 id="测试一下调试效果"><a class="markdownIt-Anchor" href="#测试一下调试效果"></a> 测试一下调试效果</h2><p>我们启动会加载我们将要调试的DLL的进程</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-1/BogImages/1585722821253.png" alt="MarxCBR的小屋" /></p><h2 id="记录一下小坑"><a class="markdownIt-Anchor" href="#记录一下小坑"></a> 记录一下小坑</h2><p>在目标EXE未加载我们的DLL之前进行调试，是无法命中我们的断点的</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-1/BogImages/1585722365251.png" alt="MarxCBR的小屋" /></p><p>在目标进程加载我们的DLL之后，我们的调试则可以命中断点</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-4-1/BogImages/1585722506415.png" alt="MarxCBR的小屋" /></p><center> 要是感觉不错的话，就留个言评论一下下呀，欢迎各位大哥指正 </center>]]></content>
    
    <summary type="html">
    
      VS2017 调试DLL的操作办法
    
    </summary>
    
    
      <category term="Visual Studio" scheme="https://www.marxcbr.cn/categories/Visual-Studio/"/>
    
    
      <category term="调试" scheme="https://www.marxcbr.cn/tags/%E8%B0%83%E8%AF%95/"/>
    
      <category term="Visual Studio" scheme="https://www.marxcbr.cn/tags/Visual-Studio/"/>
    
  </entry>
  
  <entry>
    <title>利用 Detours Hook OpenProcess 实现指定进程保护</title>
    <link href="https://www.marxcbr.cn/archives/1dd9aa1.html"/>
    <id>https://www.marxcbr.cn/archives/1dd9aa1.html</id>
    <published>2020-03-31T14:00:57.000Z</published>
    <updated>2020-12-23T13:48:32.320Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>为什么要去利用 detours 进行 Hook OpenProcess 实现指定进程保护呢<br />因为我的毕设是移动存储设备的安全监控<br />所以，要求软件在电脑上运行的时候，不允许用户自由的关闭程序。得将自己保护起来，就像杀软一样，要先将自己保护好了，再去保护别人</p><h2 id="效果"><a class="markdownIt-Anchor" href="#效果"></a> 效果</h2><p>这次代码贴的有点多，所以，就直接先给大家看看效果</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/Blog/%E6%95%88%E6%9E%9C.gif" alt="" /></p><h2 id="安装detours"><a class="markdownIt-Anchor" href="#安装detours"></a> 安装detours</h2><p>我在这里使用的办法，虽然是最不硬核的办法，但是可能是最节省时间的办法<br />那就是在<strong>NuGet</strong>里面安装</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-3-31/BogImages/1585663612306.png" alt="enter description here" /></p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-3-31/BogImages/1585663665739.png" alt="enter description here" /></p><h2 id="创建准备注入的dll项目"><a class="markdownIt-Anchor" href="#创建准备注入的dll项目"></a> 创建准备注入的dll项目</h2><p>创建新项目去创建一个dll项目</p><p><img src="https://marxcbr.oss-cn-shenzhen.aliyuncs.com/MARXCBR/2020-3-31/BogImages/1585663805600.png" alt="enter description here" /></p><h2 id="声明我们需要的自己的-新-旧-openprocess函数"><a class="markdownIt-Anchor" href="#声明我们需要的自己的-新-旧-openprocess函数"></a> 声明我们需要的自己的 新-旧 OpenProcess函数</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">HANDLE</span><span class="params">(WINAPI* pOpenProcess)</span><span class="params">(DWORD dwDesiredAccess, BOOL bInheritHandle, DWORD dwProcessId)</span> </span>= OpenProcess;</span><br><span class="line"></span><br><span class="line"><span class="function">HANDLE WINAPI <span class="title">hOpenProcess</span><span class="params">(DWORD dwDesiredAccess, BOOL bInheritHandle, DWORD dwProcessId)</span> </span>&#123;</span><br><span class="line"><span class="comment">//if (GetProcID(processName) == dwProcessId) &#123;</span></span><br><span class="line"><span class="keyword">if</span> (g_pid == dwProcessId) &#123;</span><br><span class="line">dwDesiredAccess = PROCESS_VM_READ | PROCESS_VM_WRITE | PROCESS_QUERY_INFORMATION;</span><br><span class="line">pubgHandle = pOpenProcess(dwDesiredAccess, bInheritHandle, dwProcessId);</span><br><span class="line">SetLastError(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> pOpenProcess(dwDesiredAccess, bInheritHandle, dwProcessId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="声明dll共享节将我们需要保护的进程pid什么的放进去"><a class="markdownIt-Anchor" href="#声明dll共享节将我们需要保护的进程pid什么的放进去"></a> 声明DLL共享节，将我们需要保护的进程pid什么的放进去</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//共享代码段</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> data_seg(<span class="meta-string">&quot;SHARED&quot;</span>)</span></span><br><span class="line"></span><br><span class="line">HHOOK g_hOpenProcessHook = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">BOOL g_bStopHook = FALSE;</span><br><span class="line">BOOL g_bHookInstalled = FALSE;</span><br><span class="line">DWORD g_pid = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> data_seg()</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(linker, <span class="meta-string">&quot;/section:SHARED,RWS&quot;</span>)</span></span><br></pre></td></tr></table></figure><h2 id="利用setwindowshookex进行全局hook"><a class="markdownIt-Anchor" href="#利用setwindowshookex进行全局hook"></a> 利用SetWindowsHookEx进行全局HOOK</h2><p>在OpenProcessHookProc这个回调函数中进行处理我们的HOOK</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//导出函数 加载全局钩子</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> __declspec(dllexport) <span class="function">BOOL <span class="title">SetGoableHook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">g_bStopHook = FALSE;</span><br><span class="line">g_hOpenProcessHook = SetWindowsHookEx(WH_GETMESSAGE,</span><br><span class="line">OpenProcessHookProc,</span><br><span class="line">ModuleFromAddress(OpenProcessHookProc), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (g_hOpenProcessHook == <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="keyword">char</span> text[<span class="number">30</span>];</span><br><span class="line">wsprintf(text, <span class="string">&quot;HOOK失败！error : %d n&quot;</span>, GetLastError());</span><br><span class="line">MessageBox(<span class="number">0</span>, text, TEXT(<span class="string">&quot;错误&quot;</span>), MB_OK);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="调用这个保护hook的方法"><a class="markdownIt-Anchor" href="#调用这个保护hook的方法"></a> 调用这个保护HOOK的方法</h2><p>声明两个函数、一个是进行HOOK函数、一个是取消HOOK的函数，可以灵活处理</p><p><strong>此代码处于另一软件项目</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">forLong::myhook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ui.label-&gt;setText(<span class="string">&quot;hooking&quot;</span>);</span><br><span class="line">    HINSTANCE hDLL = ::LoadLibrary(<span class="string">L&quot;HOOK.dll&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hDLL) &#123;</span><br><span class="line"></span><br><span class="line">        PFN_setData setData = (PFN_setData)::GetProcAddress(hDLL, <span class="string">&quot;setData&quot;</span>);</span><br><span class="line">        PFN_getData getData = (PFN_getData)::GetProcAddress(hDLL, <span class="string">&quot;getData&quot;</span>);</span><br><span class="line">        SetGoableHook func = (SetGoableHook)GetProcAddress(hDLL, <span class="string">&quot;SetGoableHook&quot;</span>);</span><br><span class="line">        qDebug() &lt;&lt; (<span class="keyword">int</span>)getpid() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        setData((<span class="keyword">int</span>)getpid());</span><br><span class="line">        <span class="keyword">int</span> s = getData();</span><br><span class="line">        func();</span><br><span class="line">        <span class="comment">/*qDebug() &lt;&lt;  &lt;&lt; endl;*/</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">forLong::unhook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ui.label-&gt;setText(<span class="string">&quot;unhook&quot;</span>);</span><br><span class="line">    HINSTANCE hDLL = ::LoadLibrary(<span class="string">L&quot;HOOK.dll&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (hDLL) &#123;</span><br><span class="line">        DropGoableHook func = (DropGoableHook)GetProcAddress(hDLL, <span class="string">&quot;DropGoableHook&quot;</span>);</span><br><span class="line">        func();</span><br><span class="line">        PFN_setData setData = (PFN_setData)::GetProcAddress(hDLL, <span class="string">&quot;setData&quot;</span>);</span><br><span class="line">        PFN_getData getData = (PFN_getData)::GetProcAddress(hDLL, <span class="string">&quot;getData&quot;</span>);</span><br><span class="line">        setData(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//int s = getData();</span></span><br><span class="line">        func();</span><br><span class="line">        <span class="comment">/*   qDebug() &lt;&lt; getData() &lt;&lt; endl;*/</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="note warning flat"><p>其实，单纯这样处理，如果单hook一次，任务管理器在重启的时候就会将这个HOOK给绕过了。<br />这样子就办法达到继续HOOK OpenProcess 的目的了</p></div><p>所以，我们得处理一下</p><h2 id="fix掉重启任务管理器绕过hook的方案"><a class="markdownIt-Anchor" href="#fix掉重启任务管理器绕过hook的方案"></a> fix掉重启任务管理器绕过HOOK的方案</h2><p>其实很简单，我们只要监控任务管理器是否启动就可以了<br />只要启动了就即可进行API拦截注入 进行HOOK<br />如果关闭了，则停止HOOK</p><p>代码可以这样写</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">forLong::CheckAppRunningStatus</span><span class="params">(<span class="keyword">const</span> QString&amp; appName)</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> Q_OS_WIN</span></span><br><span class="line">    QProcess* process = <span class="keyword">new</span> QProcess;</span><br><span class="line">    process-&gt;start(<span class="string">&quot;tasklist&quot;</span>, QStringList() &lt;&lt; <span class="string">&quot;-fi&quot;</span> &lt;&lt; <span class="string">&quot;imagename eq &quot;</span> + appName);</span><br><span class="line">    process-&gt;waitForFinished();</span><br><span class="line">    QString outputStr = QString::fromLocal8Bit(process-&gt;readAllStandardOutput());</span><br><span class="line">    qDebug() &lt;&lt; outputStr &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">if</span> (outputStr.contains(appName))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">forLong::watchTaskmgr</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (CheckAppRunningStatus(<span class="string">&quot;Taskmgr.exe&quot;</span>)) &#123;</span><br><span class="line">            qDebug() &lt;&lt; <span class="string">&quot;Taskmgr&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            myhook();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            qDebug() &lt;&lt; <span class="string">&quot;no  Taskmgr&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            unhook();</span><br><span class="line">        &#125;</span><br><span class="line">        Sleep(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="整个dll项目代码一起给出来吧"><a class="markdownIt-Anchor" href="#整个dll项目代码一起给出来吧"></a> 整个dll项目代码一起给出来吧</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// dllmain.cpp : Defines the entry point for the DLL application.</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;detours.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;TlHelp32.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> <span class="meta-keyword">warning</span>(disable:4996)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//共享代码段</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> data_seg(<span class="meta-string">&quot;SHARED&quot;</span>)</span></span><br><span class="line">HHOOK g_hMessageHook = <span class="literal">NULL</span>;</span><br><span class="line">HHOOK g_hOpenProcessHook = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">BOOL g_bStopHook = FALSE;</span><br><span class="line">BOOL g_bHookInstalled = FALSE;</span><br><span class="line">DWORD g_pid = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> data_seg()</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(linker, <span class="meta-string">&quot;/section:SHARED,RWS&quot;</span>)</span></span><br><span class="line"><span class="comment">//__declspec(allocate(&quot;SHARED&quot;))int g_pid=0;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> HMODULE s_hDll;</span><br><span class="line"></span><br><span class="line">HINSTANCE g_hInstance = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*显示GetLastError的信息*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showerr</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* m)</span> </span>&#123;</span><br><span class="line"><span class="keyword">char</span> message[<span class="number">255</span>];</span><br><span class="line">FormatMessage(FORMAT_MESSAGE_FROM_SYSTEM, <span class="number">0</span>, GetLastError()</span><br><span class="line">, MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), message, <span class="number">255</span>, <span class="number">0</span>);</span><br><span class="line">MessageBox(<span class="literal">NULL</span>, message, m, MB_OK);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">DWORD <span class="title">MyGetProcessId</span><span class="params">(<span class="keyword">char</span>* ProcessName)</span> </span>&#123;</span><br><span class="line">PROCESSENTRY32 pe32;</span><br><span class="line">pe32.dwSize = <span class="keyword">sizeof</span>(pe32);</span><br><span class="line"><span class="comment">//获得系统内所有进程快照</span></span><br><span class="line">HANDLE hProcessSnap = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (hProcessSnap == INVALID_HANDLE_VALUE)</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line"><span class="comment">//枚举列表中的第一个进程</span></span><br><span class="line">BOOL bProcess = Process32First(hProcessSnap, &amp;pe32);</span><br><span class="line"><span class="keyword">while</span> (bProcess) &#123;</span><br><span class="line"><span class="comment">//比较得到的进程名和要保护的进程名是否相同</span></span><br><span class="line"><span class="keyword">if</span> (stricmp(pe32.szExeFile, ProcessName) == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">//相同则返回此进程ID</span></span><br><span class="line"><span class="keyword">return</span> pe32.th32ProcessID;</span><br><span class="line">&#125;</span><br><span class="line">bProcess = Process32Next(hProcessSnap, &amp;pe32);</span><br><span class="line">&#125;</span><br><span class="line">CloseHandle(hProcessSnap);</span><br><span class="line"><span class="comment">//否则返回0</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> ULONG_PTR  DWORD_PTR;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">HANDLE</span><span class="params">(WINAPI* pOpenProcess)</span><span class="params">(DWORD dwDesiredAccess, BOOL bInheritHandle, DWORD dwProcessId)</span> </span>= OpenProcess;</span><br><span class="line"></span><br><span class="line"><span class="function">DWORD <span class="title">GetProcID</span><span class="params">(<span class="keyword">char</span>* procName)</span></span>;</span><br><span class="line"></span><br><span class="line">HANDLE pubgHandle = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">char</span>* processName = (<span class="keyword">char</span>*)<span class="string">&quot;forLong.exe&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">HANDLE WINAPI <span class="title">hOpenProcess</span><span class="params">(DWORD dwDesiredAccess, BOOL bInheritHandle, DWORD dwProcessId)</span> </span>&#123;</span><br><span class="line"><span class="comment">//if (GetProcID(processName) == dwProcessId) &#123;</span></span><br><span class="line"><span class="keyword">if</span> (g_pid == dwProcessId) &#123;</span><br><span class="line">dwDesiredAccess = PROCESS_VM_READ | PROCESS_VM_WRITE | PROCESS_QUERY_INFORMATION;</span><br><span class="line">pubgHandle = pOpenProcess(dwDesiredAccess, bInheritHandle, dwProcessId);</span><br><span class="line">SetLastError(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> pOpenProcess(dwDesiredAccess, bInheritHandle, dwProcessId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">DWORD <span class="title">GetProcID</span><span class="params">(<span class="keyword">char</span>* procName)</span> </span>&#123;</span><br><span class="line">PROCESSENTRY32 pe32;</span><br><span class="line">HANDLE hSnapshot = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">pe32.dwSize = <span class="keyword">sizeof</span>(PROCESSENTRY32);</span><br><span class="line">hSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (Process32First(hSnapshot, &amp;pe32)) &#123;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">strcmp</span>(pe32.szExeFile, procName) == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125; <span class="keyword">while</span> (Process32Next(hSnapshot, &amp;pe32));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (hSnapshot != INVALID_HANDLE_VALUE)</span><br><span class="line">CloseHandle(hSnapshot);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> pe32.th32ProcessID;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">DWORD_PTR <span class="title">GetModuleBaseAddress</span><span class="params">(DWORD pid, TCHAR* name)</span> </span>&#123;</span><br><span class="line">DWORD_PTR baseAddress = <span class="literal">NULL</span>;</span><br><span class="line">HANDLE hSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPMODULE, pid);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (hSnapshot == INVALID_HANDLE_VALUE)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">MODULEENTRY32 entry = &#123; <span class="literal">NULL</span> &#125;;</span><br><span class="line"></span><br><span class="line">entry.dwSize = <span class="keyword">sizeof</span>(MODULEENTRY32);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!Module32First(hSnapshot, &amp;entry)) &#123;</span><br><span class="line">CloseHandle(hSnapshot);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">strcmp</span>(entry.szModule, name)) &#123;</span><br><span class="line">baseAddress = (DWORD_PTR)entry.modBaseAddr;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">while</span> (Module32Next(hSnapshot, &amp;entry));</span><br><span class="line"></span><br><span class="line">CloseHandle(hSnapshot);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> baseAddress;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">hookOpenProcess</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//AllocConsole();</span></span><br><span class="line">DetourTransactionBegin();</span><br><span class="line">DetourUpdateThread(GetCurrentThread());</span><br><span class="line">DetourAttach((PVOID*)&amp;pOpenProcess, hOpenProcess);</span><br><span class="line">DetourTransactionCommit();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (pubgHandle != <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="keyword">char</span> buffer[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">ReadProcessMemory(pubgHandle, (LPVOID)GetModuleBaseAddress(g_pid, processName), buffer, <span class="number">2</span>, <span class="literal">NULL</span>);</span><br><span class="line">buffer[<span class="number">3</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; buffer &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">SetHook</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//如果已经安装就return</span></span><br><span class="line"><span class="keyword">if</span> (g_bHookInstalled)</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line"></span><br><span class="line">CreateThread(<span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="keyword">reinterpret_cast</span>&lt;LPTHREAD_START_ROUTINE&gt;(hookOpenProcess), <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//CreateThread(NULL, NULL, reinterpret_cast&lt;LPTHREAD_START_ROUTINE&gt;(watch_task), NULL, NULL, NULL);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//char text[30];</span></span><br><span class="line"><span class="comment">//wsprintf(text, &quot;HOOK 启动！: %ld&quot;, GetCurrentThread());</span></span><br><span class="line"><span class="comment">//MessageBox(0, text, TEXT(&quot;OK&quot;), MB_OK);</span></span><br><span class="line"></span><br><span class="line">g_bHookInstalled = TRUE;</span><br><span class="line"><span class="keyword">return</span> g_bHookInstalled;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DropHook</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//如果已经卸载就return</span></span><br><span class="line"><span class="keyword">if</span> (!g_bHookInstalled)<span class="keyword">return</span> TRUE;</span><br><span class="line"></span><br><span class="line"><span class="comment">//char text[30];</span></span><br><span class="line"><span class="comment">//wsprintf(text, &quot;HOOK 解除！: %d&quot;, GetLastError());</span></span><br><span class="line"><span class="comment">//MessageBox(0, text, TEXT(&quot;错误&quot;), MB_OK);</span></span><br><span class="line"></span><br><span class="line">DetourTransactionBegin();</span><br><span class="line">DetourUpdateThread(GetCurrentThread());</span><br><span class="line">DetourDetach((PVOID*)&amp;pOpenProcess, hOpenProcess);</span><br><span class="line"></span><br><span class="line">LONG ret = DetourTransactionCommit();</span><br><span class="line">g_bHookInstalled = FALSE;</span><br><span class="line"><span class="keyword">return</span> ret == NO_ERROR;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查找函数地址</span></span><br><span class="line"><span class="function">HMODULE WINAPI <span class="title">ModuleFromAddress</span><span class="params">(PVOID pv)</span> </span>&#123;</span><br><span class="line">MEMORY_BASIC_INFORMATION mbi;</span><br><span class="line"><span class="keyword">if</span> (::VirtualQuery(pv, &amp;mbi, <span class="keyword">sizeof</span>(mbi)) != <span class="number">0</span>)</span><br><span class="line"><span class="keyword">return</span> (HMODULE)mbi.AllocationBase;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> LRESULT CALLBACK <span class="title">OpenProcessHookProc</span><span class="params">(<span class="keyword">int</span> nCode, WPARAM wParam, LPARAM lParam)</span> </span>&#123;</span><br><span class="line">PKBDLLHOOKSTRUCT p = (PKBDLLHOOKSTRUCT)lParam;</span><br><span class="line"></span><br><span class="line"><span class="keyword">wchar_t</span> Dir[_MAX_DIR];</span><br><span class="line"><span class="keyword">wchar_t</span> FullPath[MAX_PATH]; <span class="comment">// [sp+200h] [bp-614h]@1</span></span><br><span class="line"><span class="keyword">wchar_t</span> Ext[_MAX_EXT];</span><br><span class="line"><span class="keyword">wchar_t</span> Filename[_MAX_FNAME];</span><br><span class="line"><span class="keyword">wchar_t</span> Drive[_MAX_DRIVE];</span><br><span class="line">GetModuleFileNameW(<span class="number">0</span>, FullPath, MAX_PATH);</span><br><span class="line">_wsplitpath_s(FullPath, Drive, _MAX_DRIVE, Dir, _MAX_DIR, Filename, _MAX_FNAME, Ext, _MAX_EXT);</span><br><span class="line"></span><br><span class="line"><span class="built_in">wstring</span> tar = Filename;</span><br><span class="line"></span><br><span class="line">transform(tar.begin(), tar.end(), tar.begin(), towlower);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (_wcsicmp(Filename, <span class="string">L&quot;Taskmgr&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">//安装钩子</span></span><br><span class="line"><span class="comment">//MessageBox(NULL, &quot;DLL_PROCESS_ATTACH taskmgr&quot;, &quot;info&quot;, MB_OK);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!g_bStopHook)</span><br><span class="line">SetHook();</span><br><span class="line"><span class="comment">//卸载钩子</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">DropHook();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> CallNextHookEx(g_hOpenProcessHook, nCode, wParam, lParam);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出函数 加载全局钩子</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> __declspec(dllexport) <span class="function">BOOL <span class="title">SetGoableHook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">g_bStopHook = FALSE;</span><br><span class="line">g_hOpenProcessHook = SetWindowsHookEx(WH_GETMESSAGE,</span><br><span class="line">OpenProcessHookProc,</span><br><span class="line">ModuleFromAddress(OpenProcessHookProc), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (g_hOpenProcessHook == <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="keyword">char</span> text[<span class="number">30</span>];</span><br><span class="line">wsprintf(text, <span class="string">&quot;HOOK失败！error : %d n&quot;</span>, GetLastError());</span><br><span class="line">MessageBox(<span class="number">0</span>, text, TEXT(<span class="string">&quot;错误&quot;</span>), MB_OK);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出函数 卸载全局钩子</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> __declspec(dllexport) <span class="function">BOOL <span class="title">DropGoableHook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">g_bStopHook = TRUE;</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span>  __declspec(dllexport) <span class="function"><span class="keyword">void</span> <span class="title">setData</span><span class="params">(<span class="keyword">int</span> target_pid)</span> </span>&#123;</span><br><span class="line">g_pid = target_pid;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span>  __declspec(dllexport) <span class="function"><span class="keyword">int</span> <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> g_pid;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">HMODULE WINAPI <span class="title">Detoured</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> s_hDll;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DllMain</span><span class="params">(HMODULE hModule,</span></span></span><br><span class="line"><span class="function"><span class="params">DWORD  ul_reason_for_call,</span></span></span><br><span class="line"><span class="function"><span class="params">LPVOID lpReserved</span></span></span><br><span class="line"><span class="function"><span class="params">)</span> </span>&#123;</span><br><span class="line">g_hInstance = (HINSTANCE)hModule;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (ul_reason_for_call) &#123;</span><br><span class="line"><span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">s_hDll = hModule;</span><br><span class="line">DisableThreadLibraryCalls(hModule);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">UnhookWindowsHookEx(g_hOpenProcessHook);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><center>要是感觉不错的话，就留个言评论一下下呀，欢迎各位大哥指正</center>]]></content>
    
    <summary type="html">
    
      利用 Detours hook OpenProcess 实现指定进程保护
    
    </summary>
    
    
      <category term="C++" scheme="https://www.marxcbr.cn/categories/C/"/>
    
    
      <category term="Hook" scheme="https://www.marxcbr.cn/tags/Hook/"/>
    
      <category term="进程保护" scheme="https://www.marxcbr.cn/tags/%E8%BF%9B%E7%A8%8B%E4%BF%9D%E6%8A%A4/"/>
    
  </entry>
  
</feed>
